var rus2eng={"А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Ё":"YO","Ж":"ZH","З":"Z","И":"I","Й":"J","К":"K","Л":"L","М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T","У":"U","Ф":"F","Х":"H","Ц":"C","Ч":"CH","Ш":"SH","Щ":"W","Ъ":"","Ы":"Y","Ь":"","Э":"E","Ю":"YU","Я":"YA","а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"w","ъ":"","ы":"y","ь":"","э":"e","ю":"yu","я":"ya"};var eng2rus={"А":"A",YA:"Я"};var rus2engRE=/(?:[А-Яа-я])/g;var eng2rusRE=/(?:YA|A)/g;function trCallbackRu(a){return rus2eng[a]}function trCallbackEn(a){return eng2rus[a]}function transliterateRu(a){return a.replace(rus2engRE,trCallbackRu)}function transliterateEn(a){return a}function base64encode(g){var f="АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдежзийклмнопрстуфхцчшщъыьэюя";var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var j=c.split("");var h=new Array();var b=0;for(b=0;b<g.length;b++){var d=g.charCodeAt(b);if(d>127){d=f.indexOf(g.charAt(b))+163;if(d<163){continue}}h.push(d)}var l=new Array();var e=h.length-h.length%3;var k=0;for(b=0;b<e;b+=3){k=(h[b]<<16)+(h[b+1]<<8)+h[b+2];l.push(j[(k>>18)&63]+j[(k>>12)&63]+j[(k>>6)&63]+j[k&63])}switch(h.length-e){case 1:k=h[e]<<4;l.push(j[(k>>6)&63]+j[k&63]+"==");break;case 2:k=(h[e]<<10)+(h[e+1]<<2);l.push(j[(k>>12)&63]+j[(k>>6)&63]+j[k&63]+"=");break}return l.join("")}var parsedCookies=null;function setCookie(b,c,a){var f="";if(a){var g=new Date();g.setTime(g.getTime()+a);f="; expires="+g.toGMTString()}if(c===null){f="; expires=Thu, 01-Jan-1970 00:00:01 GMT"}document.cookie=b+"="+c+f+"; path=/";if(parsedCookies){if(c!=null){parsedCookies[b]=c}else{delete parsedCookies[b]}}}function getCookie(a,c){if(typeof(c)=="undefined"){c=false}if(!parsedCookies||c){parsedCookies={};var d=document.cookie.split(";");for(var b=0;b<d.length;b++){var e=d[b].split("=");parsedCookies[e[0].replace(/^\s/,"")]=e[1]}}return parsedCookies[a]||null}function deleteCookie(a){setCookie(a,"",{expires:-1})}function symlinkControl(E,n,M,P,O,j){O=(O instanceof Array)?O:[O];var h=this;var D=E;var K=(M instanceof Array)?M:[M];var d=(K)?"&hierarchy_types="+K.join("-"):"";var q=(O instanceof Array)?"&hierarchy_types="+O.join(","):"";var c=n||null;var z=null;var m=null;var B=null;var w=null;var R=null;var x=null;var J=null;var G=0;var F=0;if(!P){P={}}var Q=P.iconsPath||"/images/cms/admin/mac/tree/";var I=P.fadeColorStart||[255,0,0];var t=P.fadeColorEnd||[255,255,255];var r=P.inputName||("symlinkInput"+D);var v=P.noImages||false;var e=P.treeURL||"/styles/common/js/tree.html";var H=P.rootId;var L=P.popupTitle||getLabel("js-cms-eip-symlink-choose-element");var o=typeof(P.showSuggestType)==="undefined"?true:P.showSuggestType;var b=typeof(P.cutSuggestNames)==="undefined"?true:P.cutSuggestNames;var a=parseInt(P.suggestDivWidth);var C=typeof P.idPrefix=="string"?P.idPrefix:"symlinkInput";var p=P.inputWidth||null;var l={};var u=(j?"&callback=symlinkControlsList."+D+".onlyOne":"");var N=function(){if(!window.symlinkControlsList){window.symlinkControlsList={}}window.symlinkControlsList[D]=h;var V=C+D;h.container=z=document.getElementById(V);if(!z){alert("Container #"+V+" not found");return}var W=document.createElement("input");W.type="hidden";W.name=r;z.parentNode.insertBefore(W,z);w=document.createElement("ul");z.appendChild(w);var X=document.createElement("div");z.appendChild(X);var U=document.createElement("div");U.classList.add("layout-col-control");m=document.createElement("input");m.setAttribute("placeholder",getLabel("js-cms-eip-symlink-search"));X.className="pick-element layout-row-icon";U.appendChild(m);X.appendChild(U);var Y=18,aa=28;m.classList.add("default");if(p){m.style.width=p;m.style.minWidth="auto"}var T=document.createElement("div");T.classList.add("layout-col-icon");B=v?document.createElement("input"):document.createElement("img");B.classList.add("icon-action");T.appendChild(B);X.appendChild(T);m.type="text";if(v){B.type="button";B.value="╘"}else{B.src="/images/cms/admin/mac/tree.png";B.height="18"}B.className="treeButton icon-action";var Z="Sitetree";B.onclick=function(){jQuery.openPopupLayer({name:Z,title:L,width:"100%",height:335,url:e+"?id="+D+(c?"&module="+c:"")+"&name="+Z+q+(window.lang_id?"&lang_id="+window.lang_id:"")+(H?"&root_id="+H:"")+u})};w.className="pageslist";m.onkeypress=function(ac){var ab=ac?ac.keyCode:window.event.keyCode;if(ab==13){return false}};m.onkeyup=function(ac){var ab=ac?ac.keyCode:window.event.keyCode;switch(ab){case 38:if(x.length&&(J>0||J==null)){s((J===null)?(x.length-1):(J-1))}break;case 40:if(x.length&&(J<(x.length-1)||J==null)){s((J===null)?0:(J+1))}break;case 13:y();S();return false;break;case 27:S();break;default:h.doSearch()}};m.onblur=function(){if(R){if(G<parseInt(R.style.left)||G>(parseInt(R.style.left)+parseInt(R.offsetWidth))||F<parseInt(R.style.top)||F>(parseInt(R.style.top)+parseInt(R.offsetHeight))){S()}}}};this.loadItems=function(U){var T=15;jQuery.ajax({url:"/admin/content/load_tree_node.xml?per_page_limit="+T+"&domain_id[]="+(window.domain_id?window.domain_id:"1")+d+(window.lang_id?"&lang_id="+window.lang_id:"")+(H?"&rel="+H:"")+"&search-all-text[]="+encodeURIComponent(U),type:"get",complete:function(W,V){h.updateItems(W)}})};this.onlyOne=function(U,V,T,W){jQuery.closePopupLayer("Sitetree");if(confirm(getLabel("js-island-change-symlink-warning"))){jQuery("a.button",w).click();h.addItem(U,V,W,T);jQuery('form input[name="save-mode"]:first').click()}};this.updateItems=function(V){var W=(jQuery("html.u-eip").length>0);var T=null;J=null;T=V.responseXML.getElementsByTagName("page");if(!T.length){return}x=T;var X=[];for(var Y=0;Y<x.length;Y++){if(l[x[Y].getAttribute("id")]){continue}X[X.length]=x[Y]}x=X;var Z=null;if(!R){R=document.createElement("div");R.className="symlinkAutosuggest";var ac=jQuery(m).offset();R.style.position="absolute";R.style.zIndex=1100;R.style.width=m.clientWidth+"px";if(!isNaN(a)){R.style.width=a+"px"}R.style.top=(ac.top+m.offsetHeight)+"px";R.style.left=ac.left+"px";if(W){R.style.backgroundColor="white";R.style.border="1px solid #ccc"}Z=document.createElement("ul");R.appendChild(Z);document.body.appendChild(R)}A();jQuery(document).mousemove(g);Z=R.firstChild;while(Z.firstChild){Z.removeChild(Z.firstChild)}for(Y=0;Y<x.length;Y++){if(l[x[Y].getAttribute("id")]){continue}var U=k(x[Y].getElementsByTagName("name")[0]);var aa=k(x[Y].getElementsByTagName("basetype")[0]);var ab=x[Y].getAttribute("link");var af=document.createElement("li");var ae=document.createElement("span");var ad=document.createElement("a");af.title=U;if(b){if(U.length>20){U=U.substr(0,20)+"..."}}if(ab.length>55){ab=ab.substr(0,55)+"..."}af.appendChild(document.createTextNode(U));if(o){af.appendChild(ae)}ae.appendChild(document.createTextNode(" ("+aa+")"));if(!W){af.appendChild(document.createElement("br"));af.appendChild(ad);ad.appendChild(document.createTextNode(ab));ad.href=ab;ad.target="_blank"}else{ae.style.display="block";af.className="symlink-item-delete";af.style.padding="3px"}af.onmouseover=function(){s(this.suggestIndex)};af.onclick=function(){y();S()};af.suggestIndex=Y;Z.appendChild(af)}};this.doSearch=function(){var T=m.value;if(T.length>0){h.loadItems(T)}};var s=function(V){var U=(jQuery("html.u-eip").length>0);if(R.style.display!="none"){var W=R.firstChild;var T=W.childNodes.item(J);if(T){if(U){T.style.backgroundColor=""}else{T.className=""}}if(U){W.childNodes.item(V).style.backgroundColor="#ceeaf6"}else{W.childNodes.item(V).className="active"}J=V}};var y=function(){if(R&&R.style.display!="none"&&J!==null){var Z=x[J].getAttribute("id");var U=k(x[J].getElementsByTagName("name")[0]);var T=x[J].getAttribute("link");var X=x[J].getElementsByTagName("basetype")[0];var W="";var V=(W=X.getAttribute("module"))?W:"";var Y=(W=X.getAttribute("method"))?W:"";h.addItem(Z,U,[V,Y],T)}};this.addItem=function(Y,V,Z,W){this.delPlaceHolder();if(l[Y]!==undefined){return}var aa=(jQuery("html.u-eip").length>0);var ab=document.createElement("li");var ag=document.createElement("span");var ae=document.createElement("a");var X=document.createElement("a");var af=document.createElement("input");var ac=this;af.type="hidden";af.name=r;af.value=Y;X.input=af;ae.href=W;if(v){X.appendChild(document.createTextNode("[x]"))}else{var U=document.createElement("i");U.alt="delete";U.className="small-ico i-remove";if(aa){U.classList.add("symlink-item-delete")}X.appendChild(U)}X.href="javascript:void(0);";if(aa){X.style.marginRight="5px"}else{X.className="button"}X.onclick=function(){this.input.parentNode.removeChild(this.input);w.removeChild(this.parentNode);ac.addPlaceHolder();delete l[Y]};ag.dataset.basetype=Z[0]+" "+Z[1];if(aa){ag.style.marginLeft="5px"}ag.appendChild(document.createTextNode(V));ae.appendChild(document.createTextNode(W));if(!v){var ad=document.createElement("img");ad.src=Q+"ico_"+Z[0]+"_"+Z[1]+".png";ab.appendChild(ad)}ab.appendChild(ag);var ah=32,T=38;ag.style.maxWidth=w.parentNode.offsetWidth-(ah+T)+"px";ab.appendChild(X);if(aa){delete ae}else{ab.appendChild(ae)}w.appendChild(ab);z.parentNode.insertBefore(af,z);ab.style.backgroundColor=makeHexRgb(I);ab.startColor=I;ab.endColor=t;ab.pname=V;ab.fade=f;setTimeout(function(){ab.fade()},2000);l[Y]=true;if(jQuery("#eip_page").length){frameElement.height=(jQuery("#eip_page").height()>500)?500:jQuery("#eip_page").height()}};this.delPlaceHolder=function(){if(jQuery(".eip-placeholder",w).length>=1){jQuery(".eip-placeholder",w).remove()}};this.addPlaceHolder=function(W){var T=document.createElement("li"),V=W||getLabel("js-cms-eip-symlink-no-elements"),U="eip-placeholder";T.className=U;T.appendChild(document.createTextNode(V));if(jQuery("li",w).length<1){w.appendChild(T)}};var f=function(){if(this.fadeColor==undefined){this.fadeColor=[];this.fadeColor[0]=this.startColor[0];this.fadeColor[1]=this.startColor[1];this.fadeColor[2]=this.startColor[2]}if(Math.round(this.fadeColor[0]+this.fadeColor[1]+this.fadeColor[2])==Math.round(this.endColor[0]+this.endColor[1]+this.endColor[2])){return}this.fadeColor[0]+=(this.endColor[0]-this.startColor[0])/50;this.fadeColor[1]+=(this.endColor[1]-this.startColor[1])/50;this.fadeColor[2]+=(this.endColor[2]-this.startColor[2])/50;this.style.backgroundColor=makeHexRgb(this.fadeColor);var T=this;setTimeout(function(){T.fade()},20)};var A=function(){if(R){var T=jQuery(m).offset();R.style.width=m.clientWidth;R.style.top=T.top+m.offsetHeight;R.style.left=T.left;R.style.display=""}};var S=function(){if(R&&R.style.display!="none"){R.style.display="none";jQuery(document).unbind("mousemove",g)}};var g=function(T){if(!T){G=event.clientX+document.body.scrollLeft;F=event.clientY+document.body.scrollTop}else{G=T.pageX;F=T.pageY}return true};var k=function(T){return((T.firstChild&&T.firstChild.nodeType==3)?T.firstChild.nodeValue:T.nodeValue)||""};N()}var hex=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function makeHexRgb(b){var a="";for(var c=0;c<3;c++){a=a+hex[Math.floor(b[c]/16)]+hex[Math.floor(b[c]%16)]}return"#"+a}function changeParentControl(f,t,y,p,e){var h=this;var x=f;var p=(p instanceof Array)?p:[p];var F=(p instanceof Array)?"&hierarchy_types="+p.join(","):"";var d=t||null;var u=null;var I=null;var g=null;var a=null;var b=null;var G=null;var z=null;var q=0;var n=0;if(!y){var y={}}var w=y.iconsPath||"/images/cms/admin/mac/tree/";var C=y.fadeColorStart||[255,0,0];var H=y.fadeColorEnd||[255,255,255];var o=y.inputName||("changeParentInput"+x);var B=y.noImages||false;var k={};var s=e;var E=e?"":'&callback=changeParentControlsList["'+x+'"].moveItem';var D=function(){if(!window.changeParentControlsList){window.changeParentControlsList={}}window.changeParentControlsList[x]=h;u=document.getElementById("changeParentInput"+x);if(!u){alert("Change parent container #"+x+" not found");return}var J=document.createElement("input");J.type="hidden";J.name=o;u.parentNode.insertBefore(J,u);a=document.createElement("ul");u.appendChild(a);I=document.createElement("input");u.appendChild(I);g=B?document.createElement("input"):document.createElement("img");u.appendChild(g);I.type="text";if(B){g.type="button";g.value="?"}else{g.src="/images/cms/admin/mac/tree.png";g.height="18"}g.className="treeButton";g.onclick=function(){jQuery.openPopupLayer({name:"Sitetree",title:"Выбор страницы",width:620,height:335,url:"/styles/common/js/parents.html?id="+x+(d?"&module="+d:"")+F+(window.lang_id?"&lang_id="+window.lang_id:"")+E})};a.className="pageslist";I.onkeypress=function(L){var K=L?L.keyCode:window.event.keyCode;if(K==13){return false}};I.onkeyup=function(L){var K=L?L.keyCode:window.event.keyCode;switch(K){case 38:if(G.length&&(z>0||z==null)){j((z===null)?(G.length-1):(z-1))}break;case 40:if(G.length&&(z<(G.length-1)||z==null)){j((z===null)?0:(z+1))}break;case 13:m();r();return false;break;case 27:r();break;default:h.doSearch()}};I.onblur=function(){if(b){if(q<parseInt(b.style.left)||q>(parseInt(b.style.left)+parseInt(b.offsetWidth))||n<parseInt(b.style.top)||n>(parseInt(b.style.top)+parseInt(b.offsetHeight))){r()}}}};this.loadSuggestItems=function(J){jQuery.ajax({url:"/admin/content/load_tree_node.xml?limit&domain_id[]="+(window.domain_id?window.domain_id:"1")+F+(window.lang_id?"&lang_id="+window.lang_id:"")+"&search-all-text[]="+encodeURIComponent(J),type:"get",complete:function(L,K){h.updateSuggestItems(L)}})};this.updateSuggestItems=function(K){z=null;G=K.responseXML.getElementsByTagName("page");if(!G.length){return}var L=[];for(var M=0;M<G.length;M++){if(k[G[M].getAttribute("id")]){continue}L[L.length]=G[M]}G=L;var N=null;if(!b){b=document.createElement("div");b.className="symlinkAutosuggest";var P=jQuery(I).offset();b.style.position="absolute";b.style.zIndex=1050;b.style.width=I.clientWidth+"px";b.style.top=(P.top+I.offsetHeight)+"px";b.style.left=P.left+"px";N=document.createElement("ul");b.appendChild(N);document.body.appendChild(b)}l();jQuery(document).mousemove(v);N=b.firstChild;while(N.firstChild){N.removeChild(N.firstChild)}for(M=0;M<G.length;M++){if(k[G[M].getAttribute("id")]){continue}var J=c(G[M].getElementsByTagName("name")[0]);var O=c(G[M].getElementsByTagName("basetype")[0]);var Q=G[M].getAttribute("link");var T=document.createElement("li");var S=document.createElement("span");var R=document.createElement("a");T.title=J;if(J.length>20){J=J.substr(0,20)+"..."}T.appendChild(document.createTextNode(J));T.appendChild(S);T.appendChild(document.createElement("br"));T.appendChild(R);S.appendChild(document.createTextNode(" ("+O+")"));R.href=Q;R.target="_blank";if(Q.length>170){Q=Q.substr(0,170)+"..."}R.appendChild(document.createTextNode(Q));T.onmouseover=function(){j(this.suggestIndex)};T.onclick=function(){m();r()};T.suggestIndex=M;N.appendChild(T)}};this.doSearch=function(){var J=I.value;h.loadSuggestItems(J)};var j=function(K){if(b.style.display!="none"){var L=b.firstChild;var J=L.childNodes.item(z);if(J){J.className=""}L.childNodes.item(K).className="active";z=K}};var m=function(){if(b&&b.style.display!="none"&&z!==null){var J=G[z].getAttribute("id");if(s){h.addItem(J)}else{h.moveItem(J)}}};this.addItem=function(J){jQuery.ajax({url:"/admin/content/tree_copy_element.json",type:"get",dataType:"json",data:{element:window.page_id,rel:J,copyAll:1,return_copies:1,clone_mode:0},success:function(K){pageCopy=K.data.page.copies.copy[0];linkText=document.createElement("span");for(i in pageCopy.parents.item){parentItem=pageCopy.parents.item[i];var L=document.createElement("a");L.href="/admin/"+parentItem.module+"/"+parentItem.method+"/";L.target="_blank";L.className="tree_link";L.onclick=function(){return treeLink(parentItem.settingsKey,parentItem.treeLink)};L.title=parentItem.url;L.appendChild(document.createTextNode(parentItem.name));linkText.appendChild(L);linkText.appendChild(document.createTextNode(" / "))}var L=document.createElement("a");L.href=pageCopy["edit-link"];L.title=pageCopy.url;L.appendChild(document.createTextNode(pageCopy.name));linkText.appendChild(L);h.loadItem(pageCopy.id,linkText,pageCopy.basetype)}})};this.moveItem=function(J){if(window.page_id==J){return false}jQuery.ajax({url:"/admin/content/tree_move_element.json",type:"get",dataType:"json",data:{element:window.page_id,rel:J,return_copies:1},success:function(K){pageCopy=K.data.page.copies.copy[0];linkText=document.createElement("span");for(i in pageCopy.parents.item){parentItem=pageCopy.parents.item[i];var L=document.createElement("a");L.href="/admin/"+parentItem.module+"/"+parentItem.method+"/";L.target="_blank";L.className="tree_link";L.onclick=function(){return treeLink(parentItem.settingsKey,parentItem.treeLink)};L.title=parentItem.url;L.appendChild(document.createTextNode(parentItem.name));linkText.appendChild(L);linkText.appendChild(document.createTextNode(" / "))}var L=document.createElement("span");L.title=pageCopy.url;L.appendChild(document.createTextNode(pageCopy.name));linkText.appendChild(L);h.loadItem(pageCopy.id,linkText,pageCopy.basetype)}})};this.loadItem=function(M,O,N){if((k[M]!==undefined)&&s){return}var P=document.createElement("li");if(s){var K=document.createElement("a");if(B){K.appendChild(document.createTextNode("[x]"))}else{var J=document.createElement("img");J.src=w+"symlink_delete.png";J.alt="delete";K.appendChild(J)}K.href="javascript:void(0);";K.className="button";K.onclick=function(){jQuery.ajax({url:"/admin/content/tree_delete_element.xml",type:"get",dataType:"xml",data:{element:M,childs:1,allow:true},context:this,success:function(){a.removeChild(this.parentNode);delete k[M]}})};P.appendChild(K)}if(!B){var R=document.createElement("img");R.src=w+"ico_"+N.module+"_"+N.method+".png";P.appendChild(R)}var L=O.innerText||O.textContent;if(L.length>170){newTitle=O.innerText;lastChildText=O.lastChild.innerText||O.lastChild.textContent;if(lastChildText.length>100){lastChildText=lastChildText.substr(0,96)+"...";if(O.lastChild.innerText){O.lastChild.innerText=lastChildText}else{O.lastChild.textContent=lastChildText}L=O.innerText||O.textContent}if(L.length>170){while(L.length>170&&O.childNodes.length>3){dropLink=parseInt(O.childNodes.length/2);dropLink=dropLink-(dropLink%2);O.removeChild(O.childNodes[dropLink]);O.removeChild(O.childNodes[(dropLink-1)]);L=O.innerText||O.textContent}var Q=document.createElement("span");Q.title=newTitle;if(L.length<=170){dropLink=parseInt(O.childNodes.length/2);dropLink=dropLink-(1-dropLink%2);Q.appendChild(document.createTextNode(" / ... /"))}else{O.removeChild(O.childNodes[0]);dropLink=0;Q.appendChild(document.createTextNode("... /"))}O.replaceChild(Q,O.childNodes[dropLink])}}P.appendChild(O);if(!s&&a.lastChild){a.removeChild(a.lastChild)}a.appendChild(P);P.style.backgroundColor=makeHexRgb(C);P.startColor=C;P.endColor=H;P.pname=O;P.fade=A;setTimeout(function(){P.fade()},2000);k[M]=true;if(jQuery("#eip_page").length){frameElement.height=(jQuery("#eip_page").height()>500)?500:jQuery("#eip_page").height()}};var A=function(){if(this.fadeColor==undefined){this.fadeColor=[this.startColor[0],this.startColor[1],this.startColor[2]]}if(Math.round(this.fadeColor[0]+this.fadeColor[1]+this.fadeColor[2])==Math.round(this.endColor[0]+this.endColor[1]+this.endColor[2])){return}this.fadeColor[0]+=(this.endColor[0]-this.startColor[0])/50;this.fadeColor[1]+=(this.endColor[1]-this.startColor[1])/50;this.fadeColor[2]+=(this.endColor[2]-this.startColor[2])/50;this.style.backgroundColor=makeHexRgb(this.fadeColor);var J=this;setTimeout(function(){J.fade()},20)};var l=function(){if(b){var J=jQuery(I).offset();b.style.width=I.clientWidth;b.style.top=J.top+I.offsetHeight;b.style.left=J.left;b.style.display=""}};var r=function(){if(b&&b.style.display!="none"){b.style.display="none";jQuery(document).unbind("mousemove",v)}};var v=function(J){if(!J){q=event.clientX+document.body.scrollLeft;n=event.clientY+document.body.scrollTop}else{q=J.pageX;n=J.pageY}return true};var c=function(J){return(J.firstChild&&J.firstChild.nodeType==3)?J.firstChild.nodeValue:J.nodeValue};D()}function permissionsControl(a){var e=this;var o=document.getElementById(a);var u=null;var n=null;var g={};var w=0;var q=null;var b=null;var v=null;var s=null;var l=0;var k=0;var x=[getLabel("js-permissions-view"),getLabel("js-permissions-edit"),getLabel("js-permissions-create"),getLabel("js-permissions-delete"),getLabel("js-permissions-move")];var r=function(){var H=document.createElement("table");var C=document.createElement("tr");var z=document.createElement("th");z.style.width="100%";z.appendChild(document.createTextNode(" "));C.appendChild(z);var E=["i-see","i-edit","i-add","i-remove","i-copy-other"];for(var A=0;A<x.length;A++){z=document.createElement("th");var B=document.createElement("i");B.className="small-ico "+E[A];B.alt=B.title=x[A];z.appendChild(B);z.className="permissionType";C.appendChild(z)}H.className="permissionTable btable btable-striped";var y=document.createElement("tr");var G=document.createElement("td");G.colspan=6;G.setAttribute("colspan","6");G.className="addOwner";y.appendChild(G);n=document.createElement("input");n.className="default";n.placeholder=getLabel("js-user-search-placeholder");n.style.width="50%";G.appendChild(n);n.onkeypress=function(J){var I=J?J.keyCode:window.event.keyCode;if(I==13){return false}};n.onkeyup=t;n.onblur=d;u=document.createElement("tbody");var D=document.createElement("thead");D.appendChild(C);var F=document.createElement("tfoot");F.appendChild(y);H.appendChild(D);H.appendChild(u);H.appendChild(F);o.appendChild(H);e.add("system-guest","",0)};this.add=function(A,z,y,G){var E={};E.id=A;E.name=z;E.level=y;if(A=="system-guest"){w=y;z="Все"}else{if(y==w&&!G){return}}if(A=="system-supervisor"||A=="users-users-15"){return}g[A]=E;var K=document.createElement("tr");var F=document.createElement("td");var J=document.createElement("img");J.src="/images/cms/admin/mac/perm_user.png";F.appendChild(document.createTextNode(z));K.appendChild(F);var D=[1,2,4,8,16];var B=["perms_read","perms_edit","perms_create","perms_delete","perms_move"];for(var H=0;H<D.length;H++){var I=document.createElement("div");I.className="checkbox";var C=document.createElement("input");C.type="checkbox";C.name=B[H]+"["+A+"]";C.value=D[H];C.title=x[H];I.appendChild(C);F=document.createElement("td");F.appendChild(I);F.className="permissionType";K.appendChild(F);if(y&D[H]){I.classList.add("checked");C.checked=true}}if(A=="system-guest"&&q){u.replaceChild(K,q)}else{u.appendChild(K)}$(K).find(".checkbox").click(function(){$(this).toggleClass("checked")});if(A=="system-guest"){q=K}};this.loadItems=function(y){jQuery.ajax({url:"/admin/users/getPermissionsOwners/4.xml?limit&search-all-text[]="+encodeURIComponent(y),method:"get",complete:function(z){e.updateItems(z)}})};this.updateItems=function(A){s=null;v=A.responseXML.getElementsByTagName("owner");var C=[];if(!v.length){return}for(var D=0;D<v.length;D++){var z=parseInt(v[D].getAttribute("id"));if(g[z]==undefined){C[C.length]=v[D]}}v=C;if(!v.length){return}var F=null;if(!b){b=document.createElement("div");b.className="symlinkAutosuggest";var H=jQuery(n).offset();b.style.position="absolute";b.style.zIndex=1050;b.style.width=n.clientWidth+"px";b.style.top=(H.top+n.offsetHeight)+"px";b.style.left=H.left+"px";F=document.createElement("ul");b.appendChild(F);document.body.appendChild(b)}h();jQuery(document).mousemove(p);F=b.firstChild;while(F.firstChild){F.removeChild(F.firstChild)}var E=0;for(D=0;D<v.length;D++){var K=v[D].getAttribute("name");var J=document.createElement("li");var G=document.createElement("img");G.src="/images/cms/admin/mac/perm_"+v[D].getAttribute("type")+".png";J.appendChild(G);J.appendChild(document.createTextNode(K));if(v[D].getAttribute("type")=="group"){J.appendChild(document.createElement("br"));var I=document.createElement("span");J.appendChild(I);var y=v[D].getElementsByTagName("user");var L="";for(var B=0;B<y.length;B++){L=L+(B?", ":"")+y[B].getAttribute("name")}I.appendChild(document.createTextNode(L))}J.onmouseover=function(){f(this.suggestIndex)};J.onmouseout=function(){this.className=""};J.onclick=function(){j();m();n.value=""};J.suggestIndex=E;F.appendChild(J);E++}};this.doSearch=function(){var y=n.value;e.loadItems(y)};var f=function(z){if(b.style.display!="none"){var A=b.firstChild;var y=A.childNodes.item(s);if(y){y.className=""}A.childNodes.item(z).className="active";s=z}};var j=function(){if(b&&b.style.display!="none"&&s!==null){var A=v[s].getAttribute("id");var y=v[s].getAttribute("name");var z=v[s].getAttribute("type");if(z!="user"){e.add(A,y,w,true)}else{jQuery.ajax({url:"/udata/users/getUserPermissions/"+A+"/"+window.page_id+"/",method:"get",complete:function(C){var B=C.responseXML.getElementsByTagName("user");var D=w;if(B.length){D=parseInt(jQuery(B[0]).text())}e.add(A,y,D,true)}})}}};var d=function(){if(b){if(l<parseInt(b.style.left)||l>(parseInt(b.style.left)+parseInt(b.offsetWidth))||k<parseInt(b.style.top)||k>(parseInt(b.style.top)+parseInt(b.offsetHeight))){m()}}};var t=function(z){var y=z?z.keyCode:window.event.keyCode;switch(y){case 38:if(v.length&&(s>0||s==null)){f((s===null)?(v.length-1):(s-1))}break;case 40:if(v.length&&(s<(v.length-1)||s==null)){f((s===null)?0:(s+1))}break;case 13:j();m();return false;break;case 27:m();break;default:e.doSearch()}};var h=function(){if(b){var y=jQuery(n).offset();b.style.width=n.clientWidth;b.style.top=y.top+n.offsetHeight;b.style.left=y.left;b.style.display=""}};var m=function(){if(b&&b.style.display!="none"){b.style.display="none";jQuery(document).unbind("mousemove",p)}};var p=function(y){if(!y){l=event.clientX+document.body.scrollLeft;k=event.clientY+document.body.scrollTop}else{l=y.pageX;k=y.pageY}return true};var c=function(y){return(y.firstChild&&y.firstChild.nodeType==3)?y.firstChild.nodeValue:y.nodeValue};r()}function fileControl(name,options){var _self=this;var container=document.getElementById("fileControlContainer_"+name);var select=null;var selectize=null;var inputName=options.inputName||name;var imagesOnly=options.imagesOnly||false;var videosOnly=options.videosOnly||false;var folderHash=options.folderHash;var fileHash=options.fileHash;var lang=options.lang||"ru";var fm=options.fm||"flash";var cwd=".";var defaultCwd=".";var loaded=false;var onGetFileFunction=(typeof options.onGetFileFunction=="string")?options.onGetFileFunction:null;var construct=function(){select=document.createElement("select");container.appendChild(select);select.onmouseover=function(){if(!loaded){loadListing()}};window["fileControlSelect_"+name]=select;select.id="fileControlSelect_"+name;select.name=inputName;select.control=_self;select.className="fileControlSelect layout-col-control default";if((navigator.userAgent.toLowerCase().indexOf("firefox")!=-1)||(navigator.userAgent.toLowerCase().indexOf("chrome")!=-1)){select.addEventListener("drop",doDrop,false);select.addEventListener("dragexit",dragExit,false);select.addEventListener("dragover",dragExit,false);jQuery(select).addClass("dragNDrop")}var option=document.createElement("option");option.innerHTML="";option.value="";option.selected=true;select.appendChild(option);var btm=['<div class="layout-col-icon">','<a class="icon-action" href="javascript:void(0);">','<i class="small-ico i-choose"></i>',"</a>","</div>"].join("");btm=$(btm);$("a",btm).bind("click",function(){var functionName="show"+fm+"FileBrowser";eval(functionName+"(select.id, defaultCwd, imagesOnly, videosOnly, folderHash, fileHash, lang, onGetFileFunction)")});$("#fileControlContainer_"+name).append(btm);selectize=$("select#fileControlSelect_"+name).selectize({allowEmptyOption:true,create:false,hideSelected:true});selectize=selectize[0].selectize};function doDrop(event){dragExit(event);var dt=event.dataTransfer;var files=dt.files;var file=files[0];jQuery.ajax({url:"/admin/data/uploadfile/?filename="+file.name+"&folder="+base64encode(cwd.substr(1))+(imagesOnly?"&showOnlyImages=1":"")+(videosOnly?"&showOnlyVideos=1":""),type:"POST",processData:false,data:file,complete:function(r,t){_self.updateItem(r)}})}function dragExit(event){event.stopPropagation();event.preventDefault()}var showflashFileBrowser=function(selectId,folder,imageOnly,videoOnly,folder_hash,file_hash,lang){var qs="id="+selectId;var index=0;var file=cwd.replace(/^\.\//,"/")+((index=select.value.lastIndexOf("/"))!=-1?select.value.substr(index):select.value);qs=qs+"&file="+file;if(folder){qs=qs+"&folder="+folder}if(imageOnly){qs=qs+"&image=1"}if(videoOnly){qs=qs+"&video=1"}jQuery.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:1200,height:600,url:"/styles/common/other/filebrowser/umifilebrowser.html?"+qs})};var showelfinderFileBrowser=function(selectId,folder,imageOnly,videoOnly,folder_hash,file_hash,lang,onGetFileFunction){var qs="id="+selectId;var index=0;var file=cwd.replace(/^\.\//,"/")+((index=select.value.lastIndexOf("/"))!=-1?select.value.substr(index):select.value);qs=qs+"&file="+file;if(folder){qs=qs+"&folder="+folder}if(imageOnly){qs=qs+"&image=1"}if(videoOnly){qs=qs+"&video=1"}if(typeof(folder_hash)!="undefined"){qs=qs+"&folder_hash="+folder_hash}if(typeof(file_hash)!="undefined"){qs=qs+"&file_hash="+file_hash}if(lang){qs=qs+"&lang="+lang}if(onGetFileFunction){qs=qs+"&onGetFile="+onGetFileFunction}$.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:1200,height:600,url:"/styles/common/other/elfinder/umifilebrowser.html?"+qs});var filemanager=jQuery("div#popupLayer_Filemanager div.popupBody");if(!filemanager.length){filemanager=jQuery(window.parent.document.getElementById("popupLayer_Filemanager")).find("div.popupBody")}var options='<div id="watermark_wrapper"><label for="add_watermark">';options+=getLabel("js-water-mark");options+='</label><input type="checkbox" name="add_watermark" id="add_watermark"/>';options+='<label for="remember_last_folder">';options+=getLabel("js-remember-last-dir");options+='</label><input type="checkbox" name="remember_last_folder" id="remember_last_folder"';if(getCookie("remember_last_folder",true)){options+='checked="checked"'}options+="/></div>";filemanager.append(options)};this.clearItems=function(){var value=cwd+"/";selectize.lock();selectize.clear();selectize.clearOptions();selectize.addOption({text:"/",value:value});selectize.addItem(value,true);selectize.unlock();loaded=false};var loadListing=function(){loaded=true;jQuery.ajax({url:"/admin/data/getfilelist/?folder="+base64encode(cwd.substr(1))+(imagesOnly?"&showOnlyImages=1":"")+(videosOnly?"&showOnlyVideos=1":""),type:"get",complete:function(r,t){_self.updateItems(r)}})};this.updateItems=function(response){if(!response.responseXML.getElementsByTagName("empty").length){var files=response.responseXML.getElementsByTagName("file");if(!select.options.length){this.add(null,true)}for(var i=0;i<files.length;i++){this.add(files[i].getAttribute("name"))}if(jQuery.browser.msie){var d=select.style.display;select.style.display="none";select.style.display=d}}else{var option=document.createElement("option");option.value="";option.disabled="disable";option.appendChild(document.createTextNode(getLabel("js-files-use_search")));select.appendChild(option)}};this.setFolder=function(name,isDefault){if(name.indexOf("./")!==0){name="."+name}var re=new RegExp("[/]+$","g");name=(name+"").replace(re,"");if(cwd!=name){cwd=name;this.clearItems()}if(isDefault!=undefined&&isDefault){defaultCwd=name}};this.add=function(name,selected){if(name&&!name.length){return}if(!name){name=""}if(name.lastIndexOf("/")!=-1){this.setFolder(name.substr(0,name.lastIndexOf("/")));name=name.substr(name.lastIndexOf("/")+1)}var value=((cwd.indexOf("./")!=0)?".":"")+(cwd+"/"+name);selectize.addOption({text:name,value:value});selectize.addItem(value,true)};this.updateItem=function(response){var files=response.responseXML.getElementsByTagName("file");if(!select.options.length){this.add(null,true)}for(var i=0;i<files.length;i++){this.add(files[i].getAttribute("name"),true)}if(jQuery.browser.msie){var d=select.style.display;select.style.display="none";select.style.display=d}};construct()}(function(){var a=function(){$.get("/umess/inbox/?mark-as-opened=1",function(b){$("message",b).each(function(d,g){var h=$(g).attr("title");var f=$("content",g).text();var c=$("date",g).text();var e=$("sender",g).attr("name");f="<p>"+f+'</p><div class="header">'+c+", "+e+"</div>";$.jGrowl(f,{header:h,life:10000})})});setTimeout(a,15000)}})();var askSupport=function(){$.get("/styles/skins/modern/design/js/common/html/supportRequestPopup.html",function(d){c(d);b()});var c=function(d){openDialog("",getLabel("js-ask-support"),{stdButtons:false,html:d,width:700,openCallback:function(){$("#stop_btn").bind("click",function(){closeDialog()})},confirmCallback:function(){}})};var b=function(){$.ajax({type:"POST",url:"/udata/system/checkLicenseKey/",dataType:"xml",success:function(n){$("#form_body").html("");$("#loading").html("");var r="";var m=n.getElementsByTagName("error");if(m.length){$("#ask_support_form").remove();r=m[0].firstChild.nodeValue}var k=n.getElementsByTagName("notes");if(k.length){r+=k[0].firstChild.nodeValue}$("#license_message").html(r);var d=n.getElementsByTagName("form");if(!d.length){return}var f=n.getElementsByTagName("user");$("#form_body").html('<form id="support_request" action="" method="post" enctype="multipart/form-data">'+d[0].firstChild.nodeValue+"</form>");$('input[name="data[fio_frm]"]').val(f[0].getAttribute("name"));$("#email_frm").val(f[0].getAttribute("email"));$("#server_credentials").val(localStorage.getItem("serverCredentials"));var o=$('input[name="data[cms_domain]"]').parent();$('input[name="data[cms_domain]"]').remove();var l=document.createElement("select");l.name="data[cms_domain]";var q=n.getElementsByTagName("domains");for(var g=0;g<q[0].getElementsByTagName("domain").length;g++){var e=q[0].getElementsByTagName("domain");e=e[g];var h=document.createElement("option");h.value=e.getAttribute("host");if(e.getAttribute("host")==f[0].getAttribute("domain")){h.selected=true}h.appendChild(document.createTextNode(e.getAttribute("host")));l.appendChild(h)}o.append(l);$("#attach_file").parent("div");$(".button_1").remove();$("#checkLicenseKey").attr("style","");$("#show_info").attr("style","display:inline-block;");$("#show_info").click(function(){$("#info_support").slideToggle("slow")});$.centerPopupLayer();var j=$("#license_wrapper");var p=$("#support_request > div",j).addClass("col-md-6").last();p.removeClass("col-md-6").addClass("col-md-12");$("input[type=text]",j).addClass("default");$(".asterisk",j).parent(":contains(обязательные)").remove();$("select",j).selectize();$("#server_credentials").focusout(function(){localStorage.setItem("serverCredentials",$(this).val())});$("#checkLicenseKey").bind("click",a)},error:function(d,f,e){if(window.session){window.session.stopAutoActions()}}})};var a=function(){$.ajax({type:"POST",url:"/udata/system/sendSupportRequest/",data:new FormData($("#support_request")[0]),cache:false,contentType:false,processData:false,success:function(f){var e;$("#loading").html("");var d=f.getElementsByTagName("error");if(d.length){e='<span style="color:red;">'+d[0].firstChild.nodeValue+"</span>"}var g=f.getElementsByTagName("success");if(g.length){e=g[0].firstChild.nodeValue;$("#ask_support_form").remove();$("#checkLicenseKey").remove()}$("#license_message").html(e);$.centerPopupLayer()}})}};function colorControl(c,b){var b=b||{};var e={colorBox:'<span class="color-box"><i></i></span>',container:c,assets:{js:"/js/jquery/colorpicker/js/bootstrap-colorpicker.js",jsMin:"/js/jquery/colorpicker/js/bootstrap-colorpicker.min.js",css:"/js/jquery/colorpicker/css/bootstrap-colorpicker.min.css"}};var a={options:{defaultValues:{component:".color-box",customClass:"color-picker"},user:b.pickerOptions||{}}};jQuery.extend(a.options.user,a.options.defaultValues);jQuery.extend(b,e);jQuery(b.colorBox).insertAfter(jQuery("input",c));if(typeof jQuery.colorpicker!=="function"){if(b.debug){d(b.assets.js,b.assets.css)}else{d(b.assets.jsMin,b.assets.css)}}jQuery(b.container).colorpicker(a.options.user);function d(g,f){jQuery('<script src="'+g+'" type="text/javascript" charset="utf-8"><\/script>').appendTo("head");jQuery('<link href="'+f+'" rel="stylesheet" charset="utf-8"><\/script>').appendTo("head")}}var CatalogModule;CatalogModule=(function(C,Y){var j="catalog";var I="/admin/";var d="addTradeOffer";var o="copyTradeOffer";var e="changeTradeOfferListActivity";var R="deleteTradeOfferList";var u="addTradeOfferPriceType";var S="deleteTradeOfferPriceTypeList";var g=getLabel("js-label-request-error");var T=function(ab,aa,ac,ah,Z){Z=Z||"";var ag=ab;var ae=Z.split("::").join("-");var ad={idPrefix:"",treeURL:"/styles/skins/modern/design/js/common/parents.html",inputWidth:"100%",popupTitle:getLabel("js-choose-category")};var af=function(){var ai=C.extend(ah,ad);ag.symlinkControl=new symlinkControl(aa,ac,ae,ai,Z);ag.id=aa;ag.container=ag.symlinkControl.container;ag.itemsContainer=C(".items-list",ag.container).get(0);C("li i",ag.itemsContainer).each(function(){var ak=C(this);var al=ak.parent();var aj=al.attr("umi:id");c(ak,aj,al)})};af()};var H=function(){return(uAdmin.data&&uAdmin.data.page?uAdmin.data.page.id:window.page_id)};var w=function(ac){var ab=ac.parents.item;var aa;var ad=document.createElement("span");ad.className="paths";for(var Z in ab){if(!ab.hasOwnProperty(Z)){continue}aa=ab[Z];ad.appendChild(r(aa))}ad.appendChild(F(ac));return ad};var r=function r(aa){var Z=document.createElement("a");Z.href="/admin/"+aa.module+"/"+aa.method+"/";Z.className="tree_link";Z.target="_blank";Z.title=aa.url;Z.appendChild(document.createTextNode(aa.name));C(Z).bind("click",function(){return treeLink(aa.settingsKey,aa.treeLink)});return Z};var F=function(aa){var Z=document.createElement("span");Z.title=aa.url;Z.appendChild(document.createTextNode(aa.name));return Z};var v=function(ag,af,ab,ae){var Z=ab||H(),ad=(Control.HandleItem!==null)?Control.HandleItem.control.selectedList:[],ac;af=typeof af=="function"?af:function(){};if(!Z||!ag||Z==ag){return}var aa=ae?1:0;ac={element:Z,rel:ag,return_copies:true,to_end:aa};if(Y.keys(ad).length>0){ac.selected_list=[];Y.each(ad,function(ah){ac.selected_list.push(ah.id)})}C.ajax({url:"/admin/content/tree_move_element.json",type:"get",dataType:"json",data:ac,success:function(ah){af(ah)}})};function q(ac,ab,Z,aa){T(this,ac,ab,Z,aa)}q.prototype.moveItem=function(ac,ab){var Z=this;var aa=ab?1:0;v(ac,function(ad){if(!ad.data||!ad.data.page){return}var ag=ad.data.page.copies.copy[0];var af=w(ag);var ae=C("li",Z.itemsContainer).eq(0);ae.html("");ae.append(af)},null,aa)};q.prototype.getId=L.prototype.getId=function(){return this.id};function L(ac,ab,Z,aa){T(this,ac,ab,Z,aa)}L.prototype.addCopy=function(ab){var aa=H();var Z=this;if(!aa||!ab||aa==ab){return}C.ajax({url:"/admin/content/tree_copy_element.json",type:"get",dataType:"json",data:{element:aa,rel:ab,copyAll:1,return_copies:1,clone_mode:0},success:function(ac){if(!ac.data||!ac.data.page){return}var ag=ac.data.page.copies.copy[0];var af=w(ag);var ad=C(document.createElement("i"));ad.attr("class","small-ico i-remove virtual-copy-delete");var ae=C(document.createElement("li"));ae.attr("umi:id",ag.id);c(ad,ag.id,ae);if(ag.basetype){ae.attr("umi:module",ag.basetype.module);ae.attr("umi:method",ag.basetype.method)}ae.append(ad);ae.append(af);C(Z.itemsContainer).append(ae)}})};var M=[];function c(aa,Z,ab){aa.on("click",function(){C.ajax({url:"/admin/content/tree_delete_element.xml?csrf="+csrfProtection.getToken(),type:"get",dataType:"xml",data:{element:Z,childs:1,allow:true},context:this,success:function(){ab.remove()}})})}function Q(Z){return M[Z]}function X(Z){return M[Z.getId()]=Z}function n(ab){var af="SiteTree";var aa=getLabel("js-choose-category");var ae="/styles/skins/modern/design/js/common/parents.html";var ad="catalog";var ac="&hierarchy_types=catalog-category";var Z="";jQuery.openPopupLayer({name:af,title:aa,width:"100%",height:335,url:ae+"?id="+(ab.id)+(ad?"&module="+ad:"")+"&name="+af+ac+(window.lang_id?"&lang_id="+window.lang_id:"")+(Z?"&root_id="+Z:"")+"&mode=tree"})}var f=function(){return{add:{name:"add",className:"i-add",hint:getLabel("js-add"),init:function(aa){var Z=dc_application.getToolBar();if(U()){return Z.disableButtons(aa)}Z.enableButtons(aa)},release:function(){G();return false}},copy:{name:"copy",className:"i-copy",hint:getLabel("js-copy"),init:function(aa){var Z=dc_application.getToolBar();if(!V()){return Z.disableButtons(aa)}Z.enableButtons(aa)},release:function(){m();return false}},activate:{name:"activate",className:"i-vision",hint:getLabel("js-activate"),init:function(aa){var Z=dc_application.getToolBar();if(!U()){return Z.disableButtons(aa)}var ab="i-vision";var ac=getLabel("js-activate");if(y()){ab="i-hidden";ac=getLabel("js-deactivate")}aa.className=ab;aa.hint=ac;Z.renderButton(aa);Z.enableButtons(aa)},release:function(){D();return false}},remove:{name:"delete",className:"i-remove",hint:getLabel("js-remove"),init:function(aa){var Z=dc_application.getToolBar();if(!U()){return Z.disableButtons(aa)}Z.enableButtons(aa)},release:function(){A();return false}}}};var U=function(){return dc_application.toolbar.selectedItemsCount!==0};var G=function(){var Z={type:"POST",url:z(d),dataType:"json",data:{csrf:k(),object_id:N(),field_name:J()}};h(Z,function(){dc_application.refresh()},B)};var N=function(){return window.object_id};var J=function(){return dc_application.config.attributes.param};var m=function(){var Z={type:"POST",url:z(o),dataType:"json",data:{csrf:k(),offer_id:b(),object_id:N(),field_name:J()}};h(Z,function(){dc_application.refresh()},B)};var A=function(){var Z={type:"POST",url:z(R),dataType:"json",data:{csrf:k(),offer_id_list:a()}};h(Z,function(){dc_application.refresh()},B)};var D=function(){var Z={type:"POST",url:z(e),dataType:"json",data:{csrf:k(),offer_id_list:a(),is_active:Number(!y())}};h(Z,function(){dc_application.refresh()},B)};var z=function(Z){return I+window.pre_lang+j+"/"+Z+"/.json"};var h=function(ac,Z,ab){var aa=C.ajax(ac);aa.success(function(ad){if(E(ad)){return ab(ad.data.error)}if(O(ad)){return ab(ad.message)}Z(ad)});aa.error(function(ad){var ae=g;if(ad.status===403&&ad.responseJSON&&ad.responseJSON.data&&ad.responseJSON.data.error){ae=ad.responseJSON.data.error}ab(ae)})};var E=function(Z){return !Y.isUndefined(Z.data)&&!Y.isUndefined(Z.data.error)};var O=function(Z){return !Y.isUndefined(Z.code)&&!Y.isUndefined(Z.trace)&&!Y.isUndefined(Z.message)};var B=function(Z){C.jGrowl(Z)};var k=function(){return csrfProtection.token};var V=function(){return dc_application.toolbar.selectedItemsCount===1};var b=function(){return dc_application.unPackId(K().attributes.id)};var a=function(){var Z=[];Y.each(l(),function(aa){Z.push(dc_application.unPackId(aa.attributes.id))});return Z};var K=function(){return dc_application.toolbar.selectedItems[0]};var y=function(){return K().attributes.is_active};var l=function(){return dc_application.toolbar.selectedItems};var t=function(){return["add","copy","activate","remove"]};var P=function(aa,Z,ab){if(ab==="child"){return false}return ab};var x=function(){return{add:{name:"add",className:"i-add",hint:getLabel("js-add"),init:function(aa){var Z=dc_application.getToolBar();if(U()){return Z.disableButtons(aa)}Z.enableButtons(aa)},release:function(){W();return false}},remove:{name:"delete",className:"i-remove",hint:getLabel("js-remove"),init:function(aa){var Z=dc_application.getToolBar();if(!U()){return Z.disableButtons(aa)}Z.enableButtons(aa)},release:function(){p();return false}}}};var s=function(){return["add","remove"]};var W=function(){var Z={type:"POST",url:z(u),dataType:"json",data:{csrf:k()}};h(Z,function(){dc_application.refresh()},B)};var p=function(){var Z={type:"POST",url:z(S),dataType:"json",data:{csrf:k(),price_type_id_list:a()}};h(Z,function(){dc_application.refresh()},B)};return{ElementMovingControl:q,CopyCreatingControl:L,getControl:Q,addControl:X,openCategoriesWindow:n,moveItem:v,getTradeOfferListToolBarFunctions:f,getTradeOfferListToolBarMenu:t,getDragAndDropValidator:P,getTradeOfferPriceTypeListToolBarFunction:x,getTradeOfferPriceTypeListToolBarMenu:s}})(jQuery,_);var SeoModule=(function(H,af){var j="seo";var N="/admin/";var p="getLinkSources";var v="indexLinks";var q="checkLinks";var D="addSite";var O="verifySite";var f="addSiteMap";var W="deleteSite";var J="getSiteInfo";var C=getLabel("js-label-step-linksGrabber");var t=getLabel("js-label-step-linksChecker");var g=getLabel("js-label-request-error");var R="findBadLinks";var U="badLinksSearchInfo";var c="loading-wrapper";var E="cancel-button";var ac="bad-links-search-template";var Z="bad-link-sources-template";H(function(){P();u()});var u=function(){H("#"+R).on("click",M)};var P=function(){H("div.seo_chart canvas").each(function(){new Chart(this.getContext("2d"),window[this.id+"config"])})};var L=function(ag){ab(ag,x)};var M=function(){S();var ai=d();var ag=A;var ah=aa;o(ai,ag,ah)};var d=function(ah){var ai=a();if(af.isUndefined(ah)){return ai.shift()}var aj=ai.indexOf(ah);var ag=aj+1;return ai[ag]};var a=function(){return[C,t]};var o=function(ak,ag,ah){var aj=k(ak);var ai={type:"POST",url:N+j+"/"+aj+"/.json",dataType:"json",data:{csrf:l()}};e(ai,ag,ah)};var w=function(ah){var ag={type:"POST",url:N+j+"/"+D+"/.json",dataType:"json",data:{csrf:l(),domain_id:ah}};e(ag,function(){dc_application.refresh()},F)};var y=function(ah){var ag={type:"POST",url:N+j+"/"+O+"/.json",dataType:"json",data:{csrf:l(),site_id:ah}};e(ag,function(){dc_application.refresh()},F)};var h=function(ah){var ag={type:"POST",url:N+j+"/"+f+"/.json",dataType:"json",data:{csrf:l(),site_id:ah}};e(ag,function(){dc_application.refresh()},F)};var Y=function(ah){var ag={type:"POST",url:N+j+"/"+W+"/.json",dataType:"json",data:{csrf:l(),site_id:ah}};e(ag,function(){dc_application.refresh()},F)};var T=function(ag){document.location.href=N+j+"/"+J+"/"+ag+"/"};var G=function(){return dc_application.unPackId(Q().attributes.id)};var Q=function(){return dc_application.toolbar.selectedItems[0]};var n=function(){return dc_application.toolbar.selectedItemsCount===1};var B=function(ag){var ah=Q();return(typeof ah==="object")?ah.attributes[ag]:""};var X=function(){return{view:{name:"view",className:"i-vision",hint:getLabel("js-label-yandex-button-view"),init:function(ag){if(!n()){return dc_application.toolbar.disableButtons(ag)}var ah=B("status_code");if(ah==="OK"){dc_application.toolbar.enableButtons(ag)}else{dc_application.toolbar.disableButtons(ag)}},release:function(){T(G());return false}},add:{name:"add",className:"i-add",hint:getLabel("js-label-yandex-button-add"),init:function(ag){if(!n()){return dc_application.toolbar.disableButtons(ag)}var ah=B("status_code");if(ah==="NOT_ADDED"){dc_application.toolbar.enableButtons(ag)}else{dc_application.toolbar.disableButtons(ag)}},release:function(){w(G());return false}},verify:{name:"verify",className:"i-edit",hint:getLabel("js-label-yandex-button-verify"),init:function(ag){if(!n()){return dc_application.toolbar.disableButtons(ag)}var ai=B("verify_code");var ah=B("status_code");if(ai==="VERIFIED"||ai==="IN_PROGRESS"||ah==="NOT_ADDED"){dc_application.toolbar.disableButtons(ag)}else{dc_application.toolbar.enableButtons(ag)}},release:function(){y(G());return false}},add_site_map:{name:"add_site_map",className:"i-create",hint:getLabel("js-label-yandex-button-add_site_map"),init:function(ah){if(!n()){return dc_application.toolbar.disableButtons(ah)}var ag=B("is_site_map_added");var aj=B("verify_code");var ai=B("status_code");if(ag||aj!=="VERIFIED"||ai!=="OK"){dc_application.toolbar.disableButtons(ah)}else{dc_application.toolbar.enableButtons(ah)}},release:function(){h(G());return false}},remove:{name:"delete",className:"i-remove",hint:getLabel("js-label-yandex-button-delete"),init:function(ag){if(!n()){return dc_application.toolbar.disableButtons(ag)}var ah=B("status_code");if(ah==="NOT_ADDED"){dc_application.toolbar.disableButtons(ag)}else{dc_application.toolbar.enableButtons(ag)}},release:function(){Y(G());return false}},refresh:{name:"refresh",className:"i-restore",hint:getLabel("js-label-yandex-button-refresh"),init:function(ag){dc_application.toolbar.enableButtons(ag)},release:function(){dc_application.refresh();return false}}}};var r=function(){return["view","add","verify","add_site_map","remove","refresh"]};var ad=function(){return[]};var A=function(ah){var ak=!(af.isUndefined(ah.isComplete)||af.isUndefined(ah.step)||af.isUndefined(ah.info));if(!ak){return aa(g)}var ag=A;var ai=aa;if(!ah.isComplete){m(ah.info);return o(ah.step,ag,ai)}var aj=d(ah.step);if(!af.isUndefined(aj)){return o(aj,ag,ai)}s()};var s=function(){var ag=getLabel("js-label-bad-links-search-complete");m(ag);K();ae(getLabel("js-label-close"));H("#"+E).on("click",function(){window.location.reload()})};var aa=function(ag){b();F(ag)};var S=function(){var ag=af.template(H("#"+ac).html());var ah=ag({id:U,message:getLabel("js-label-bad-links-search-start-message")});var ai={width:400,html:ah,confirmButton:false,cancelButton:true,cancelText:getLabel("js-label-interrupt"),cancelCallback:b,closeCallback:b};openDialog("",getLabel("js-label-bad-links-search"),ai)};var m=function(ag){H("#"+U).html(ag)};var ae=function(ag){H("#"+E).val(ag)};var K=function(){H("."+c).hide()};var b=function(){closeDialog()};var k=function(ag){switch(ag){case C:return v;case t:return q}throw new Error(getLabel("js-error-label-unknown-search-step-name"))};var x=function(ag){var ah=af.template(H("#"+Z).html());var ai=ah({header:getLabel("js-label-header-sources"),sources:ag});var aj={width:650,html:ai,confirmText:getLabel("js-confirm"),closeButton:false};openDialog("",getLabel("js-label-title-sources"),aj)};var ab=function(ai,ag){var ah={type:"GET",url:N+j+"/"+p+"/.json",dataType:"json",data:{param0:ai,csrf:l()}};e(ah,ag,z)};var e=function(aj,ag,ai){var ah=H.ajax(aj);ah.success(function(ak){if(I(ak)){return ai(ak.data.error)}if(V(ak)){return ai(ak.message)}ag(ak)});ah.error(function(){var ak=g;if(ah.status===403&&ah.responseJSON&&ah.responseJSON.data&&ah.responseJSON.data.error){ak=ah.responseJSON.data.error}ai(ak)})};var I=function(ag){return !af.isUndefined(ag.data)&&!af.isUndefined(ag.data.error)};var V=function(ag){return !af.isUndefined(ag.code)&&!af.isUndefined(ag.trace)&&!af.isUndefined(ag.message)};var z=function(ag){return F(ag)};var F=function(ag){H.jGrowl(ag)};var l=function(){return csrfProtection.token};return{showBadLinkSources:L,findBadLinks:M,getSiteListToolBarFunctions:X,getSiteListToolBarMenu:r,getSiteListPageLimitList:ad}})(jQuery,_);var StatModule=(function(u,M){var d="stat";var y="/admin/";var J="addCounter";var l="deleteCounter";var F="saveCounterCode";var L="downloadCounterCode";var K="getCounterStat";var I="/traffic/attendance/";var N="#statdate_settings";var x='input[name = "fromDate"]';var n='input[name = "toDate"]';var b=getLabel("js-label-request-error");u(function(){h()});var h=function(){C().on("submit",e)};var C=function(){return u(N)};var e=function(R){R.preventDefault();var P=G().val();var Q=H().val();var S=/\d{4}-\d{2}-\d{2}\s?\d{0,2}\:?\d{0,2}\:?\d{0,2}\:?$/;if(!S.test(P)||!S.test(Q)){alert(getLabel("js-error-label-incorrect-date-period"));return}var O=a(P);var T=a(Q);window.location.href=g(O,T)};var a=function(O){return O.replace(/\s\d{1,2}:\d{1,2}(:\d{1,2})?$/,"")};var s=function(O){return O.replace(/(\d{4}\-\d{2}\-\d{2}\/){2}$/,"")};var G=function(){return u(x)};var H=function(){return u(n)};var g=function(O,Q){var P=s(window.location.href);return P+O+"/"+Q+"/"};var k=function(){return{add:{name:"add",className:"i-add",hint:getLabel("js-label-yandex-metric-button-add"),init:function(O){if(!j()){return dc_application.toolbar.disableButtons(O)}var P=m("status_code");if(P==="CS_AVAILABLE"){dc_application.toolbar.enableButtons(O)}else{dc_application.toolbar.disableButtons(O)}},release:function(){w(r());return false}},view:{name:"view",className:"i-vision",hint:getLabel("js-label-yandex-metric-button-view"),init:function(O){if(!j()){return dc_application.toolbar.disableButtons(O)}var P=m("status_code");if(P==="CS_OK"){dc_application.toolbar.enableButtons(O)}else{dc_application.toolbar.disableButtons(O)}},release:function(){D(r());return false}},code:{name:"code",className:"i-see",hint:getLabel("js-label-yandex-metric-button-code"),init:function(O){if(!j()){return dc_application.toolbar.disableButtons(O)}var P=m("status_code");if(P!=="CS_AVAILABLE"){dc_application.toolbar.enableButtons(O)}else{dc_application.toolbar.disableButtons(O)}},release:function(){E(r());return false}},remove:{name:"delete",className:"i-remove",hint:getLabel("js-label-yandex-metric-button-delete"),init:function(O){if(!j()){return dc_application.toolbar.disableButtons(O)}var P=m("status_code");if(P!=="CS_AVAILABLE"){dc_application.toolbar.enableButtons(O)}else{dc_application.toolbar.disableButtons(O)}},release:function(){A(r());return false}},refresh:{name:"refresh",className:"i-restore",hint:getLabel("js-label-yandex-metric-button-refresh"),init:function(O){dc_application.toolbar.enableButtons(O)},release:function(){dc_application.refresh();return false}}}};var o=function(){return["add","view","code","remove","refresh"]};var p=function(){return[]};var r=function(){return dc_application.unPackId(z().attributes.id)};var z=function(){return dc_application.toolbar.selectedItems[0]};var m=function(O){var P=z();return(typeof P==="object")?P.attributes[O]:""};var j=function(){return dc_application.toolbar.selectedItemsCount===1};var D=function(P){var O=y+d+"/"+K+"/"+P+I;t(O)};var w=function(P){var O={type:"POST",url:y+d+"/"+J+"/.json",dataType:"json",data:{csrf:f(),domain_id:P}};c(O,function(){dc_application.refresh()},q)};var A=function(P){var O={type:"POST",url:y+d+"/"+l+"/.json",dataType:"json",data:{csrf:f(),counter_id:P}};c(O,function(){dc_application.refresh()},q)};var E=function(P){var O={type:"GET",url:y+d+"/"+F+"/.json",dataType:"json",data:{csrf:f(),counter_id:P}};c(O,function(Q){if(Q.data&&Q.data.success){var R=y+d+"/"+L+"/"+P;return t(R)}dc_application.refresh()},q)};var t=function(O){document.location.href=O};var c=function(R,O,Q){var P=u.ajax(R);P.success(function(S){if(v(S)){return Q(S.data.error)}if(B(S)){return Q(S.message)}O(S)});P.error(function(){var S=b;if(P.status===403&&P.responseJSON&&P.responseJSON.data&&P.responseJSON.data.error){S=P.responseJSON.data.error}Q(S)})};var v=function(O){return !M.isUndefined(O.data)&&!M.isUndefined(O.data.error)};var B=function(O){return !M.isUndefined(O.code)&&!M.isUndefined(O.trace)&&!M.isUndefined(O.message)};var q=function(O){u.jGrowl(O)};var f=function(){return csrfProtection.token};return{getCounterListToolBarFunctions:k,getCounterListToolBarMenu:o,getCounterListPageLimitList:p}})(jQuery,_);