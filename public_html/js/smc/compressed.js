function filter(){this.AllText=new Array();this.Props=new Object();this.EntIDs=new Array();this.Parents=new Array();this.Langs=new Array();this.Domains=new Array();this.Orders=new Object();this.Perms=true;this.Full=true;this.FldsOr=false;this.Depth=null;this.CheckVirtual=true;this.Page=null;this.Limit=null;this.hTypes=new Array();this.oTypes=new Array();this.Template=null;this.setAllTextSearch=function(b){if(b instanceof Array){if(this.AllText.length){this.AllText.splice(this.AllText.length,b.length,b)}else{this.AllText=b}}else{this.AllText.push(b)}};this.setTemplate=function(c){var b=parseInt(c);if(!isNaN(b)&&b>0){this.Template=b}};this.setHTypes=function(b){if(b instanceof Array){this.hTypes=b}else{this.hTypes.push(b)}};this.setPropertyEqual=function(c,b){if(this.Props[c]==undefined){this.Props[c]=new Object()}this.Props[c]["eq"]=b};this.setPropertyNotEqual=function(c,b){if(this.Props[c]==undefined){this.Props[c]=new Object()}this.Props[c]["ne"]=b};this.setPropertyLike=function(c,b){if(this.Props[c]==undefined){this.Props[c]=new Object()}this.Props[c]["like"]=b};this.setPropertyLess=function(c,b){if(this.Props[c]==undefined){this.Props[c]=new Object()}this.Props[c]["lt"]=b};this.setPropertyGreater=function(c,b){if(this.Props[c]==undefined){this.Props[c]=new Object()}this.Props[c]["gt"]=b};this.setPropertyBetween=function(d,c,b){if(this.Props[d]==undefined){this.Props[d]=new Object()}this.Props[d]["gt"]=c;this.Props[d]["lt"]=b};this.removeProperty=function(b){this.Props[b]=undefined};this.addOrder=function(d,c){var b=true;if(c!=undefined&&(c===false||c.toUpperCase()=="DESC"||c.toUpperCase()=="BACKWARD")){b=false}this.Orders[d]=b};this.setOrder=function(d,c){var b=true;if(c!=undefined&&(c===false||c.toUpperCase()=="DESC"||c.toUpperCase()=="BACKWARD")){b=false}this.Orders=new Object();this.Orders[d]=b};this.setPermissions=function(b){if(b==undefined){this.Perms=true}else{this.Perms=b?true:false}};this.setParentElements=function(b){if(b instanceof Array){this.Parents=b}else{this.Parents.push(b)}};this.setDepth=function(b){if(typeof(b)!=="undefined"){this.Depth=parseInt(b)}};this.setEntityIDs=function(b){if(b instanceof Array){this.EntIDs=b}else{this.EntIDs.push(b)}};this.setDomain=function(b){if(b instanceof Array){this.Domains=b}else{this.Domains.push(b)}};this.setLang=function(b){if(b instanceof Array){this.Langs=b}else{this.Langs.push(b)}};this.setHtypes=function(b){if(b instanceof Array){this.hTypes=b}else{this.hTypes.push(b)}};this.setOtypes=function(b){if(b instanceof Array){this.oTypes=b}else{this.oTypes.push(b)}};this.setVirtualCopyChecking=function(b){if(typeof(b)=="undefined"){this.CheckVirtual=true}else{this.CheckVirtual=b?true:false}};this.setViewMode=function(b){if(typeof(b)=="undefined"){this.Full=true}else{this.Full=b?true:false}};this.setConditionModeOr=function(b){if(typeof(b)=="undefined"){this.FldsOr=true}else{this.FldsOr=b?true:false}};this.getParents=function(){return this.Parents};this.setPage=function(b){this.Page=parseInt(b)};this.getPage=function(){return this.Page};this.setLimit=function(b){this.Limit=parseInt(b)};this.getLimit=function(){return this.Limit};this.getQueryString=function(b){var g=new Array();var e=0;if(b instanceof Object){var h=new Object();for(e in b.Props){h[e]=b.Props[e]}for(e in this.Props){h[e]=this.Props[e]}for(e in h){for(var d in h[e]){if(h[e][d] instanceof Array){for(var c=0;c<h[e][d].length;c++){g.push("fields_filter["+e+"]["+d+"][]="+encodeURIComponent(h[e][d][c]))}}else{g.push("fields_filter["+e+"]["+d+"]="+encodeURIComponent(h[e][d]))}}}for(e=0;e<this.AllText.length;e++){g.push("search-all-text[]="+encodeURIComponent(this.AllText[e]))}for(e=0;e<b.AllText.length;e++){g.push("search-all-text[]="+encodeURIComponent(b.AllText[e]))}for(e=0;e<this.EntIDs.length;e++){g.push("id[]="+this.EntIDs[e])}for(e=0;e<b.EntIDs.length;e++){g.push("id[]="+b.EntIDs[e])}for(e=0;e<this.Parents.length;e++){g.push("rel[]="+this.Parents[e])}for(e=0;e<b.Parents.length;e++){g.push("rel[]="+b.Parents[e])}for(e=0;e<this.hTypes.length;e++){g.push("hierarchy_types[]="+this.hTypes[e])}for(e=0;e<this.Domains.length;e++){g.push("domain_id[]="+this.Domains[e])}for(e=0;e<b.Domains.length;e++){g.push("domain_id[]="+b.Domains[e])}for(e=0;e<this.Langs.length;e++){g.push("lang_id[]="+this.Langs[e])}for(e=0;e<b.Langs.length;e++){g.push("lang_id[]="+b.Langs[e])}for(e=0;e<b.oTypes.length;e++){g.push("object_type[]="+b.oTypes[e])}h=new Object();for(e in b.Orders){h[e]=b.Orders[e]}for(e in this.Orders){h[e]=this.Orders[e]}for(e in h){g.push("order_filter["+e+"]="+(h[e]?"asc":"desc"))}if(this.Perms!==null){if(this.Perms){g.push("permissions")}else{if(b.Perms){g.push("permissions")}}}if(this.CheckVirtual!==null){if(this.CheckVirtual){g.push("virtuals")}else{if(b.CheckVirtual){g.push("virtuals")}}}if(this.Depth!==null){g.push("depth="+this.Depth)}else{if(b.Depth!==null){g.push("depth="+b.Depth)}}if(this.Page!==null){g.push("p="+this.Page)}else{if(b.Page!==null){g.push("p="+b.Page)}}if(this.Limit!==null){g.push("per_page_limit="+this.Limit)}else{if(b.Limit!==null){g.push("per_page_limit="+b.Limit)}}if(this.FldsOr||b.FldsOd){g.push("or-mode")}if(this.Full||b.Full){g.push("viewMode=full")}}else{for(e in this.Props){for(var d in this.Props[e]){if(this.Props[e][d] instanceof Array){for(var c=0;c<this.Props[e][d].length;c++){g.push("fields_filter["+e+"]["+d+"][]="+encodeURIComponent(this.Props[e][d][c]))}}else{g.push("fields_filter["+e+"]["+d+"]="+encodeURIComponent(this.Props[e][d]))}}}for(e=0;e<this.AllText.length;e++){g.push("search-all-text[]="+encodeURIComponent(this.AllText[e]))}for(e=0;e<this.EntIDs.length;e++){g.push("id[]="+this.EntIDs[e])}for(e=0;e<this.Parents.length;e++){g.push("rel[]="+this.Parents[e])}for(e=0;e<this.Domains.length;e++){g.push("domain_id[]="+this.Domains[e])}for(e=0;e<this.Langs.length;e++){g.push("lang_id[]="+this.Langs[e])}for(e in this.Orders){g.push("order_filter["+e+"]="+(this.Orders[e]?"asc":"desc"))}if(this.Perms){g.push("permissions")}if(this.CheckVirtual){g.push("virtuals")}if(this.Depth!==null){g.push("depth="+this.Depth)}if(this.Page!==null){g.push("p="+this.Page)}if(this.Limit!==null){g.push("per_page_limit="+this.Limit)}if(this.FldsOr){g.push("or-mode")}if(this.Full){g.push("viewMode=full")}}g.push("childs");g.push("links");var f=(b instanceof Object?b.Template||this.Template:this.Template);if(f){g.push("templates="+f)}return"?"+g.join("&")};this.clear=function(){this.AllText=new Array();this.Props=new Object();this.EntIDs=new Array();this.Parents=new Array();this.Langs=new Array();this.Domains=new Array();this.Orders=new Object();this.Perms=true;this.Depth=null;this.Page=null;this.Limit=null;this.Full=true;this.FldsOr=false;this.CheckVirtual=null};this.empty=function(){var b=0;var d=0;for(var c in this.Props){b++;if(b){break}}for(var c in this.Orders){d++;if(d){break}}return !this.AllText.length&&!this.EntIDs.length&&!this.Parents.length&&!this.Langs.length&&!this.Domains.length&&!b&&!d&&this.Perms&&this.Full&&!this.Depth&&!this.Page&&!this.FldsOr&&!this.CheckVirtual};var a=function(e){if(!e||"object"!==typeof e){return e}var f="function"===typeof e.pop?[]:{};var d,b;for(d in e){if(e.hasOwnProperty(d)){b=e[d];if(b&&"object"===typeof b){f[d]=a(b)}else{f[d]=b}}}return f};this.clone=function(){return a(this)}}var TableItem=function(B,u,v,P,L){var G=parseInt(v.id);var l=this;var K=v;var I=u;var A=P||null;var t=L||"after";var c=typeof(v["force-draw"])!=="undefined"?parseInt(v["force-draw"]):1;var R=typeof(v.childs)!=="undefined"?parseInt(v.childs):0;var w=(typeof(v.basetype)!=="undefined"&&typeof(v.basetype["module"])==="string")?v.basetype["module"]:"content";var q=(typeof(v.basetype)!=="undefined"&&typeof(v.basetype["method"])==="string")?v.basetype["method"]:"";var H=(typeof(v.basetype)!=="undefined"&&typeof(v.basetype["_value"])==="string")?v.basetype["_value"]:"";var e=B.iconsPath;var o=typeof(v.iconbase)!=="undefined"?v.iconbase:e+"ico_"+w+"_"+q+".png";var y=null;var h=null;var M=null;var Q=null;var n=null;var s=SettingsStore.getInstance();var O=true;var a=null;var z=false;var D=B.flatMode;var F=B.objectTypesMode;var m=null;var T=null;var d=null;this.element=null;this.control=B;this.childsContainer=null;this.id=G;this.name=typeof(v.name)!=="undefined"?v.name:getLabel("js-smc-noname-page");this.isRoot=I?false:true;this.loaded=false;this.viewLink=typeof(v.link)!=="undefined"?v.link:false;this.editLink=typeof(v["edit-link"])!=="undefined"?v["edit-link"]:false;this.createLink=typeof(v["create-link"])!=="undefined"?v["create-link"]:false;this.permissions=typeof(v.permissions)!=="undefined"?parseInt(v.permissions):0;this.isActive=typeof(v["is-active"])!=="undefined"?parseInt(v["is-active"]):0;if(F){this.isActive=true}this.isVirtualCopy=typeof(v["has-virtual-copy"])!=="undefined";this.isOriginal=typeof(v["is-original"])!=="undefined";this.lockedBy=typeof(v["locked-by"])==="object"?v["locked-by"]:null;this.expiration=typeof(v.expiration)==="object"?v.expiration:null;this.templateId=typeof(v["template-id"])!=="undefined"?v["template-id"]:null;this.langId=typeof(v["lang-id"])!=="undefined"?v["lang-id"]:null;this.domainId=typeof(v["domain-id"])!=="undefined"?v["domain-id"]:null;this.allowCopy=typeof(v["allow-copy"])!=="undefined"?parseInt(v["allow-copy"]):true;this.allowActivity=typeof(v["allow-activity"])!=="undefined"?parseInt(v["allow-activity"]):true;this.allowDrag=false;this.parent=I;this.childs=[];this.hasChilds=(R>0||G==0);this.labelControl=null;this.position=false;this.isExpanded=false;this.filter=new filter;this.filter.setParentElements(G);this.level=I?I.level+1:0;this.ignoreEmptyFilter=false;this.pageLimits=this.control.PerPageLimits;this.pageing={total:0,limit:0,offset:0};this.baseModule=(typeof(v.basetype)!=="undefined"&&typeof(v.basetype["module"])==="string")?v.basetype["module"]:"content";this.baseMethod=(typeof(v.basetype)!=="undefined"&&typeof(v.basetype["method"])==="string")?v.basetype["method"]:"";var J=function(){if(u){u.childs.push(G);if(c){S(I.childsContainer)}}else{if(c){k()}}};var g=function(U,V){if(D&&l.control.contentType!="pages"){if(l.control.enableObjectsActivity){return(V||U.getValue("is_activated")||U.getValue("is_active")||U.getValue("activated"))!==""}else{return true}}else{return V}};var S=function(aq){l.isActive=g(l,l.isActive);var W=N();var am=E();var ax=r();var V=document.createElement("tr");V.setAttribute("rel",G);V.className="ti";V.rel=G;V.className="ti";h=V;l.labelControl=h;var ac=document.createElement("td");ac.className="ti-toggle";y=document.createElement("img");y.className="ti-toggle";var al=l.hasChilds?e+"expand.png":e+"collapse-disabled.png";y.setAttribute("src",al);y.onclick=function(){l.toggle();return false};ac.appendChild(y);var ap=W.name;var ar=document.createElement("td");ar.className="ti column";ar.id="c_"+l.control.id+"_"+l.id+"_name";var ak=parseInt(ap.params[0]);if(!D){ak-=20*(l.level-1)}ar.style.width=ak+"px";ar.style.owerflow="hidden";ar.name="name";var an=document.createElement("div");an.style.width=ak+"px";an.style.owerflow="hidden";ar.appendChild(an);if(!F){new editableCell(l,ar,W.name)}Q=document.createElement("img");Q.style.border="0px";Q.setAttribute("alt",H);Q.setAttribute("title",H);Q.setAttribute("src",o);Q.className="ti-icon";Q.onmousedown=function(){return false};if(l.control.allowDrag&&l.allowDrag){Q.style.cursor="move"}if(!l.control.flatMode&&!l.control.objectTypesMode){an.appendChild(Q)}else{Q=null}if(l.expiration){var ah=l.expiration.status;if(ah){var ab=ah.id;var ad=ah._value;if(ab){var au=document.createElement("img");var ag=e+"ico_"+ab+".png";au.setAttribute("src",ag);au.setAttribute("alt",ad);au.setAttribute("title",ad);au.className="page-status";an.appendChild(au)}}}M=document.createElement("a");var ai=l.getValue("name");var aD=new String((typeof(ai)=="string"&&ai.length)?ai:"");if(!aD.length){aD=getLabel("js-smc-noname-page")}if(aD.length>45){aD=aD.substring(0,45)+"&#8230;"}an.title=(l.viewLink)?l.viewLink:aD.replace(/<[^>]+>/g,"");M.innerHTML=aD;if(l.editLink){M.setAttribute("href",l.editLink)}else{M.className="unactive";M.onclick=function(){return false}}an.appendChild(M);if(l.isVirtualCopy){var af=document.createElement("span");af.className="label-virtual";af.innerHTML=(l.isOriginal)?getLabel("js-smc-original"):getLabel("js-smc-virtual-copy");an.appendChild(af)}if(!l.isActive&&!l.control.objectTypesMode){if(!l.control.flatMode){if(Q){jQuery(Q).fadeTo(300,0.5)}if(y){jQuery(y).fadeTo(300,0.5)}}jQuery(M).fadeTo(300,0.5)}if(!D){V.appendChild(ac)}V.appendChild(ar);if(l.control.enableEdit){var at=document.createElement("td");at.className="ti column";at.style.width="140px";var ao=document.createElement("div");ao.style.width="140px";V.appendChild(at)}var ae=2;for(var aC in W){var X=ax[aC];var az=W[aC]["params"];if(az[1]=="static"){X=W[aC]}if(!X){continue}ae++;var Y=document.createElement("td");Y.id="c_"+l.control.id+"_"+l.id+"_"+aC;Y.className="column";Y.style.width=az[0];Y.name=aC;Y.style.cursor="text";aD=l.getValue(aC);Y.innerHTML='<div style="width:'+W[aC]["params"][0]+'">'+aD+"</div>";V.appendChild(Y);if(X.dataType){new editableCell(l,Y,X)}if(aC=="is_activated"||aC=="active"||aC=="is_active"){d=Y}}var av=document.createElement("td");av.className="auto-column";av.innerHTML="&nbsp;";av.style.width="auto";V.appendChild(av);if(A){var aj=null;if(t.toLowerCase()=="after"){aj=A.element.nextSibling}else{aj=A.element}if(aj){l.element=aq.insertBefore(V,aj)}else{l.element=aq.appendChild(V)}}else{l.element=aq.appendChild(V)}if(l.control.dragAllowed&&l.allowDrag){var U="child";jQuery(h).draggable({distance:Control.DragSensitivity,handle:".ti-icon, a",helper:function(){var aF=l.element;var aE=document.createElement("div");aE.innerHTML="<div>"+l.name+"</div>";aE.className="ti-draggable";jQuery(aE).css({position:"absolute",background:"url("+o+") no-repeat 0 4px"});return aE},start:function(){Control.DraggableItem=l;Control.DragMode=true;if(l.control.toolbar){l.control.toolbar.hide()}},stop:function(){if(Control.HandleItem){Control.HandleItem.deInitDroppable();if(Control.DraggableItem){Control.DraggableItem.tryMoveTo(Control.HandleItem,U)}}Control.DraggableItem=null;Control.DragMode=false},drag:function(aE,aK){var aL=aE.pageX;var aJ=aE.pageY;var aG=Control.detectItemByMousePointer(aL,aJ);var aH=Control.HandleItem;if(aH){aH.deInitDroppable()}Control.HandleItem=aG;if(aG){var aM=jQuery(aG.control.initContainer).position();var aI=aG.position.bottom-aG.position.top;var aF=aJ-aM.top-aG.position.top;if(aF<aI/3){U="before"}if(aF>aI/3&&aF<2*aI/3){U="child"}if(aF>2*aI/3){U="after"}if(aG.isRoot){U="child"}aG.initDroppable(U)}}})}var aB=document.createElement("tr");aB.style.display="none";var aA=document.createElement("td");aA.colSpan=ae+1;var ay=document.createElement("table");ay.cellSpacing="0";var Z=document.createElement("tbody");ay.appendChild(Z);Z.className="ti-childs-container";var aw=document.createElement("tr");aw.style.display="none";m=document.createElement("td");m.id="pb_"+l.control.id+"_"+l.id;m.className="pages-bar";if(!D){ae++}m.colSpan=ae;aw.appendChild(m);Z.appendChild(aw);l.childsContainer=Z;aA.appendChild(ay);if(!D){var aa=document.createElement("td");aa.className="ti-toggle";aB.appendChild(aa)}aB.appendChild(aA);if(!V.nextSibling){aq.appendChild(aB)}else{V.parentNode.insertBefore(aB,V.nextSibling)}};this.tryMoveTo=function(V,aa){if(V){var Z=this.control.getRootNodeId();var U=V.id;var W=aa!=="child"?1:0;if(aa=="before"){Z=V.id;U=V.parent.id}if(aa=="after"){var X=V.getNextSibling();U=V.parent.id;Z=X?X.id:this.control.getRootNodeId()}if(V===this){return false}if(V.checkIsChild(this)){return false}if(Z==this.id){return false}var Y=V;if(W){Y=V.parent?V.parent:V.control.getRoot()}this.control.dataSet.execute("tree_move_element",{element:this.id,before:Z,rel:U,"as-sibling":W,domain:V.control.getRoot().name,childs:1,links:1,virtuals:1,permissions:1,templates:1,receiver_item:Y,handle_item:this})}};this.initDroppable=function(W){var W=W||"child";var U=Control.DraggableItem;var Y=jQuery(this.control.initContainer).position();if(U){if(U===this){return false}if(this.checkIsChild(U)){return false}var V=Control.dropIndicator;if(oTable){var X=jQuery(oTable.container).width();if(X<this.position.right){this.position.right=X}}if(W=="after"){V.style.top=this.position.bottom+Y.top+"px";V.style.left=this.position.left+Y.left+"px";V.style.width=this.position.right-this.position.left}if(W=="before"){V.style.top=this.position.top+Y.top+V.offsetHeight+"px";V.style.left=this.position.left+Y.left+"px";V.style.width=this.position.right-this.position.left+"px"}if(W=="child"){V.style.top=this.position.bottom+Y.top+"px";V.style.left=this.position.left+Y.left+20+"px";V.style.width=this.position.right+Y.left-20-this.position.left+"px"}V.style.display="";setTimeout(b,3239)}};this.deInitDroppable=function(){if(!Control.dropIndicator){return}Control.dropIndicator.style.display="none"};var N=function(){if(l.control.usedColumns){return l.control.usedColumns}var U={};var ab=s.get(l.control.id,"used-columns");if(ab===false){ab=l.control.visiblePropsMenu;if(ab.length==0){ab=l.control.dataSet.getDefaultFields()}if(!ab){ab=""}}if(ab.length){var Y=ab.split("|");for(var X=0;X<Y.length;X++){var V=Y[X];var Z=Y[X];var ac=[];var W=V.indexOf("[");if(W){Z=V.substring(0,W);ac=V.substring(W+1,V.length-1).split(",")}U[Z]={name:Z,params:ac}}}if(!U.name){U.name={name:"name",params:["250px"]}}var aa=l.control.sequencePropsMenu;U=x(U,aa);l.control.usedColumns=U;return U};var x=function(V,X){var Y,U={},W=0;for(Y in V){if(!V.hasOwnProperty(X[W])){delete X[W];X.splice(W)}if(V.hasOwnProperty(Y)){if(X.indexOf(Y)===-1){X.push(Y)}U[X[W]]=V[X[W]]||"";W++}}return U};var C=function(){var V=N();var W=[];for(name in V){var U=V[name];if(!U){continue}W[W.length]=name+"["+U.params.join(",")+"]"}s.set(l.control.id,W.join("|"),"used-columns")};var E=function(){if(l.control.columnsMenu){return l.control.columnsMenu}var ab=l.control.dataSet.getCommonFields();var V=N();var aj=l.control.dataSet.getFieldsStoplist();var W={};l.control.needColumnsMenu=false;var Y=1,Z=0;for(var ak=0;ak<ab.length;ak++){Y++;var ae=ab[ak].getElementsByTagName("field");var ac=false;for(var ai=0;ai<ae.length;ai++){var U=ae[ai];var am=U.getAttribute("title");var ah=U.getAttribute("id");var an=U.getAttribute("name");if(jQuery.inArray(an,l.control.requiredPropsMenu)!=-1){continue}var al=U.getElementsByTagName("type");var ag=al[0].getAttribute("data-type");var aa=U.getAttribute("guide-id");if(ag=="symlink"||ag=="password"){continue}var af=false;for(var ad=0;ad<aj.length;ad++){if(aj[ad]==an){af=true;break}}if(af){continue}l.control.needColumnsMenu=true;var X=false;if(V[an]){X=true}W[an]={caption:am,icon:X?"checked":"undefined",id:ah,title:am,fieldName:an,dataType:ag,guideId:aa,checked:X,execute:function(ap){var ao=ap;ap.checked?l.removeColumn(ap.fieldName):l.appendColumn(ap.fieldName);Control.recalcItemsPosition()}};Y++;if(ak<ae.length-1){ac=true}if(X){Z++}}if(ac){W[Y+"-sep"]="-"}}l.control.columnsMenu=W;return W};var r=function(){if(l.control.columnsTable){return l.control.columnsTable}var ab=l.control.dataSet.getCommonFields();var V=N();var aj=l.control.dataSet.getFieldsStoplist();var aa={};l.control.needColumnsTable=false;var X=1,Y=0;for(var ak=0;ak<ab.length;ak++){X++;var ae=ab[ak].getElementsByTagName("field");var ac=false;for(var ai=0;ai<ae.length;ai++){var U=ae[ai];var am=U.getAttribute("title");var ah=U.getAttribute("id");var an=U.getAttribute("name");var al=U.getElementsByTagName("type");var ag=al[0].getAttribute("data-type");var Z=U.getAttribute("guide-id");if(ag=="symlink"||ag=="password"){continue}var af=false;for(var ad=0;ad<aj.length;ad++){if(aj[ad]==an){af=true;break}}if(af){continue}l.control.needColumnsMenu=true;var W=false;if(V[an]){W=true}aa[an]={caption:am,icon:W?"checked":"undefined",id:ah,title:am,fieldName:an,dataType:ag,guideId:Z,checked:W,execute:function(ap){var ao=ap;ap.checked?l.removeColumn(ap.fieldName):l.appendColumn(ap.fieldName);Control.recalcItemsPosition()}};X++;if(ak<ae.length-1){ac=true}if(W){Y++}}if(ac){aa[X+"-sep"]="-"}}l.control.columnsTable=aa;return aa};this.resizeColumn=function(ab,ac){var W=N();var aa=E();var X=W[ab];if(!X){return false}for(var Y=0;Y<l.childs.length;Y++){var U=l.control.items[l.childs[Y]];if(U){U.resizeColumn(ab,ac)}}if(l.isRoot){var V=document.getElementById("h_"+l.control.id+"_"+ab);if(!V){return false}V.style.width=ac+"px";V.firstChild.style.width=ac+"px";W[ab].params[0]=ac+"px";l.control.usedColumns=W;C();var Z=document.getElementById("f_"+l.control.id+"_"+ab);if(Z){Z.style.width=ac+"px";if(Z.firstChild){Z.firstChild.style.width=ac+"px"}}}else{var V=document.getElementById("c_"+l.control.id+"_"+l.id+"_"+ab);if(!V){return false}if(!D&&ab=="name"){ac-=20*(l.level-1)}V.style.width=ac+"px";V.firstChild.style.width=ac+"px"}return true};this.startResizeColumn=function(ae,ag){var U=document.getElementById("h_"+this.control.id+"_"+ae);if(!U){return false}var ab=this.control.initContainer.offsetHeight;var af=jQuery(this.control.initContainer).position();var W=jQuery(U).position();W.left-=this.control.initContainer.scrollLeft;var Y=U.offsetWidth;var ac=W.left+Y;var ad=document.createElement("div");ad.className="resizer";jQuery(ad).css({"z-index":1,position:"absolute",width:"1px",height:ab,borderLeft:"1px dotted #CCC",top:W.top+af.top,left:ac+af.left});var X=ac-ag.clientX;ad.style.left=X+"px";var Z=Y;var V=function(ah){try{document.body.style["-moz-user-select"]="none";document.body.style["-khtml-user-select"]="none";document.body.onselectstart=function(){return false};document.selection.empty()}catch(ai){}var aj=ah.clientX+X;Z=Y+aj-ac;if(Z>TableItem.maxColumnWidth){Z=TableItem.maxColumnWidth}if(Z<TableItem.minColumnWidth){Z=TableItem.minColumnWidth}ad.style.left=af.left+W.left+Z+"px"};var aa=function(ah){jQuery(document).unbind("mousemove",V);jQuery(document).unbind("mouseup",aa);document.body.removeChild(ad);if(Z!=Y){l.resizeColumn(ae,Z);Control.recalcItemsPosition()}};jQuery(document).bind("mousemove",V);jQuery(document).bind("mouseup",aa);document.body.appendChild(ad)};this.appendColumn=function(af){var W=N();var ad=E();var aa=ad[af];if(!aa||W[af]){return false}for(var ab=0;ab<l.childs.length;ab++){var V=l.control.items[l.childs[ab]];if(V){V.appendColumn(af)}}if(l.isRoot){var Y=document.createElement("th");Y.className="column";Y.setAttribute("id","h_"+l.control.id+"_"+af);Y.setAttribute("name",name);Y.name=af;Y.width="100px";var ac=document.createElement("div");ac.title=aa.title;ac.innerHTML=aa.title;Y.appendChild(ac);TableItem.setSavedOrder(af,l.control,ac);var ae=document.createElement("span");ae.onmousedown=function(ag){if(!ag){ag=window.event}l.startResizeColumn(af,ag)};ac.appendChild(ae);l.element.firstChild.insertBefore(Y,l.element.firstChild.lastChild);W[af]={name:af,params:["100px"]};l.control.usedColumns=W;ad[af].checked=true;ad[af].icon="checked";l.control.columnsMenu=ad;var Z=document.createElement("th");Z.setAttribute("id","f_"+l.control.id+"_"+af);Z.style.width=W[af]["params"][0];l.control.onDrawFieldFilter(ad[af],Z,W[af].params);T.insertBefore(Z,T.lastChild);var U=document.getElementById("pb_"+l.control.id+"_"+l.id);if(U){U.colSpan+=1}C();p()}else{var Y=document.createElement("td");Y.id="c_"+l.control.id+"_"+l.id+"_"+af;Y.style.width="100px";Y.className="column";Y.name=af;if(document.getElementById(Y.id)){return true}var X=l.getValue(af);Y.innerHTML="<div>"+X+"</div>";l.element.insertBefore(Y,l.element.lastChild);l.childsContainer.parentNode.parentNode.colSpan+=1;new editableCell(l,Y,aa)}return true};this.removeColumn=function(ae){var Y=N();var ad=E();var Z=ad[ae];if(!Z||!Y[ae]){return false}for(var ab=0;ab<l.childs.length;ab++){var V=l.control.items[l.childs[ab]];if(V){V.removeColumn(ae)}}if(l.isRoot){var X=document.getElementById("h_"+l.control.id+"_"+ae);if(!X){return false}X.parentNode.removeChild(X);var aa=document.getElementById("f_"+l.control.id+"_"+ae);if(aa){aa.parentNode.removeChild(aa)}var ac={};for(var W in Y){if(W==ae){continue}ac[W]=Y[W]}l.control.usedColumns=ac;ad[ae].checked=false;ad[ae].icon="undefined";l.control.columnsMenu=ad;l.control.onRemoveColumn(Z);l.childsContainer.parentNode.parentNode.colSpan-=1;var U=document.getElementById("pb_"+l.control.id+"_"+l.id);if(U){U.colSpan-=1}C();p()}else{var X=document.getElementById("c_"+l.control.id+"_"+l.id+"_"+ae);if(!X){return false}X.parentNode.removeChild(X);l.childsContainer.parentNode.parentNode.colSpan-=1}return true};var p=function(){var V=N();var Z=r();var W=0;for(var U in V){var X=Z[U];var Y=V[U]["params"];if(Y[1]=="static"){X=V[U];X.title=getLabel("js-smc-"+U)}if(!X){continue}W++}if(T){T.style.display=(W>0)?"":"none"}};var k=function(){if(!Control.dropIndicator){var ay=document.createElement("div");ay.className="ti-drop";Control.dropIndicator=document.body.appendChild(ay)}var Y=N();var ak=E();var av=r();var W=0,ag=0;for(var ar in ak){++W}var V=document.createElement("thead");V.setAttribute("name",l.control.id);var X=document.createElement("tr");X.className="header-row";T=document.createElement("tr");T.className="filter-row";var ae=function(aA){return function(aB){if(!aB){aB=window.event}l.startResizeColumn(aA,aB);return true}};var ax=document.createElement("th");ax.colspan="1";ax.className="void";var am=Y.name;var ad=document.createElement("th");ad.className="column";ad.setAttribute("id","h_"+l.control.id+"_name");ad.setAttribute("name","name");ad.name="name";ad.style.width=am.params[0];var aq=document.createElement("div");aq.style.width=am.params[0];aq.innerHTML=getLabel("js-smc-name-column");aq.title=getLabel("js-smc-name-column");var ai=document.createElement("span");ai.onmousedown=ae("name");aq.appendChild(ai);ad.appendChild(aq);TableItem.setSavedOrder("name",l.control,aq);if(!D){X.appendChild(ax);T.appendChild(ax.cloneNode(true));T.firstChild.className="filter-void"}X.appendChild(ad);if(l.control.enableEdit){var ap=document.createElement("th");ap.className="column";ap.style.width="140px";var ah=document.createElement("div");ah.style.width="132px";ap.appendChild(ah);X.appendChild(ap)}if(l.control.enableEdit){var ao=document.createElement("th");ao.setAttribute("id","f_"+l.control.id+"_name");ao.style.width=am.params[0];l.control.onDrawFieldFilter("name",ao,am.params);T.appendChild(ao)}var U=document.createElement("th");U.id="f_"+l.control.id+"_manage";U.style.width="140px";T.appendChild(U);var af=2;for(var az in Y){var Z=av[az];var aw=Y[az]["params"];if(aw[1]=="static"){Z=Y[az];Z.title=getLabel("js-smc-"+az)}if(!Z){continue}af++;var ab=document.createElement("th");ab.className="column";ab.setAttribute("id","h_"+l.control.id+"_"+az);ab.setAttribute("name",az);ab.style.width=Y[az]["params"][0];ab.name=az;aq=document.createElement("div");aq.style.width=Y[az]["params"][0];aq.title=Z.title;aq.innerHTML=Z.title;ab.appendChild(aq);TableItem.setSavedOrder(az,l.control,aq);ai=document.createElement("span");ai.onmousedown=ae(az);aq.appendChild(ai);X.appendChild(ab);var aj=document.createElement("th");aj.setAttribute("id","f_"+l.control.id+"_"+az);aj.style.width=Y[az]["params"][0];l.control.onDrawFieldFilter(Z,aj,Y[az].params);T.appendChild(aj);++ag}var at=document.createElement("th");at.style.width="auto";T.appendChild(at.cloneNode(true));if(!l.control.objectTypesMode&&l.control.needColumnsMenu){var al=document.createElement("div");al.className="invoke-btn";at.appendChild(al);jQuery(al).bind("click",function(aA){jQuery.cmenu.lockHiding=true;jQuery.cmenu.show(jQuery.cmenu.getMenu(l.control.columnsMenu),l.control.initContainer.offsetParent,aA);return});jQuery(al).bind("mousedown",function(aA){if(aA.altKey){jQuery.cmenu.lockHiding=true;jQuery.cmenu.show(jQuery.cmenu.getMenu(l.control.columnsMenu),l.control.initContainer.offsetParent,aA);return}});jQuery(al).bind("mouseout",function(){jQuery.cmenu.lockHiding=false})}X.appendChild(at);V.appendChild(X);if(!l.control.objectTypesMode){V.appendChild(T)}p();jQuery(V).bind("click",function(aB){var aA=aB.target;if(aA.parentNode.tagName.toUpperCase()!="TH"){return}TableItem.orderByColumn(aA.parentNode.name,l.control,aA)});var ac=document.createElement("tbody");ac.className="table-container";var au=document.createElement("tr");au.style.display="none";m=document.createElement("td");m.id="pb_"+l.control.id+"_"+l.id;m.className="pages-bar";if(!D){af++}m.colSpan=af;au.appendChild(m);ac.appendChild(au);l.element=l.control.container.appendChild(V);l.childsContainer=l.control.container.appendChild(ac);l.control.initContainer=l.control.container;l.control.container=l.childsContainer;if(D&&!F){var aa=function(){var aA=function(){var aC=document.querySelector("select[name=encoding]");var aB=aC.selectedIndex;if(typeof aB!="number"){return}var aE=aC.item(aB).text;var aD=l.getExportLink(null,aE);window.location=aD};jQuery.get("/js/smc/html/quickExportDialog.html",function(aB){openDialog({text:aB,title:getLabel("js-csv-export"),OKText:getLabel("js-csv-export-button"),OKCallback:aA})})};var an=function(){var aA=l.getImportLink();if(l.control.contentType=="pages"){aA+="&force-hierarchy=1"}aA+="&rnd="+Math.round(Math.random()*1000%1000);l.callCsvImport(aA);return false};l.showCsvButtons(aa,an)}l.expand()};this.showCsvButtons=function(Y,W){if(this.control.disableCSVButtons){return}l.hideCsvButtons();var X=document.createElement("div");X.id="csv-buttons";var V=document.createElement("a");V.appendChild(document.createTextNode(getLabel("js-csv-export")));V.href="#";V.className="csvLink csvExport";V.onclick=Y;X.appendChild(V);if(!this.control.hideCsvImportButton){var U=document.createElement("a");U.appendChild(document.createTextNode(getLabel("js-csv-import")));U.href="#";U.className="csvLink csvImport";U.onclick=W;X.appendChild(U)}l.control.container.parentNode.parentNode.appendChild(X);l.csvButtons=X};this.hideCsvButtons=function(){if(l.csvButtons){jQuery(l.csvButtons).remove();l.csvButtons=false}jQuery("#csv-buttons").remove()};this.getExportLink=function(Z,U){var V=N();var ae=this.control.getCurrentFilter().getQueryString();var af=document.location.pathname;try{var ac=l.control.dataSet.getPathModuleMethod()}catch(X){}if(af!==ac&&af.indexOf(ac)==0){var aa=af.substring(ac.length);var ad=new RegExp("/([/0-9]*)/");af=(ad.test(aa))?af:ac}else{af=ac}var ab=af+ae+"&xmlMode=force&export=csv";for(var Y in V){var W=V[Y]["name"];if(W!="name"){ab+="&used-fields[]="+W}}if(Z){ab+="&rel[]="+Z}if(typeof U=="string"&&U.length>0){ab+="&encoding="+U}return ab};this.getImportLink=function(U){var V=this.control.getCurrentFilter().getQueryString();var W=document.location.pathname;W+=V+"&xmlMode=force&import=csv";if(U){W+="&rel[]="+U}return W};this.callCsvImport=function(V){var U="<form method='post' id='import-csv-form' enctype='multipart/form-data' action='"+V+"' mime-type='text/html'";U+=" target='import-iframe'>";U+="<label for='csv-file'>"+getLabel("js-csv-import-question")+"</label> ";U+="<input type='file' name='csv-file' id='csv-file' size='28' /><br /><br />";U+='<label id="csv_encoding">';U+="<span>"+getLabel("js-csv-choose-encoding")+"</span>";U+='<select name="encoding">';U+='<option value="Windows-1251">Windows-1251</option>';U+='<option value="UTF-8">UTF-8</option>';U+="</select>";U+="</label><br />";U+="<input type='hidden' name='csrf' value='' />";U+="<label for='ignore-id'>"+getLabel("js-csv-import-ignore-id")+"</label><input type='checkbox' name='ignore-id' id='ignore-id' />";U+="</form>";U+="<iframe name='import-iframe' id='import-iframe' src='' style='display: none;'></iframe>";window.csvQuickImportCallback=function(){closeDialog();document.location.reload()};openDialog({text:U,width:330,OKText:getLabel("js-csv-import-button"),OKCallback:function(){jQuery("#import-csv-form input[name='csrf']").val(csrfProtection.getToken());jQuery("#import-csv-form").submit();return false}})};var b=function(){if(O&&l===Control.HandleItem){l.expand()}};this.draw=function(){if(u){if(!c){S(I.childsContainer)}}else{if(!c){k()}}};this.appendChild=function(U){return new TableItem(this.control,l,U)};this.appendAfter=function(U,V){return new TableItem(this.control,l,U,V,"after")};this.appendBefore=function(U,V){return new TableItem(this.control,l,U,V,"before")};this.appendFirst=function(U){if(!this.childsContainer.childNodes.length){return this.appendChild(U)}else{if(typeof(this.childsContainer.childNodes[1].rel)!="undefined"){return this.appendBefore(U,this.control.getItem(this.childsContainer.childNodes[1].rel))}else{return false}}};this.getPreviousSibling=function(){var U=this.element.previousSibling;if(U&&U.rel){return this.control.getItem(U.rel)}return null};this.getNextSibling=function(){var U=this.element.nextSibling;if(U&&U.rel){return this.control.getItem(U.rel)}return null};this.clear=function(){if(this.isRoot){var U=this.element.parentNode;while(U.firstChild){U.removeChild(U.firstChild)}}else{if(this.element.parentNode){this.element.parentNode.removeChild(this.element.nextSibling);this.element.parentNode.removeChild(this.element)}}};this.checkIsChild=function(V){var U=this.parent;while(U){if(V===U){return true}U=U.parent}return false};this.recalcPosition=function(){if(l.isRoot){return false}try{var V=this.parent;while(V){if(!V.isExpanded){this.position=false;return false}V=V.parent}var U=this.control.getRoot().childsContainer;var X=jQuery(h).position();this.position={left:X.left,top:X.top,right:X.left+U.offsetWidth,bottom:X.top+jQuery(h).height()};return this.position}catch(W){this.position=false;return false}};this.setLoaded=function(U){this.loaded=U;var V=U?e+"collapse.png":e+"expand.png";if(y){y.setAttribute("src",e+"collapse.png")}};var f=function(W){if(!W){return""}if(!W.type){return""}var Z="",ab,U;var af=function(ah,ai){return ah.value._value||(ah.value||(ai||""))};switch(W.type){case"int":case"float":case"price":case"link_to_object_type":case"counter":Z=af(W,0);break;case"tags":case"string":Z=af(W);if(W.restriction=="email"){Z="<a href='mailto:"+Z+"' title='"+Z+"' class='link'>"+Z+"</a>";break}if(typeof Z=="array"){ab=Z.join(", ");Z=ab}if(/http:\/\//.test(Z)){Z='<a href="'+Z+'" title="'+Z+'" class="link">'+Z+"</a>"}else{Z='<span title="'+Z+'">'+Z+"</span>"}break;case"color":var ae=W.value?W.value:"";if(ae){Z='<div class="color table"><span class="value">'+ae+'</span><span class="color-box"><i style="background-color: '+ae+'"></i></span></div>'}break;case"text":Z=af(W);if(Z){Z='<span title="'+Z+'">'+Z.substring(0,255)+"</span>"}break;case"boolean":Z=af(W,false)?'<img alt="" style="width:13px;height:13px;" src="/images/cms/admin/mac/tree/checked.png" />':"";break;case"img_file":Z=W.value;if(Z){U=Z._value;var ag=U.substring(0,U.lastIndexOf("."));var V="";if(typeof U=="string"){ab=U.split(/\//);V=ab[ab.length-1]}if(Z.is_broken=="1"){Z='<span title="404" style="color:red;font-weight: bold;cursor: pointer;">?</span>';Z+='&nbsp;&nbsp;<span style="text-decoration: line-through;" title="'+U+'">'+V+"</span>"}else{var Y=Z.ext;var ac="/autothumbs.php?img="+ag+"_sl_180_120."+Y;Z='<img alt="" style="width:13px;height:13px;cursor: pointer;" src="/images/cms/image.png" onmouseover="TableItem.showPreviewImage(event, \''+ac+"')\" />";Z+='&nbsp;&nbsp;<span title="'+U+'">'+V+"</span>"}}break;case"video_file":case"swf_file":case"file":Z=W.value;if(Z){U=Z._value;if(Z.is_broken=="1"){Z=U?('<span style="text-decoration: line-through;" title="'+U+'">'+U+"</span>"):""}else{Z=U?('<span title="'+U+'">'+U+"</span>"):""}}break;case"relation":var X=af(W,null);if(X){if(X.item[0]){for(var aa=0;aa<X.item.length;aa++){Z+=X.item[aa].name;if(aa<X.item.length-1){Z+=", "}}Z='<span title="'+Z+'">'+Z+"</span>"}else{Z=X.item.name;var ad="relation-value";if(X.item.guid!=undefined){ad=X.item.guid}Z='<span title="'+Z+'" class="c-'+ad+'">'+Z+"</span>"}}break;case"date":Z=W.value["formatted-date"];break;case"wysiwyg":Z=af(W,null);if(Z["#text"]){Z=Z["#text"].join()}Z=Z.replace(/<\/?[^>]+>/g,"");break;default:return"";break}return Z};this.getValue=function(aa){var X=N();var W=X[aa];if(aa=="name"){return this.control.onGetValueCallback(this.name,aa,this)}if(W){if(W.params[1]=="static"){return this.control.onGetValueCallback(W,aa,this)}}if(!K.properties){return""}if(!K.properties["group"]){return""}var Z=typeof(K.properties["group"][0])!="undefined"?K.properties["group"]:[K.properties["group"]];for(var Y=0;Y<Z.length;Y++){if(!Z[Y]["property"]){continue}var U=typeof(Z[Y]["property"][0])!="undefined"?Z[Y]["property"]:[Z[Y]["property"]];for(var V=0;V<U.length;V++){if(U[V]["name"]==aa){U[V]=this.control.onGetValueCallback(U[V],aa,this);return f(U[V])}}}return this.control.onGetValueCallback("",aa,this)};this.getData=function(){return K};this.setPageing=function(X){if(!X||!m){return false}this.pageing=X;m.parentNode.style.display="none";m.innerHTML="";m.style.textAlign="left";if(this.isRoot){this.setPageingLimits(X)}if(X.total==0){m.parentNode.style.display="";var ac=document.createElement("span");ac.className="empty-result";if(this.isRoot){m.style.textAlign="center"}ac.appendChild(document.createTextNode(getLabel("js-smc-empty-result")));m.appendChild(ac)}if(X.total>X.limit||X.offset>0){var W=document.createElement("span");W.appendChild(document.createTextNode(getLabel("js-pages-label")));W.className="pagesLabel";m.appendChild(W);m.parentNode.style.display="";var V=Math.ceil(X.total/X.limit);var U=Math.ceil(X.offset/X.limit);var Y=function(ad){return function(){l.filter.setPage(ad);l.applyFilter(l.filter,true);return false}};var aa=false;var ab=false;for(var Z=0;Z<V;Z++){if(Z!=0&&Z!=(Math.ceil(X.total/X.limit)-1)){if(Math.abs(Z-U)>15){if(!aa){ab=document.createElement("a");ab.href="#";if(U==Z){ab.className="current"}ab.innerHTML="&#8230;";ab.className="current";ab.onclick=function(){return false};m.appendChild(ab)}aa=true;continue}}aa=false;ab=document.createElement("a");ab.href="#";if(U==Z){ab.className="current"}ab.innerHTML=Z+1;ab.onclick=Y(Z);m.appendChild(ab)}}};this.expand=function(){if(!this.hasChilds){return false}this.isExpanded=true;if(!this.loaded){this.loaded=true;this.control.load(this.filter);if(y){y.setAttribute("src",e+"loading.gif")}}else{if(y){y.setAttribute("src",e+"collapse.png")}}this.childsContainer.parentNode.parentNode.parentNode.style.display="";if(this.loaded){Control.recalcItemsPosition()}this.control.saveItemState(this.id)};this.collapse=function(){if(!this.hasChilds){return false}this.isExpanded=false;if(y){y.setAttribute("src",e+"expand.png")}this.childsContainer.parentNode.parentNode.parentNode.style.display="none";Control.recalcItemsPosition();this.control.saveItemState(this.id)};this.toggle=function(){if(this.hasChilds){this.isExpanded?this.collapse():this.expand()}};this.update=function(V){if(V){if(this.id!=V.id){return false}K=V;if(typeof(V["template-id"])!=="undefined"){this.templateId=V["template-id"]}if(typeof(V.link)!=="undefined"&&V.link!=this.viewLink){this.viewLink=V.link;h.setAttribute("href",this.viewLink)}if(typeof(V.childs)!=="undefined"&&parseInt(V.childs)!==R){R=parseInt(V.childs);this.hasChilds=R>0||G==0;var U=e+"collapse-disabled.png";if(this.hasChilds){U=this.isExpanded?e+"collapse.png":e+"expand.png"}if(!this.hasChilds){this.isExpanded=this.loaded=false}if(y){y.setAttribute("src",U)}}var W=typeof(V["is-active"])!=="undefined"?parseInt(V["is-active"]):0;if(W!==this.isActive){this.isActive=W;this.isActive=g(this,this.isActive);if(!this.isActive&&!l.control.objectTypesMode){if(!l.control.flatMode){jQuery(Q).fadeTo(300,0.5);jQuery(y).fadeTo(300,0.5)}jQuery(M).fadeTo(300,0.5)}else{if(!l.control.flatMode&&!l.control.objectTypesMode){jQuery(Q).fadeTo(300,1);jQuery(y).fadeTo(300,1)}jQuery(M).fadeTo(300,1)}if(d){jQuery("div",d).html(f({type:"boolean",value:this.isActive}))}}if(typeof(V.name)!=="undefined"&&V.name!=this.name){this.name=V.name.length?V.name:"";M.innerHTML=this.name.length?this.name:getLabel("js-smc-noname-page")}}};this.applyFilter=function(W,V){if(W instanceof Object){this.filter=W}else{this.filter.clear()}if(!V){this.filter.setParentElements(G)}if(this.loaded){this.control.removeItem(G,true);this.loaded=false;if(this.isExpanded){this.expand()}}if(this.isRoot){if(this.control.getCurrentFilter().empty()&&!this.ignoreEmptyFilter&&!(this.control.flatMode&&!this.control.objectTypesMode)){}else{var X=function(){var Y=function(){var aa=document.querySelector("select[name=encoding]");var Z=aa.selectedIndex;if(typeof Z!="number"){return}var ac=aa.item(Z).text;var ab=l.getExportLink(null,ac);if(l.control.contentType=="pages"){ab+="&force-hierarchy=1"}window.location=ab};jQuery.get("/js/smc/html/quickExportDialog.html",function(Z){openDialog({text:Z,title:getLabel("js-csv-export"),OKText:getLabel("js-csv-export-button"),OKCallback:Y})})};var U=function(){var Y=l.getImportLink();if(l.control.contentType=="pages"){Y+="&force-hierarchy=1"}Y+="&rnd="+Math.round(Math.random()*1000%1000);l.callCsvImport(Y);return false};if(this.control.contentType!="objectTypes"){l.showCsvButtons(X,U)}}}};this.setSelected=function(U){if(U){if(!a){a="ti";h.className="ti selected-highlight"}z=true}else{if(a){h.className=a;a=null}z=false}};this.getSelected=function(){return z};this.setPageingLimits=function(U){var V=function(X){return function(){l.filter.setLimit(X);l.applyFilter(l.filter,true);return false}};root=document.getElementById("per_page_limit");root.innerHTML="";for(i in l.pageLimits){var W=document.createElement("a");W.className="per_page_limit";W.rel="0";W.innerHTML=l.pageLimits[i];W.onclick=V(l.pageLimits[i]);if(l.pageLimits[i]==U.limit){W.className+=" current"}root.appendChild(W)}};J()};TableItem.minColumnWidth=110;TableItem.maxColumnWidth=800;TableItem.sortPrefix="sort";TableItem.sortGlue="|";TableItem.orderByColumn=function(f,a,c,b){if(!a||!f||!c){return false}var e="asc";if(typeof b=="string"&&b.length>0){e=b}if(a.orderColumn===c){e=c.className=="asc"?"desc":"asc";if(typeof b=="string"&&b.length>0){e=b}c.className=e}else{if(a.orderColumn){a.orderColumn.className=""}a.orderColumn=c;a.orderColumn.className=e}var d=a.dataSet.getDefaultFilter();TableItem.saveSortDirection(f,e,true);d.setOrder(f,e);a.dataSet.setDefaultFilter(d);a.applyFilter()};TableItem.showPreviewImage=function(d,e){if(!d||!e){return}var c=(!d.target)?d.toElement:d.target;var a=(!d.pageX)?d.clientX:d.pageX;var f=(!d.pageY)?d.clientY:d.pageY;var b=document.createElement("img");b.setAttribute("src",e);b.src=e;b.className="img-fieled-preview";b.style.position="absolute";b.style.width="180px";b.style.height="120px";b.style.top=f+10+"px";b.style.left=a+10+"px";b.style.border="1px solid #666";document.body.appendChild(b);c.onmouseout=function(){b.parentNode.removeChild(b)}};TableItem._saveData=function(a,b){if(typeof localStorage!="object"||typeof localStorage.setItem!="function"){return false}localStorage.setItem(a,b);return true};TableItem._getData=function(a){if(typeof localStorage!="object"||typeof localStorage.getItem!="function"){return null}return localStorage.getItem(a)};TableItem._getSortKeyPrefix=function(){var b=uAdmin.data;if(typeof b!="object"){return null}var a=b.module;var c=b.method;return[TableItem.sortPrefix,a,c].join(TableItem.sortGlue)+TableItem.sortGlue};TableItem._getSortKey=function(a){return TableItem._getSortKeyPrefix()?TableItem._getSortKeyPrefix()+a:null};TableItem.getSortDirection=function(a){if(typeof localStorage!="object"||typeof localStorage.getItem!="function"){return null}return TableItem._getData(TableItem._getSortKey(a))};TableItem.saveSortDirection=function(g,f,e){if(typeof localStorage!="object"||typeof localStorage.getItem!="function"){return false}var d=TableItem._getSortKeyPrefix();if(e){for(var c in localStorage){if(localStorage.hasOwnProperty(c)){var b=c.split(d);var a=(b.length===2);if(a){localStorage.removeItem(c)}}}}TableItem._saveData(TableItem._getSortKey(g),f);return true};TableItem.setSavedOrder=function(d,c,a){var b=TableItem.getSortDirection(d);if(typeof b=="string"&&b.length>0){TableItem.orderByColumn(d,c,a,b)}};var TreeToolbar=function(e){var m=this;var b=e;var f=null;var g=parseInt(b.container.style.zIndex)||0;var d=b.iconsPath;var c=b.dataSet;this.highlight=null;this.element=null;this.buttons=new Array();var h=function(){var n=document.createElement("div");n.style.position="absolute";n.style.display="none";n.className="tree_toolbar";a(n,{name:"ico_del",hint:getLabel("js-del-str"),init:function(p){var r=p.element;if(f!==null&&f.permissions&8){var q=d+"ico_del.png";var s=getLabel("js-del-str");if(f.lockedBy){var u=f.lockedBy;var o=typeof(u.lname)=="string"?u.lname:"";var t=typeof(u.lname)=="string"?u.fname:"";q=d+"ico_locked.png";s=getLabel("js-page-is-locked")}r.setAttribute("title",s);r.style.background="url('"+q+"') no-repeat";r.setAttribute("href","#");r.style.visibility="visible"}else{r.style.visibility="hidden"}},release:function(o){if(f!==null){if(f.lockedBy){alert(getLabel("js-page-is-locked"))}else{c.execute("tree_delete_element",{childs:1,element:f.id,handle_item:f})}}return false}});a(n,{name:"ico_add",hint:getLabel("js-add-subpage"),init:function(o){if(f!==null&&f.createLink!==false&&(f.permissions&&f.permissions&4||!f.permissions)){o.element.setAttribute("href",f.createLink);o.element.style.visibility="visible"}else{o.element.style.visibility="hidden"}}});a(n,{name:"ico_edit",hint:getLabel("js-edit-page"),init:function(q){var s=q.element;if(f!==null&&f.editLink!==false&&f.permissions&2){var r=d+"ico_edit.png";var t=getLabel("js-edit-page");var p=f.editLink;if(f.lockedBy){var v=f.lockedBy;var o=typeof(v.lname)=="string"?v.lname:"";var u=typeof(v.lname)=="string"?v.fname:"";r=d+"ico_locked.png";t=getLabel("js-page-is-locked");p="#"}s.setAttribute("title",t);s.style.background="url('"+r+"') no-repeat";s.setAttribute("href",p);s.style.visibility="visible"}else{s.style.visibility="hidden"}},release:function(o){if(f!==null){if(f.lockedBy){alert(getLabel("js-page-is-locked"));return false}}return true}});a(n,{name:"blocking",hint:getLabel("js-disable-page"),icon:d+"ico_block.png",init:function(o){if(f!==null&&f.allowActivity){var p=f.isActive?d+"ico_unblock.png":d+"ico_block.png";var q=f.isActive?getLabel("js-disable-page"):getLabel("js-enable-page");o.element.style.background="url('"+p+"') no-repeat";o.element.setAttribute("href","#");o.element.setAttribute("title",q);o.element.style.visibility="visible"}else{o.element.style.visibility="hidden"}},release:function(o){if(f!==null){var p=f.isActive?d+"ico_block.png":d+"ico_unblock.png";var q=f.isActive?getLabel("js-enable-page"):getLabel("js-disable-page");o.element.setAttribute("title",q);o.element.style.background="url('"+p+"') no-repeat";c.execute("tree_set_activity",{element:f.id,active:f.isActive?0:1,handle_item:f})}return false}});a(n,{name:"copy",hint:getLabel("js-vcopy-str"),init:function(o){if(f!==null&&f.allowCopy){o.element.style.visibility="visible"}else{o.element.style.visibility="hidden"}},release:function(o){if(f!==null){f.className="ti virtual";if(f.isDefault){f.labelControl.className+=" main-page"}f.isVirtualCopy=true;c.execute("tree_copy_element",{element:f.id,childs:1,links:1,virtuals:1,permissions:1,handle_item:f,copy_all:0})}return false}});a(n,{name:"clone",hint:getLabel("js-copy-str"),init:function(o){if(f!==null&&f.allowCopy){o.element.style.visibility="visible"}else{o.element.style.visibility="hidden"}},release:function(o){if(f!==null){c.execute("tree_copy_element",{element:f.id,childs:1,links:1,permissions:1,handle_item:f,copy_all:0,clone_mode:1})}return false}});a(n,{name:"view",hint:getLabel("js-view-page"),init:function(o){if(f!==null&&f.viewLink!==false){o.element.setAttribute("href",f.viewLink);o.element.style.visibility="visible"}else{o.element.style.visibility="hidden"}}});m.element=document.body.appendChild(n)};var l=function(){for(var n=0;n<m.buttons.length;n++){m.buttons[n].init(m.buttons[n])}};var a=function(p,w){var t=document.createElement("a");var n=w.name||"toolbtn";var o=w.href||"#";var s=w.icon||d+n+".png";var v=w.init||function(){};var u=w.hint||"";var q=p.appendChild(t);var r={name:n,href:o,icon:s,init:v,element:q};m.buttons[m.buttons.length]=r;q.setAttribute("href",o);q.setAttribute("title",u);q.className=w.className||"tree_toolbtn";if(typeof(w.release)==="function"){q.onclick=function(){if(!c.isAvailable()){return false}return w.release(r)}}else{q.onclick=function(){if(!c.isAvailable()){return false}if(f.focus){f.focus()}return true}}q.name=n;q.style.background="url('"+s+"') no-repeat"};var k=function(){var n=document.createElement("div");n.className="tree-highlight";n.style.display="none";n.style.position="absolute";n.style.zIndex=g-1;m.highlight=b.container.appendChild(n);h()};this.show=function(p,o){o=o||false;if(typeof(p)==="undefined"||(f===p&&!o)){return false}if(f){f.labelControl.className="ti";if(f.isDefault){f.labelControl.className+=" main-page"}}f=p;f.labelControl.className=f.getSelected()?"ti selected-highlight":"ti hightlight";if(f.isDefault){f.labelControl.className+=" main-page"}l();var n=f.control.initContainer;var q=jQuery(n).position();this.element.style.top=f.position.top+q.top+"px";this.element.style.left=q.left+530+"px";this.element.style.display=""};this.hide=function(){if(f){f.labelControl.className=f.getSelected()?"ti selected":(f.isVirtualCopy?"ti virtual":"ti");if(f.isDefault){f.labelControl.className+=" main-page"}this.element.style.display="none";f=null}};if(typeof(b)==="object"){k()}else{alert("Can't create toolbar without control object")}};var TableToolbar=function(e){var m=this;var b=e;var f=null;var g=parseInt(b.container.style.zIndex)||0;var d=b.iconsPath;var c=b.dataSet;this.highlight=null;this.element=null;this.buttons=new Array();var h=function(){var n=document.createElement("div");n.style.position="absolute";n.style.display="none";n.className="tree_toolbar";n.style.width="140px";a(n,{name:"ico_del",hint:getLabel("js-delete"),init:function(o){var q=o.element;var r=getLabel("js-delete");if(f!==null&&(f.permissions&&f.permissions&8||!f.permissions)){var p=d+"ico_del.png";q.setAttribute("title",r);q.style.background="url('"+p+"') no-repeat";q.setAttribute("href","#");q.style.visibility="visible"}else{q.style.visibility="hidden"}},release:function(o){if(f!==null){c.execute("tree_delete_element",{childs:1,element:f.id,handle_item:f})}return false}});a(n,{name:"ico_edit",hint:getLabel("js-edit-item"),init:function(p){var r=p.element;if(f!==null&&f.editLink!==false&&(f.permissions&&f.permissions&2||!f.permissions)){var q=d+"ico_edit.png";var s=getLabel("js-edit-item");var o=f.editLink;r.setAttribute("title",s);r.style.background="url('"+q+"') no-repeat";r.setAttribute("href",o);r.style.visibility="visible"}else{r.style.visibility="hidden"}},release:function(o){return true}});if(!TableToolbar.disableAddButton){a(n,{name:"ico_add",hint:getLabel("js-add-page"),init:function(o){if(f!==null&&f.createLink!==false){o.element.setAttribute("href",f.createLink);o.element.style.visibility="visible"}else{o.element.style.visibility="hidden"}}})}a(n,{name:"blocking",hint:getLabel("js-disable-page"),icon:d+"ico_block.png",init:function(o){var q=f.allowActivity&&(e.contentType=="pages"||(e.contentType=="objects"&&e.enableObjectsActivity));if(f!==null&&q){var p=f.isActive?d+"ico_unblock.png":d+"ico_block.png";var r=f.isActive?getLabel("js-disable-page"):getLabel("js-enable-page");o.element.style.background="url('"+p+"') no-repeat";o.element.setAttribute("href","#");o.element.setAttribute("title",r);o.element.style.visibility="visible"}else{o.element.style.visibility="hidden"}},release:function(o){if(f!==null){var p=f.isActive?d+"ico_block.png":d+"ico_unblock.png";var q=f.isActive?getLabel("js-enable-page"):getLabel("js-disable-page");o.element.setAttribute("title",q);o.element.style.background="url('"+p+"') no-repeat";c.execute("tree_set_activity",{element:f.id,active:f.isActive?0:1,handle_item:f,selected_items:f.control.selectedList,"object[]":f.id,viewMode:"full"})}return false}});a(n,{name:"view",hint:getLabel("js-view-page"),init:function(o){if(f!==null&&f.getData().guide=="guide"){o.element.setAttribute("href",window.pre_lang+"/admin/data/guide_items/"+f.id+"/");o.element.style.visibility="visible"}else{if(f!==null&&f.viewLink!==false){o.element.setAttribute("href",f.viewLink);o.element.style.visibility="visible"}else{o.element.style.visibility="hidden"}}}});m.element=document.body.appendChild(n)};var l=function(){for(var n=0;n<m.buttons.length;n++){m.buttons[n].init(m.buttons[n])}};var a=function(p,w){var t=document.createElement("a");var n=w.name||"toolbtn";var o=w.href||"#";var s=w.icon||d+n+".png";var v=w.init||function(){};var u=w.hint||"";var q=p.appendChild(t);var r={name:n,href:o,icon:s,init:v,element:q};m.buttons[m.buttons.length]=r;q.setAttribute("href",o);q.setAttribute("title",u);q.className=w.className||"tree_toolbtn";if(typeof(w.release)==="function"){q.onclick=function(){if(!c.isAvailable()){return false}return w.release(r)}}else{q.onclick=function(){if(!c.isAvailable()){return false}if(f.focus){f.focus()}return true}}q.name=n;q.style.background="url('"+s+"') no-repeat"};var k=function(){var n=document.createElement("div");n.className="tree-highlight";n.style.display="none";n.style.position="absolute";n.style.zIndex=g-1;m.highlight=b.container.appendChild(n);h()};this.show=function(t,q){q=q||false;if(typeof(t)==="undefined"||(f===t&&!q)){return false}if(f){f.labelControl.className="ti"}f=t;f.labelControl.className=f.getSelected()?"ti selected-highlight":"ti hightlight";l();var o=f.control.initContainer.parentNode;var u=jQuery(o).position();var p=0;if(f.element.childNodes[p].className=="ti-toggle"){p=1}var s=jQuery(f.element.childNodes[p]);var r=s.position();var n=r.left+s.width()+u.left-7-o.scrollLeft;this.element.style.top=f.position.top+u.top+"px";this.element.style.left=n+"px";this.element.style.display=""};this.hide=function(){if(f){f.labelControl.className=f.getSelected()?"ti selected":(f.isVirtualCopy?"ti virtual":"ti");this.element.style.display="none";f=null}};if(typeof(b)==="object"){k()}else{alert("Can't create toolbar without control object")}};TableToolbar.disableAddButton=false;var ChangeParentsToolbar=function(e){var m=this;var b=e;var f=null;var g=parseInt(b.container.style.zIndex)||0;var d=b.iconsPath;var c=b.dataSet;this.highlight=null;this.element=null;this.buttons=new Array();var h=function(){var n=document.createElement("div");n.style.position="absolute";n.style.display="none";n.className="tree_toolbar";a(n,{name:"ico_move",icon:"ico_move.png",hint:getLabel("js-move-hint"),label:getLabel("js-move-label"),init:function(p){var q=p.element;if(f!==null&&f.permissions&8){if(f.lockedBy){var s=f.lockedBy;var o=typeof(s.lname)=="string"?s.lname:"";var r=typeof(s.lname)=="string"?s.fname:"";p.icon="ico_locked.png";p.hint=getLabel("js-page-is-locked")}q.setAttribute("title",p.hint);q.style.background="url('"+d+p.icon+"') no-repeat";q.setAttribute("href","#");q.style.visibility="visible"}else{q.style.visibility="hidden"}},release:function(o){if(f!==null){if(f.lockedBy){alert(getLabel("js-page-is-locked"))}else{b.applyBehaviour(f)}}return false}});m.element=document.body.appendChild(n)};var l=function(){for(var n=0;n<m.buttons.length;n++){m.buttons[n].init(m.buttons[n])}};var a=function(p,x){var u=document.createElement("a");var n=x.name||"toolbtn";var o=x.href||"#";var t=x.icon||n+".png";var w=x.init||function(){};var r=x.hint||"";var v=x.label||"";var q=p.appendChild(u);var s={name:n,href:o,icon:t,init:w,label:v,hint:r,element:q};m.buttons[m.buttons.length]=s;q.setAttribute("href",o);q.setAttribute("title",r);q.className=x.className||"tree_toolbtn";q.appendChild(document.createTextNode(v));if(typeof(x.release)==="function"){q.onclick=function(){if(!c.isAvailable()){return false}return x.release(s)}}else{q.onclick=function(){if(!c.isAvailable()){return false}if(f.focus){f.focus()}return true}}q.name=n;q.style.background="url('"+t+"') no-repeat"};var k=function(){var n=document.createElement("div");n.className="tree-highlight";n.style.display="none";n.style.position="absolute";n.style.zIndex=g-1;m.highlight=b.container.appendChild(n);h()};this.show=function(p,o){if(window.noToolBar){return}o=o||false;if(typeof(p)==="undefined"||(f===p&&!o)){return false}if(f){f.labelControl.className="ti";if(f.isDefault){f.labelControl.className+=" main-page"}}f=p;f.labelControl.className="ti hightlight";if(f.isDefault){f.labelControl.className+=" main-page"}l();var n=f.control.initContainer;var q=$(n).position();this.element.style.top=f.position.top+q.top+"px";this.element.style.left=q.left+500+"px";this.element.style.display=""};this.hide=function(){if(f){f.labelControl.className=f.getSelected()?"ti selected":(f.isVirtualCopy?"ti virtual":"ti");if(f.isDefault){f.labelControl.className+=" main-page"}this.element.style.display="none";f=null}};this.customize=function(n){__options=n;m.highlight=null;k};if(typeof(b)==="object"){k()}else{alert("Can't create toolbar without control object")}};var AddCopyToolbar=function(e){var m=this;var b=e;var f=null;var g=parseInt(b.container.style.zIndex)||0;var d=b.iconsPath;var c=b.dataSet;this.highlight=null;this.element=null;this.buttons=new Array();var h=function(){var n=document.createElement("div");n.style.position="absolute";n.style.display="none";n.className="tree_toolbar";a(n,{name:"ico_copy",icon:"ico_copy.png",hint:getLabel("js-copy-hint"),label:getLabel("js-copy-label"),init:function(p){var q=p.element;if(f!==null&&f.permissions&8){if(f.lockedBy){var s=f.lockedBy;var o=typeof(s.lname)=="string"?s.lname:"";var r=typeof(s.lname)=="string"?s.fname:"";p.icon="ico_locked.png";p.hint=getLabel("js-page-is-locked")}q.setAttribute("title",p.hint);q.style.background="url('"+d+p.icon+"') no-repeat";q.setAttribute("href","#");q.style.visibility="visible"}else{q.style.visibility="hidden"}},release:function(o){if(f!==null){if(f.lockedBy){alert(getLabel("js-page-is-locked"))}else{b.applyBehaviour(f)}}return false}});m.element=document.body.appendChild(n)};var l=function(){for(var n=0;n<m.buttons.length;n++){m.buttons[n].init(m.buttons[n])}};var a=function(p,x){var u=document.createElement("a");var n=x.name||"toolbtn";var o=x.href||"#";var t=x.icon||n+".png";var w=x.init||function(){};var r=x.hint||"";var v=x.label||"";var q=p.appendChild(u);var s={name:n,href:o,icon:t,init:w,label:v,hint:r,element:q};m.buttons[m.buttons.length]=s;q.setAttribute("href",o);q.setAttribute("title",r);q.className=x.className||"tree_toolbtn";q.appendChild(document.createTextNode(v));if(typeof(x.release)==="function"){q.onclick=function(){if(!c.isAvailable()){return false}return x.release(s)}}else{q.onclick=function(){if(!c.isAvailable()){return false}if(f.focus){f.focus()}return true}}q.name=n;q.style.background="url('"+t+"') no-repeat"};var k=function(){var n=document.createElement("div");n.className="tree-highlight";n.style.display="none";n.style.position="absolute";n.style.zIndex=g-1;m.highlight=b.container.appendChild(n);h()};this.show=function(p,o){o=o||false;if(typeof(p)==="undefined"||(f===p&&!o)){return false}if(f){f.labelControl.className="ti";if(f.isDefault){f.labelControl.className+=" main-page"}}f=p;f.labelControl.className="ti hightlight";if(f.isDefault){f.labelControl.className+=" main-page"}l();var n=f.control.initContainer;var q=$(n).position();this.element.style.top=f.position.top+q.top+"px";this.element.style.left=q.left+500+"px";this.element.style.display=""};this.hide=function(){if(f){f.labelControl.className=f.getSelected()?"ti selected":(f.isVirtualCopy?"ti virtual":"ti");if(f.isDefault){f.labelControl.className+=" main-page"}this.element.style.display="none";f=null}};this.customize=function(n){__options=n;m.highlight=null;k};if(typeof(b)==="object"){k()}else{alert("Can't create toolbar without control object")}};var Control=function(p,a,f){var u=this;var l=p;var g=a;var f=typeof(f)=="object"?f:{};var n=typeof(f.draw)=="boolean"?f.draw:false;var z=typeof(f.expandAll)=="boolean"?f.expandAll:false;var b=typeof(f.toolbar)==="function"?f.toolbar:false;var t=null;var k=null;var o=typeof(f.ignoreHierarchy)==="boolean"?f.ignoreHierarchy:false;var m=typeof(f.onRenderComplete)==="function"?f.onRenderComplete:function(){};var v=new filter();var x=SettingsStore.getInstance();var e=typeof(f.onItemClick)==="function"?f.onItemClick:function(){return true};var c=typeof(f.onItemSelect)==="function"?f.onItemSelect:function(){return true};var r=typeof(f.onTargetSelect)==="function"?f.onTargetSelect:function(){return true};Control.instances[Control.instances.length]=this;this.container=typeof(f.container)=="object"?f.container:document.body;this.dataSet=l;this.toolbar=null;this.items={};this.id=f.id||Math.random();this.iconsPath=f.iconsPath||"/images/cms/admin/mac/tree/";this.flatMode=f.flatMode||false;this.defaultRootMode=f.defaultRootMode||false;this.objectTypesMode=f.objectTypesMode||false;this.contentType=f.contentType||"pages";this.enableObjectsActivity=f.enableObjectsActivity||false;this.lastClicked=null;this.selectedList={};this.targetsList={};this.dragAllowed=typeof(f.allowDrag)=="boolean"?f.allowDrag:true;this.onGetValueCallback=typeof(f.onGetValueCallback)==="function"?f.onGetValueCallback:function(D,B,C){return D};this.onDrawFieldFilter=typeof(f.onDrawFieldFilter)==="function"?f.onDrawFieldFilter:function(C,B){return false};this.onRemoveColumn=typeof(f.onRemoveColumn)==="function"?f.onRemoveColumn:function(B){return false};this.initContainer=this.container;this.disableCSVButtons=f.disableCSVButtons||false;this.hideCsvImportButton=f.hideCsvImportButton||false;this.disableTooManyChildsNotification=f.disableTooManyChildsNotification||false;this.LabelFirstColumn=(typeof(f.label_first_column)!=="undefined"&&typeof(f.label_first_column)==="string")?f.label_first_column:"";this.PerPageLimits=typeof(f.perPageLimits)=="array"?f.perPageLimits:new Array(10,20,50,100);this.enableEdit=f.enableEdit;this.visiblePropsMenu=f.visiblePropsMenu;this.requiredPropsMenu=f.requiredPropsMenu;this.sequencePropsMenu=f.sequencePropsMenu;var q=function(){if(n){u.init()}};var d=function(){if(typeof(u.items[t])==="undefined"){u.items[t]=new g(u,null,{id:(t?t:0),iconbase:"/images/cms/admin/mac/tree/ico_domain.png"})}u.items[t].draw();if(b){u.toolbar=new b(u)}if(u.getItemState(t)||t!==0){u.items[t].expand()}};var y=function(C,B){for(var D=0;D<C.length;D++){if(C[D]===B){return C[D]}}return null};var s=function(F,B,D){if(typeof(B)!="object"||typeof(F)=="undefined"){return false}if(!D){D=false}var E=B.id;for(var C=0;C<F.length;C++){var H=(typeof(F[C]["parentId"])!="undefined")?parseInt(F[C]["parentId"]):0;if(o){H=0}if(H==E||D){var G=parseInt(F[C]["id"]);if(u.items[G]){u.items[G].update(F[C])}else{u.items[G]=B.appendChild(F[C]);if(z||u.getItemState(G)){u.items[G].expand()}}s(F,u.items[G])}}};var h=function(J){var H=J.objects;var D=J.filter;var C=J.paging;var B=D.getParents();var E=false;if(!B.length){B=[(t?t:0)];E=true}for(var F=0;F<B.length;F++){var G=parseInt(B[F]);var I=(typeof(u.items[G])!="undefined")?u.items[G]:u.items[t];s(H,I,E);if(I){I.setLoaded(true);I.setPageing(C)}}m();Control.recalcItemsPosition();if(Control.HandleItem&&u.toolbar){u.toolbar.show(Control.HandleItem,true)}};var w=function(){u.removeItem(t);if(k){if(u.initContainer){u.container=u.initContainer}var B=u.setRootNode(k,true);B.draw()}Control.recalcItemsPosition()};var A=function(H){var T=H.objects;var V=H.error;var M=H.params;var O=M.paging;var G=M.handle_item;var ab=M.selected_items;var Q={};if(ab){Q=ab}else{if(G){Q[G.id]=G}}var B=H.method;if(!V){switch(B.toLowerCase()){case"restore_element":case"tree_delete_element":for(var R in Q){var F=Q[R];u.removeItem(R);delete u.selectedList[R];if(F.parent&&F.parent.parent){s(T,F.parent.parent)}}Control.HandleItem=null;if(u.toolbar){u.toolbar.hide()}break;case"export":var X,ac="";if(H.objects[0].file){window.location=H.objects[0].file}break;case"tree_move_element":var U=M.receiver_item;var N=M.before?U.control.getItem(M.before):null;if(T.length&&G&&U){var K=T[0]||[];var J=T[1]||[];var C=T[2]||[];if(G.parent){G.parent.update(C)}U.update(J);G.control.removeItem(G.id);var F=null;if(M["as-sibling"]){if(N){F=U.appendBefore(K,N)}else{F=U.appendChild(K)}}else{if(U.loaded){F=U.appendFirst(K)}}if(F){U.control.items[F.id]=F}}break;case"move":var U=M.receiver_item;var N=M.before?U.control.getItem(M.before):null;if(T.length&&G&&U){var K=T[0]||[];var J=T[1]||[];var C=T[2]||[];if(G.parent){G.parent.update(C)}U.update(J);G.control.removeItem(G.id);var F=null;if(M["as-sibling"]){if(N){F=U.appendBefore(K,N)}else{F=U.appendChild(K)}}else{if(U.loaded){F=U.appendFirst(K)}}if(F){U.control.items[F.id]=F}}break;case"copy_to_lang":var X,Y,S=false;langId=false;Q=G.control.selectedList;for(X in Q){Y=Q[X];S=Y.domainId;langId=Y.langId}new_langId=M["lang-id"];new_domainId=M["domain-id"];if(new_langId==langId){location.href=location.href}break;case"move_to_lang":var X,Y,S=false;langId=false;Q=G.control.selectedList;for(X in Q){Y=Q[X];langId=Y.langId}new_langId=M["lang-id"];location.href=location.href;break;default:for(var R in Q){var W=u.items[R].parent;ignoreHierarchy=(!u.items[W]);s(T,W,ignoreHierarchy)}}if(u.toolbar&&G===Control.HandleItem){u.toolbar.show(Control.HandleItem,true)}Control.recalcItemsPosition();Control.PrepareDrag=false;Control.startDragItem=null;Control.PrepareDrag=false;Control.DragMode=false}else{var D=jQuery(V).find("type").text();if(D=="__alias__"){var P=new Object;var Z=M;var aa=jQuery(V).find("item"),I=aa.length;aa.each(function(){var ad=jQuery(this).attr("path")+""+jQuery(this).attr("alias");var af="<form method='post' id='' enctype='multipart/form-data' ";af+=" action=''>"+getLabel("js-smc-control-page-already-exist",ad);af+="<br/><label for='new_alias'>"+getLabel("js-content-alias-copy")+"</label> <br/> ";af+=jQuery(this).attr("path")+"<input type='text' name='new_alias"+jQuery(this).attr("id")+"'  value='"+jQuery(this).attr("alt_name_normal")+"'  id='new_alias"+jQuery(this).attr("id")+"' size='15' />";af+="</form>";var ae=this;openDialog({text:af,OKText:getLabel("js-content-alias-new"),cancelText:getLabel("js-content-alias-change"),cancelCallback:function(){Z["move["+jQuery(ae).attr("id")+"]"]=1;if(!--I){E()}},OKCallback:function(){Z["alias["+jQuery(ae).attr("id")+"]"]=jQuery("#new_alias"+jQuery(ae).attr("id")).val();if(!--I){E()}}})});var E=function(){G.control.dataSet.execute(""+B.toLowerCase()+"",Z)}}else{if(D=="__template_not_exists__"){var L=jQuery(V).find("text").text();L=L+"<br/><br/>";openDialog({text:L,stdButtons:0,cancelCallback:function(){},OKCallback:function(){}})}else{alert(V.firstChild.nodeValue)}}}};l.addEventHandler("onAfterLoad",h);l.addEventHandler("onAfterPieceLoad",h);l.addEventHandler("onInitComplete",d);l.addEventHandler("onBeforeRefresh",w);l.addEventHandler("onAfterExecute",A);this.initContainer.style.position="relative";this.init=function(){l.init()};this.load=function(B,C){l.load(B)};this.getItemByPosition=function(D,C){var B=null;for(var F in this.items){if(!this.items[F]){continue}var E=this.items[F].position;if(C>E.top){if(C<=E.bottom){if(D>E.left){if(D<=E.right){B=this.items[F];break}}}}}return B};this.getItem=function(B){if(typeof(this.items[parseInt(B)])=="object"){return this.items[parseInt(B)]}else{return false}};this.setRootNode=function(B,C){k=B;t=B.id;this.items[t]=new g(u,null,B);if(C){this.items[t].loaded=true}return this.items[t]};this.getRootNodeId=function(){return t};this.getRoot=function(){return this.items[t]};this.applyBehaviour=function(B){if(e){return e(B)}return true};this.saveItemState=function(C){var E=parseInt(C);if(this.items[E]){var F=this.items[E];var B=x.get(u.id,"expanded");var D="{"+F.id+"}";if(typeof(B)!="string"){B=""}if(B.indexOf(D)!==-1&&!F.isExpanded){B=B.replace(D,"");x.set(u.id,B,"expanded");return true}else{if(B.indexOf(D)===-1&&F.isExpanded){B+=D;x.set(u.id,B,"expanded");return true}else{return false}}}};this.applyFilter=function(C){this.selectItems([]);if(C!=undefined&&(C instanceof Object)){v=C}if(!v){return}var D=false;for(var B in this.targetsList){this.targetsList[B].applyFilter(v.clone());D=true}if(!D){u.items[t].applyFilter(v.clone(),true)}};this.getCurrentFilter=function(){return v};this.toggleItemSelection=function(B){if(B){if(B.getSelected()){B.setSelected();delete this.selectedList[B.id];c(B,false)}else{B.setSelected(true);this.selectedList[B.id]=B;c(B,true)}}};this.toggleRangeSelection=function(D){if(D){if(!this.lastClicked){return}var C=D.element;var B=this.lastClicked.element;var F=C.parentNode.firstChild;var E=null;var G=[];while(F){if(!E&&F==C){E=B}if(!E&&F==B){E=C}if(E){G.push(this.items[F.rel])}if(F==E){break}F=F.nextSibling}this.selectItems(G)}};this.setSelectionCallback=function(B,D){if(typeof(B)==="function"){if(D){c=B}else{var C=c;c=function(F,E){C(F,E);B(F,E)}}}};this.getSelectionCallback=function(){return c};this.selectItems=function(C){if(!(C instanceof Array)){C=[C]}for(var B in this.selectedList){this.toggleItemSelection(this.selectedList[B])}this.selectedList=new Object;for(var B=0;B<C.length;B++){this.toggleItemSelection(C[B])}};this.setTargetItems=function(C){this.targetsList={};for(var B in C){this.targetsList[B]=C[B]}r(this.targetsList)};this.isTarget=function(B){for(var C in this.targetsList){if(this.targetsList[C]==B){return true}}return false};this.setTargetSelectCallback=function(B){if(typeof(B)==="function"){r=B}};this.getItemState=function(C){var E=parseInt(C);if(this.items[E]){var F=this.items[E];if(!F.hasChilds){return false}var B=x.get(u.id,"expanded");var D="{"+F.id+"}";if(typeof(B)!="string"){B=""}return(B.indexOf(D)!==-1)}};this.removeItem=function(E,B){var F=parseInt(E);if(this.items[F]){var G=this.items[F];var D=G.parent;for(var C=0;C<G.childs.length;C++){this.removeItem(G.childs[C])}G.childs=[];if(!B){this.items[F]=false;G.clear()}}};this.expandAll=function(){z=true;for(id in this.items){this.items[id].expand()}};this.collapseAll=function(){z=false;for(id in this.items){this.items[id].collapse()}};this.recalcItemsPosition=function(){for(id in this.items){if(this.items[id]){this.items[id].recalcPosition()}}};q()};Control.DragMode=false;Control.PrepareDrag=false;Control.startDragX=0;Control.startDragY=0;Control.startDragItem=null;Control.DragSensitivity=7;Control.HandleItem=null;Control.DraggableItem=null;Control.instances=new Array();Control.enabled=true;Control.getInstanceById=function(a){for(var b=0;b<Control.instances.length;b++){if(Control.instances[b].id===a){return Control.instances[b]}}return null};Control.recalcItemsPosition=function(){for(var a=0;a<Control.instances.length;a++){Control.instances[a].recalcItemsPosition()}};Control.detectItemByMousePointer=function(b,h){var g=Control.HandleItem;if(g){var f=jQuery(g.control.initContainer).position();var e=g.position;if(h>e.top+f.top&&h<=e.bottom+f.top&&b>e.left+f.left&&b<=e.right+f.left){return g}}var a=null;for(var d=0;d<Control.instances.length;d++){var c=Control.instances[d];var f=jQuery(c.initContainer).position();a=c.getItemByPosition(b-f.left,h-f.top);if(a){break}}return a};Control.recalcSelectedItems=function(g){if(!Control.instances.length){return}if(Control.DragMode){return}if(!Control.enabled){return}var f=g.target;if(f===document){return}var c=f.tagName.toLowerCase();if(c=="textarea"||c=="input"||c=="select"||c=="option"){return}var b=g.pageX;var h=g.pageY;var a=Control.detectItemByMousePointer(b,h);Control.HandleItem=a;for(var e=0;e<Control.instances.length;e++){if(Control.instances[e].toolbar){Control.instances[e].toolbar.hide()}}if(a){var d=true;if(a.control.toolbar&&d){a.control.toolbar.show(a)}}};Control.handleMouseUp=function(d){if(!Control.enabled){return}if(!Control.DragMode&&Control.HandleItem){if(d.altKey){}else{if((d.ctrlKey||d.metaKey)&&(d.button!=2)){Control.HandleItem.control.toggleItemSelection(Control.HandleItem)}else{if((d.shiftKey)&&(d.button!=2)){Control.HandleItem.control.toggleRangeSelection(Control.HandleItem)}else{var c=d.target;if(c.className.toLowerCase()!="ti-toggle"){var a=true;if(d.button==2){for(var b in Control.HandleItem.control.selectedList){if(Control.HandleItem.control.selectedList[b].id==Control.HandleItem.id){a=false}}}if(a){Control.HandleItem.control.selectItems(Control.HandleItem)}}}}}Control.HandleItem.control.lastClicked=Control.HandleItem}Control.PrepareDrag=false;Control.startDragItem=null;Control.DragMode=false};jQuery(document).bind("mousemove",Control.recalcSelectedItems);jQuery(document).bind("mousedown",function(b){Control.recalcSelectedItems(b);if(!Control.HandleItem){return}if(b.button!=0){return}if(!Control.enabled){return}var a=b.target;if(a.className.toLowerCase()!="ti-toggle"){Control.PrepareDrag=true;Control.startDragItem=Control.HandleItem;Control.startDragX=b.pageX;Control.startDragY=b.pageY}});jQuery(document).bind("mouseup",function(a){if(a.button!=2){Control.handleMouseUp(a)}});jQuery(window).bind("resize",function(a){Control.recalcItemsPosition()});function createAddButton(d,f,c,b){d.ControlInstance=f;var a=function(){var h=0;var p=null;var g=false;var l;for(l in f.selectedList){h++;p=l}for(l=0;l<b.length;l++){if((p==null&&b[l]===true)||(p!=null&&(b[l]===f.selectedList[p].baseMethod||b[l]==="*"))){g=true;break}}var o=c.replace(/\{id\}/,(p||"0"));o=o.replace(/\{\$param0\}/,(p||"0"));o=o.replace(/\{\$pre_lang\}/,window.pre_lang);var n=document.getElementById("domainSelect"+f.id);if(n){var m=n.options[n.selectedIndex].text;if(o.indexOf("?")!=-1){o=o+"&domain="+m}else{o=o+"?domain="+m}}d.addLink=o;for(var l=0;l<d.linkCache.length;l++){d.linkCache[l].href=d.addLink;d.linkCache[l]["param0"]=(p||"0")}if(d.tagName.toLowerCase()=="a"){d.href=d.addLink;d.param0=(p||"0")}var k=false;if(h>1||!g){if(d.style.display!="none"){d.style.display="none";k=true}}else{if(d.style.display=="none"){d.style.display="";k=true}}if(k){Control.recalcItemsPosition()}};f.setSelectionCallback(function(h,g){setTimeout(a,100)});var e=c.replace(/\{id\}/,"0");e=e.replace(/\{\$param0\}/,"0");e=e.replace(/\{\$pre_lang\}/,window.pre_lang);d.addLink=e;d.linkCache=d.getElementsByTagName("a");a()}function filterController(k,w,g,I,Y){var r=this;var aa=null;var D=null;var X=null;var F=null;var W=null;var ae=null;var P=null;var Q=null;var ab=null;var h=null;var y=null;var N=w;var V=null;var l=0;var v=5000;var u=new Object();var S=new Object();var G=k.id+"_fc";var T=null;var ac=new Object();var E=null;var B=true;var n=I;var Z=(Y&&Y.nativeAdvancedMode);var e=function(ai,ah,af){if(ai!="name"){if(af&&af[1]==="static"){return}var aj=G+"_id_"+ai.fieldName;if(!ai.dataType){ai.dataType="string"}var ag=m(ai.dataType,aj,ai.fieldName,ai.guideId,false);if(ag){u[ai.fieldName]=ai;S[ai.fieldName]=ag;if(af&&af[0]){ag.style.width=af[0]}ah.appendChild(ag)}else{}}};var c=function(af){if(af!="name"){delete u[af.fieldName];delete S[af.fieldName]}};this.control=null;this.getId=function(){return G};this.changeMode=function(){if(B){B=false;X.style.display="block";D.style.display="none";ab.childNodes[0].nodeValue=getLabel("js-filter-normal-mode")}else{B=true;X.style.display="none";D.style.display="";ab.childNodes[0].nodeValue=getLabel("js-filter-extended-mode")}Control.recalcItemsPosition()};var a=function(ag){var af=(window.event)?event.keyCode:ag.keyCode;if(af==13){r.applyFilter()}};var ad=function(ag){var af=(window.event)?event.keyCode:ag.keyCode;if(af==13){if(Z){r.applyFilter()}else{r.applyFilterAdvanced()}}};var s=function(af){if(Z){}else{r.applyFilterAdvanced()}};this.applyFilterAdvanced=function(){if(l>0){return}var ah=new filter();for(var af in S){if(S[af].tagName.toLowerCase()=="select"){var am=S[af].options[S[af].selectedIndex].value;if(am!=-2){ah.setPropertyEqual(af,am)}}else{switch(S[af].type){case"button":break;case"checkbox":ah.setPropertyEqual(af,S[af].checked?1:0);break;case"text":var ak=u[af].dataType;switch(ak){case"tags":var an=S[af].value.split(",");for(var ai=0;ai<an.length;ai++){an[ai]=an[ai].replace(/^\s+|\s+$/,"")}if(an.length){ah.setPropertyLike(af,an)}break;case"float":case"price":case"counter":case"int":var am=S[af].value.replace(/^\s+|\s+$/,"");if(!am.length){break}if(am[0]=="<"){ah.setPropertyLess(af,am.replace(/[^\d.]*/,""))}else{if(am[0]==">"){ah.setPropertyGreater(af,am.replace(/[^\d.]*/,""))}else{am=am.split("-");if(am.length>1){ah.setPropertyBetween(af,am[0].replace(/[^\d.]*/,""),am[1].replace(/[^\d.]*/,""))}else{ah.setPropertyEqual(af,am[0].replace(/[^\d.]*/,""))}}}break;case"date":var ag=[];var am=S[af].value;if(S[af].isEmpty!=undefined&&S[af].isEmpty==true){break}if(am.length>0){var aj=-1;var al=am.indexOf("-");if((aj=am.indexOf("<"))!=-1){ah.setPropertyLess(af,(al!=-1)?am.substring(aj+1,al-1):am.substring(aj+1))}else{if((aj=am.indexOf(">"))!=-1){ah.setPropertyGreater(af,(al!=-1)?am.substring(aj+1,al-1):am.substring(aj+1))}else{if(al!=-1){ag=am.split(/\s-\s/)}if(ag.length==2){ah.setPropertyBetween(af,ag[0],ag[1])}else{ah.setPropertyEqual(af,am)}}}}break;case"relation":if(S[af].value.length){ah.setPropertyEqual(af,S[af].value)}break;default:if(S[af].value.length){ah.setPropertyLike(af,S[af].value)}}break;default:if(S[af].value.length){ah.setPropertyEqual(af,S[af].value)}}}}ah.setConditionModeOr(false);V.applyFilter(ah)};this.applyFilter=function(){var ag=new filter();if(B){var ao=aa.value.replace(/^\s*|\s*$/,"");if(ao.length==0){if(!(V.flatMode||V.objectTypesMode||V.defaultRootMode)){ag.setParentElements(0)}}else{if(/^".*"$|^'.*'$/.test(ao)){ao=ao.substr(1,ao.length-2)}else{ao=ao.split(" ")}ag.setAllTextSearch(ao)}ag.setConditionModeOr(true);var an=$(V.container).find(".search_result");if(ao.length>0){an.addClass("active");an.html(getLabel("js-search-result"))}else{an.removeClass("active");an.html("")}}else{var aj=X.getElementsByTagName("input");for(var ai=0;ai<aj.length;ai++){switch(aj[ai].type){case"button":break;case"checkbox":ag.setPropertyEqual(aj[ai].name,aj[ai].checked?1:0);break;case"text":var al=u["row_"+aj[ai].id].field.getElementsByTagName("type")[0].getAttribute("data-type");switch(al){case"tags":var ap=aj[ai].value.split(",");for(var ah=0;ah<ap.length;ah++){ap[ah]=ap[ah].replace(/^\s+|\s+$/,"")}ag.setPropertyEqual(aj[ai].name,ap);break;case"float":case"price":case"int":var ao=aj[ai].value.replace(/^\s+|\s+$/,"");if(ao[0]=="<"){ag.setPropertyLess(aj[ai].name,ao.replace(/[^\d.]*/,""))}else{if(ao[0]==">"){ag.setPropertyGreater(aj[ai].name,ao.replace(/[^\d.]*/,""))}else{ao=ao.split("-");if(ao.length>1){ag.setPropertyBetween(aj[ai].name,ao[0].replace(/[^\d.]*/,""),ao[1].replace(/[^\d.]*/,""))}else{ag.setPropertyEqual(aj[ai].name,ao[0].replace(/[^\d.]*/,""))}}}break;case"date":var af=[];var ao=aj[ai].value;if(aj[ai].isEmpty!=undefined&&aj[ai].isEmpty==true){break}if(ao.length>0){var ak=-1;var am=ao.indexOf("-");if((ak=ao.indexOf("<"))!=-1){ag.setPropertyLess(aj[ai].name,(am!=-1)?ao.substring(ak+1,am-1):ao.substring(ak+1))}else{if((ak=ao.indexOf(">"))!=-1){ag.setPropertyGreater(aj[ai].name,(am!=-1)?ao.substring(ak+1,am-1):ao.substring(ak+1))}else{if(am!=-1){af=ao.split(/\s-\s/)}if(af.length==2){ag.setPropertyBetween(aj[ai].name,af[0],af[1])}else{ag.setPropertyEqual(aj[ai].name,ao)}}}}break;case"relation":ag.setPropertyLike(aj[ai].name,aj[ai].value);break;default:ag.setPropertyLike(aj[ai].name,aj[ai].value)}break;default:ag.setPropertyEqual(aj[ai].name,aj[ai].value)}}aj=X.getElementsByTagName("select");for(var ai=0;ai<aj.length;ai++){if(aj[ai].id=="select_"+G){continue}var ap=new Array();for(var ah=0;ah<aj[ai].options.length;ah++){if(aj[ai].options[ah].selected){ap.push(aj[ai].options[ah].value)}}ag.setPropertyEqual(aj[ai].name,ap)}if(Z){ag.setConditionModeOr(!W.checked)}else{ag.setConditionModeOr(true)}}V.applyFilter(ag)};var d=function(af){return function(){var ai=document.getElementById(af);if(ai){ai.parentNode.removeChild(ai);u[af].used=false;while(Q.childNodes.length){Q.removeChild(Q.firstChild)}var ak=new Array();var aj=0;for(var ag in u){if(u[ag].used){ak.push(u[ag].field.getAttribute("id"));aj++}else{var ah=document.createElement("option");ah.value=ag;ah.appendChild(document.createTextNode(u[ag].field.getAttribute("title")));Q.appendChild(ah);var ak=new Array()}}SettingsStore.getInstance().set(G,ak.join(","),E?""+E:"default");if(aj>1){F.style.display=""}else{F.style.display="none"}Q.style.display="none";Q.style.display=""}Control.recalcItemsPosition()}};var z=function(){if(!Q.options.length){return}var ai=Q.options[Q.selectedIndex].value;var ah=J(u[ai].field);if(ah){u[ai].used=true;X.getElementsByTagName("table")[0].tBodies[1].appendChild(ah);Q.removeChild(Q.options[Q.selectedIndex]);var ag=new Array();for(var af in u){if(u[af].used){ag.push(u[af].field.getAttribute("id"))}}SettingsStore.getInstance().set(G,ag.join(","),E?""+E:"default");if(ag.length>1){F.style.display=""}else{F.style.display="none"}Control.recalcItemsPosition();Q.style.display="none";Q.style.display=""}};var o=function(af,ah){var ag=af;var aj={x:ag.offsetLeft||0,y:ag.offsetTop||0};while(ag=ag.offsetParent){aj.x+=ag.offsetLeft;aj.y+=ag.offsetTop}aj.x+=af.offsetWidth;aj.y+=af.offsetHeight;var ak="tip_"+G+Math.random();var ai=document.createElement("div");ai.id=ak;ai.className="fcTip";ai.style.zIndex=50;ai.style.position="absolute";ai.style.left=aj.x+"px";ai.style.top=aj.y+"px";ai.appendChild(document.createTextNode(ah));document.body.appendChild(ai);setTimeout(function(){ai.parentNode.removeChild(ai)},v)};var O=function(af,ag){var ah=null;var ai="";switch(ag){case"int":ah=new RegExp("^[<>]?[ ]?\\d*( ?- ?\\d*)?$");ai=getLabel("js-filter-enter-natural-number");break;case"float":ah=new RegExp("^[<>]?[ ]?\\d*[\\.]*\\d*( ?- ?\\d*[\\.]*\\d*)?$");ai=getLabel("js-filter-enter-float-number");break;case"date":ah=/(^[<>]{1}.*)|(^(((\d\d?[.]\d\d?([.]\d\d(\d\d)?)?)?((\s+|^\s*)\d\d?:\d\d)?)|||||)?(\s*-\s*(((\d\d?[.]\d\d?([.]\d\d(\d\d)?)?)?(\s+\d\d?:\d\d)?)|||||))?)$/i;break}var aj=function(){if(af){var ak=af.className.indexOf("_error");if(!ah.test(af.value)){if(ak<0){af.className+="_error";l++}}else{if(ak>=0){af.className=af.className.substr(0,ak);l--}}}};return aj};var t=function(al,ak){if(ac[ak]==undefined){var ao=function(aq){if(!aq.responseXML.getElementsByTagName("empty").length){var at=aq.responseXML.getElementsByTagName("object");var ap=[];if(!Z){ap.push({id:-2,value:""})}for(var ar=0;ar<at.length;ar++){ap.push({id:at[ar].getAttribute("id"),value:at[ar].getAttribute("name")})}ac[ak]=ap}else{ac[ak]="empty"}t(al,ak)};var af="/admin/data/guide_items_all/"+ak+".xml?allow-empty";R(af,ao);return}if(ac[ak]!=="empty"){for(var ai in ac[ak]){var aj=document.createElement("option");aj.value=ac[ak][ai].id;aj.appendChild(document.createTextNode(ac[ak][ai].value));al.appendChild(aj)}}else{var ag=al.name;var ah=al.id;var am=m("string",ah,ag,ak,false);var an=al.parentNode;an.removeChild(al);an.appendChild(am);if(S[ag]){S[ag]=am}}};var q=function(ag,ah,ai){if(typeof(ag[ah])=="function"){var af=ag[ah];ag[ah]=function(aj){af(aj);ai(aj)}}else{ag[ah]=ai}};var f=function(ag){var af=document.createElement("input");if(ag instanceof Object){for(i in ag){af.setAttribute(i,ag[i])}}return af};var m=function(an,at,ai,am,ao){var ap=null;switch(an){case"string":case"wysiwyg":case"text":case"password":case"tags":ap=f({type:"text","class":"fcStringInput",name:ai,id:at});ap.className="fcStringInput";break;case"date":ap=f({type:"text","class":"fcStringInput",name:ai,id:at});ap.className="fcStringInput";ap.onkeyup=O(ap,"date");var al=getLabel("js-filter-date-format");ap.value=al;ap.isEmpty=true;ap.onfocus=function(){if(this.isEmpty){this.value="";this.isEmpty=false}};ap.onblur=function(){if(this.value.length==0){this.value=al;this.isEmpty=true}};break;case"boolean":var af="0";case"file":case"img_file":case"swf_file":var aj=af||"-1";if(!Z){ap=document.createElement("select");ap.className="fcSelectInput";ap.name=ai;ap.id=at;ap.multiple=false;var ah=document.createElement("option");var ar=document.createElement("option");var ak=document.createElement("option");ah.value="1";ar.value=aj;ak.value="-2";var aq=(an=="boolean")?getLabel("js-value-yes"):getLabel("js-value-file-yes");var ag=getLabel("js-value-no");ah.appendChild(document.createTextNode(aq));ar.appendChild(document.createTextNode(ag));ak.appendChild(document.createTextNode(" "));ap.appendChild(ak);ap.appendChild(ah);ap.appendChild(ar);break}ap=f({type:"checkbox","class":"fcBooleanInput",name:ai,id:at});ap.className="fcBooleanInput";break;case"int":case"counter":ap=f({type:"text","class":"fcStringInput",name:ai,id:at});ap.className="fcStringInput";ap.onkeyup=O(ap,"int");break;case"float":case"price":ap=f({type:"text","class":"fcStringInput",name:ai,id:at});ap.className="fcStringInput";ap.onkeyup=O(ap,"float");break;case"relation":ap=document.createElement("select");ap.className="fcSelectInput";ap.name=ai;ap.id=at;ap.multiple=(ao!=undefined&&ao==false)?false:true;t(ap,am);break}if(ap){q(ap,"onkeyup",ad);if(ap.tagName.toLowerCase()=="select"){ap.onchange=s}}return ap};var J=function(al){var ak=al.getElementsByTagName("type")[0];var an=null;var af=al.getAttribute("name");var ah=G+"_id_"+af;var ai="row_"+ah;an=m(ak.getAttribute("data-type"),ah,af,al.getAttribute("guide-id"));if(an==null){return null}var aq=document.createElement("tr");var ao=document.createElement("td");var aj=document.createElement("td");var ag=document.createElement("td");var am=document.createElement("label");am.setAttribute("for",ah);am.appendChild(document.createTextNode(al.getAttribute("title")));ao.className="fcTitleCell";ao.appendChild(am);aj.className="fcValueCell";aj.appendChild(an);var ap=document.createElement("img");ap.className="fcDeleteImage";ap.src=T+"field_delete.png";ap.alt=getLabel("js-filter-remove-field");ap.title=getLabel("js-filter-remove-field");ap.onclick=d(ai);ag.className="fcDeleteCell";ag.appendChild(ap);aq.id=ai;aq.appendChild(ao);aq.appendChild(aj);aq.appendChild(ag);return aq};var b=function(){if(!Z){return}while(P.tBodies[1].childNodes.length){P.tBodies[1].removeChild(P.tBodies[1].firstChild)}while(Q.childNodes.length){Q.removeChild(Q.firstChild)}var ai=0;for(var af in u){if(u[af].used){var ah=J(u[af].field);if(ah){P.tBodies[1].appendChild(ah);ai++}}else{var ag=document.createElement("option");ag.value=af;ag.appendChild(document.createTextNode(u[af].field.getAttribute("title")));Q.appendChild(ag)}}Q.disabled=false;if(F){if(ai>1){F.style.display=""}else{F.style.display="none"}}Control.recalcItemsPosition()};var p=function(am){if(Z){var av=document.createElement("div");ab=document.createElement("a");ab.href="javascript:filterController.getInstanceById('"+G+"').changeMode();";av.className="fcModeContainer";av.appendChild(ab);ab.appendChild(document.createTextNode(getLabel("js-filter-extended-mode")))}D=document.createElement("div");D.className="fcContainer";aa=f({type:"text","class":"fcQuicksearchInput",name:"quicksearch",id:G+"_id_quicksearch"});var az=f({type:"button",value:getLabel("js-filter-do")});aa.className="fcQuicksearchInput";az.className="fcApplyButton";az.onclick=r.applyFilter;aa.onkeyup=a;D.appendChild(aa);D.appendChild(az);if(Z){X=document.createElement("div");P=document.createElement("table");P.className="fcTable";P.appendChild(document.createElement("tbody"));P.appendChild(document.createElement("tbody"));P.appendChild(document.createElement("tbody"));var ah=document.createElement("tr");var aw=document.createElement("td");var aB=document.createElement("td");var au=document.createElement("td");var ar=document.createElement("img");Q=document.createElement("select");Q.className="fcAddSelect";Q.id="select_"+G;Q.style.width="100%";ar.className="fcAddImage";ar.src=T+"field_add.png";ar.alt=getLabel("js-filter-add-field");ar.title=getLabel("js-filter-add-field");ar.onclick=z;aB.className="fcFreeFieldsCell";au.className="fcAddCell";aw.appendChild(document.createTextNode(getLabel("js-filter-fields-list")));aB.colSpan=1;aB.appendChild(Q);au.appendChild(ar);ah.appendChild(aw);ah.appendChild(aB);ah.appendChild(au);P.tBodies[0].appendChild(ah);var al=document.createElement("tr");var aC=document.createElement("td");aC.colSpan=3;aC.innerHTML="&nbsp;";al.appendChild(aC);P.tBodies[0].appendChild(al);ah.className="fcAddRow";var ag=document.createElement("tr");var an=document.createElement("td");an.colSpan=3;an.className="fcLogicCell";F=document.createElement("div");W=f({type:"radio","class":"fcLogicInput",value:"and",name:G+"_logic",id:G+"_logic_and",checked:true,selected:true});ae=f({type:"radio","class":"fcLogicInput",value:"or",name:G+"_logic",id:G+"_logic_or"});var aq=document.createElement("span");var ay=document.createElement("label");var ap=document.createElement("label");var ao=document.createElement("span");var aj=document.createElement("span");aq.className="fcLogicTitle";aq.appendChild(document.createTextNode(getLabel("js-filter-search-matches")));F.appendChild(aq);W.style.border="0";ae.style.border="0";ay.className="fcLogicLabel";ay.htmlFor=G+"_logic_and";ao.className="fcLogicLine";ay.appendChild(document.createTextNode(getLabel("js-filter-with-all-fields")));ao.appendChild(ay);ao.appendChild(W);F.appendChild(ao);aj.className="fcLogicLine";ap.className="fcLogicLabel";ap.htmlFor=G+"_logic_or";ap.appendChild(document.createTextNode(getLabel("js-filter-one-at-least")));aj.appendChild(ap);aj.appendChild(ae);F.appendChild(aj);an.appendChild(F);ag.appendChild(an);P.tBodies[2].appendChild(ag);var ak=document.createElement("tr");var af=document.createElement("td");applyButton=f({type:"button",value:getLabel("js-filter-do")});applyButton.onclick=r.applyFilter;applyButton.className="fcApplyButton";af.colSpan=3;af.className="fcApplyCell";af.appendChild(applyButton);ak.appendChild(af);P.tBodies[2].appendChild(ak);X.className="fcContainer";X.style.display="none";X.appendChild(P)}var aA=document.createElement("div");var at=document.createElement("span");y=document.createElement("span");at.appendChild(document.createTextNode(getLabel("js-filter-current-rubrics")));aA.appendChild(at);aA.appendChild(y);aA.className="fcTargetContainer";H();var ai=document.createElement("div");ai.style.clear="both";ai.innerHTML="&nbsp;";if(n){n.appendChild(D);if(Z){n.appendChild(av);n.appendChild(X)}n.appendChild(aA)}else{n=document.createElement("div");n.className="filter-container";n.appendChild(D);if(Z){n.appendChild(av);n.appendChild(X)}n.appendChild(aA);V.container.parentNode.insertBefore(n,V.container)}var ax=document.createElement("div");ax.className="clear";V.container.parentNode.insertBefore(ax,V.container);if(Z){W.checked=true;b()}};var L=function(){if(window.XMLHttpRequest){try{return new XMLHttpRequest()}catch(af){}}else{if(window.ActiveXObject){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(af){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(af){}}}return null};var R=function(ah,af){var ag=L();ag.onreadystatechange=function(){if(ag.readyState!=4){return}if(ag.status==200){af(ag)}else{K("Request failed")}};ag.open("GET",ah,true);ag.send(null)};this.init=function(){if(Z){var af=function(ai){var ah=ai.responseXML.getElementsByTagName("field");x(ah);p(ai.responseXML)};var ag=V.dataSet.getCommonTypeId();if(ag>0){N=ag}if(N){sUrl="/utype/"+N+"/"}else{sUrl="/utype/dominant/"+N+"/"}R(sUrl,af)}else{p(null)}};var x=function(ai){var ao=ai;var au=["symlink"];var aq=null;var ak=false;var ap=SettingsStore.getInstance().get(G,(E)?""+E:"default");var ar=(ap===false)?new Array():ap.split(",");var at=false;var ah=V.dataSet.getFieldsStoplist();for(var an=0;an<ao.length;an++){var af=ao[an].getAttribute("name");ak=false;aq=ao[an].getElementsByTagName("type")[0].getAttribute("data-type");for(var am=0;am<ah.length;am++){if(af==ah[am]){ak=true;break}}for(var am=0;am<au.length&&!ak;am++){if(aq==au[am]){ak=true;break}}if(!ak){var ag="row_"+G+"_id_"+ao[an].getAttribute("name");var aj=ao[an].getAttribute("id");at=false;for(var al=0;al<ar.length;al++){if(aj==ar[al]){at=true;break}}u[ag]={used:at,field:ao[an]}}}};var K=function(af){};var C=false;var A=function(){var af=this.id.substr((G+"_link_").length);delete V.targetsList[af];U({});return false};var M=function(ag,ah){var af=document.createElement("a");af.className="fcTarget";af.id=G+"_link_"+ag;af.href="#";af.title=getLabel("js-filter-delete-category");af.onclick=A;af.appendChild(document.createTextNode(ah));if(y.childNodes.length){y.appendChild(document.createTextNode(", "))}y.appendChild(af)};var H=function(){y.parentNode.style.display="none"};var U=function(ag){var ai=false;var aj=null;var af=0;while(y.firstChild){y.removeChild(y.firstChild)}for(var ah in V.targetsList){af++;aj=V.targetsList[ah].id;M(V.targetsList[ah].id,V.targetsList[ah].name)}if(!af){H()}else{y.parentNode.style.display=""}if(Z){if(af==1){sUrl="/utype/dominant/"+aj+"/";ai=true;E=aj}else{sUrl="/utype/"+N+"/";ai=false;E=null}if(C!=ai){u=new Object();Q.disabled=true;R(sUrl,function(al){if(al.responseXML){var ak=al.responseXML.getElementsByTagName("field");if(ak.length){x(ak)}b()}});C=ai}}};if(!(k==undefined||w==undefined)){filterController.instances[filterController.instances.length]=this;V=k;this.control=V;N=!w?0:w;T=V.iconsPath;if(!Z){V.onDrawFieldFilter=e;V.onRemoveColumn=c}V.setTargetSelectCallback(U);if(g==undefined||g==false){this.init()}else{V.dataSet.addEventHandler("onInitComplete",this.init)}}}filterController.instances=new Array();filterController.getInstanceById=function(a){for(var b=0;b<filterController.instances.length;b++){if(filterController.instances[b].getId()===a){return filterController.instances[b]}}return null};function TemplatesDataSet(){var c=null,a=null,f=null;var b=function(){if(window.XMLHttpRequest){try{return new XMLHttpRequest()}catch(k){}}else{if(window.ActiveXObject){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(k){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(k){}}}return null};var e=function(){var k="/admin/content/domainTemplates.xml";var m=b();var l=function(){if(m.readyState!=4){return}if(m.status==200){d(m)}else{return false}};m.onreadystatechange=l;m.open("GET",k,true);m.send(null)};var d=function(k){var l=k.responseXML;c=h(l.getElementsByTagName("template"));a=h(l.getElementsByTagName("domain"));f=h(l.getElementsByTagName("lang"))};var g=function(n){var l=[];l.nodeValue=(n.textContent||n.text);for(var m=0;m<n.attributes.length;m++){var k=n.attributes.item(m);l[k.nodeName]=k.nodeValue}return l};var h=function(o){var k=new Array();for(var l=0;l<o.length;l++){var m=o[l];var n=g(m);k.push(n)}return k};this.getLangsList=function(){return f};this.getDomainsList=function(){return a};this.getTemplatesList=function(n,o){if(!n&&!o){return c}var k=new Array();for(var l=0;l<c.length;l++){var m=c[l];if(m["domain-id"]==n&&m["lang-id"]==o){k.push(m)}}return k};e()}TemplatesDataSet.instance=null;TemplatesDataSet.getInstance=function(){if(!TemplatesDataSet.instance){TemplatesDataSet.instance=new TemplatesDataSet}return TemplatesDataSet.instance};function dataSet(a,c,d,o){var v=a;var A=(d!=undefined)?d:"";var l="";var n=null;var M=[];var K=false;var g=false;var t=[];var b=[];var k=0;var E=[];var G="";var J=[];var I=0;var p=[];var w=[];var F=[];var q=[];var m=[];var z=[];var s=[];var B=[];var e=[];var o=(typeof(o)==="object")?o:{};var D=Array.isArray(o.onInitEndRequests)?o.onInitEndRequests:[];this.init=function(){if(g){return true}g=true;var O=function(R){if(R.responseXML){b=R.responseXML.getElementsByTagName("group")}K=true;if(!h("onInitComplete")){return false}};var N=function(ab){var ad=ab.responseXML.getElementsByTagName("method");for(var Z=0;Z<ad.length;Z++){var U=ad[Z];if(U.getAttribute("forload")=="true"){l=U.childNodes[0].nodeValue;continue}var T={};for(var Y=0;Y<U.attributes.length;Y++){var R=U.attributes[Y];if(R.nodeName=="aliases"){continue}T[R.nodeName]=R.nodeValue}T.name=U.childNodes[0].nodeValue;var aa=U.getAttribute("aliases");if(aa){T.aliases=aa.split(",");for(var X=0;X<T.aliases.length;X++){T.aliases[X]=T.aliases[X].replace(/^\s+|\s+$/,"")}}else{T.aliases=[]}t.push(T)}var V=ab.responseXML.getElementsByTagName("exclude");if(V.length){for(var Z=0;Z<V.length;Z++){if(V[Z].childNodes.length){E.push(V[Z].childNodes[0].nodeValue)}}}var ae=ab.responseXML.getElementsByTagName("default");if(ae.length&&ae[0].childNodes.length){G=ae[0].childNodes[0].nodeValue}var W=ab.responseXML.getElementsByTagName("type");if(W.length){for(var Z=0;Z<W.length;Z++){if(!W[Z].getAttribute("common")){continue}var ac=W[Z].getAttribute("common").toLowerCase();if(ac=="1"||ac=="true"){k=W[Z].getAttribute("id");var S="/utype/"+k+"/";y(S,O);break}else{if(ac=="custom"){k=W[Z].getAttribute("id");var S=k;y(S,O)}}}}else{K=true;if(!h("onInitComplete")){return false}}};var Q=function(T){var S=null;for(var R=0;R<T.length;R++){S=T[R];if(typeof(S.url)==="string"&&typeof(S.callback)==="function"){y(S.url,S.callback)}}};var P="/admin/"+v+"/dataset_config.xml"+(A.length?("?param="+A):"");y(P,N);Q(D);return g};this.load=function(P){if(!K){return false}if(!h("onBeforeLoad")){return false}var N=function(R){var Q={};var S=H(R.responseXML,false,Q);var T={objects:S,filter:P,paging:Q};if((typeof(S)=="string")||(S===null)){T.error=S}K=true;if(!h("onAfterLoad",T)){return false}};var O="/admin/"+v+"/"+l+".xml"+L(P,true);y(O,N)};this.getPathModuleMethod=function(){return"/admin/"+v+"/"+l};this.refresh=function(T){if(!K){return false}if(!h("onBeforeRefresh")){return false}if(M.length){var S="/admin/"+v+"/"+l+".xml";var O=0;var N=function(W,Z){var V={};var X=H(W.responseXML,false,V);var Y={objects:X,filter:Z,paging:V};if((typeof(X)=="string")||(X===null)){Y.error=X}h("onAfterPieceLoad",Y);O++;if(O>=M.length){K=true;if(!h("onAfterRefresh",{objects:J})){return false}}else{y(S+L(M[O]),N,M[O])}};K=false;y(S+L(M[O]),N,M[O])}else{var Q=function(W,Z){var V={};var X=H(W.responseXML,false,V);var Y={objects:X,filter:new filter(),paging:V};if((typeof(X)=="string")||(X===null)){Y.error=X}K=true;h("onAfterPieceLoad",Y);h("onAfterRefresh",{objects:J})};var U=[];var P="";if(T==undefined||T==false){P="id"}else{P="rel"}for(var R=0;R<J.length;R++){U.push(J[R][P])}K=false;var S="/admin/"+v+"/"+l+".xml?"+P+"="+U.join(",");J=[];y(S,Q)}};this.isMethodSupported=function(Q,S){var O=Q.toUpperCase();var N=(S!=undefined&&S==true)?true:false;for(var R in t){if(typeof(t[R])==="function"){continue}if(t[R].name.toUpperCase()==O){return N?t[R].name:true}for(var P=0;P<t[R].aliases.length;P++){if(t[R].aliases[P].toUpperCase()==O){return N?t[R].name:true}}}return false};this.getMethodsList=function(){return t};this.getCommonFields=function(){return b};this.getDefaultFields=function(){return G};this.getFieldsStoplist=function(){return E};this.getCommonTypeId=function(){return k};this.execute=function(V,P){if(!K){return false}var W=this.isMethodSupported(V,true);if(!W){return false}var T={method:V,params:P,objects:[]};if(!h("onBeforeExecute",T)){return false}var U=function(Y){Control.enabled=true;var X={};var Z=H(Y.responseXML,true,X);r(Z);T.objects=Z;T.paging=X;if((typeof(Z)=="string")||(Z===null)){T.error=Z}if(Z.error){T.error=Z.error}T.HandleItem=jQuery.extend(true,{},Control.HandleItem);K=true;if(!h("onAfterExecute",T)){return false}};var S=x(W);var N=window.pre_lang+"/admin/"+S+"/"+W+".xml";var Q=new Array("csrf="+csrfProtection.getToken());for(var O in P){if(P[O] instanceof Array){for(var R=0;R<P[O].length;R++){Q.push(O+"[]="+P[O][R])}}else{Q.push(O+"="+P[O])}}K=false;N=N+"?"+Q.join("&");y(N,U)};this.getLoadedTree=function(){return J};this.isAvailable=function(){return K};this.clearFiltersCache=function(){M=[]};this.setDefaultFilter=function(N){n=N};this.getDefaultFilter=function(){return n};this.addEventHandler=function(P,N){var O=C(P);if(O===null){return false}O[O.length]={active:true,handler:N};return O.length-1};this.removeEventHandler=function(P,N){var O=C(P);if(O===null){return false}O[N].active=false};var x=function(O){var N=O.toUpperCase();for(var P=0;P<t.length;P++){if(t[P].name.toUpperCase()==N&&t[P].module){return t[P].module}}return v};var h=function(Q,R){if(!g){return false}var O=true;var N=C(Q);if(N===null){return false}for(var P in N){if(N[P].active){O=O&&(N[P].handler(R)!==false)}}return O};var C=function(O){var N=null;switch(O.toUpperCase()){case"ONINITCOMPLETE":return p;case"ONBEFORELOAD":return w;case"ONAFTERLOAD":return F;case"ONBEFOREEXECUTE":return q;case"ONAFTEREXECUTE":return m;case"ONBEFOREREFRESH":return z;case"ONAFTERREFRESH":return s;case"ONAFTERPIECELOAD":return B;case"ONREQUESTFAILED":return e;default:return null}};var u=function(){if(window.XMLHttpRequest){try{return new XMLHttpRequest()}catch(N){}}else{if(window.ActiveXObject){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(N){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(N){}}}return null};var y=function(P,N,Q){var O=u();O.onreadystatechange=function(){if(O.readyState!=4){return}I++;if(O.status==200){N(O,Q)}else{h("onRequestFailed")}};O.open("GET",P,true);O.send(null)};var L=function(Q,N){var R="";if(Q instanceof Object){if(!n.Full){Q.setViewMode(false)}R=Q.getQueryString(n);if(N!=undefined&&N===true){M.push(Q)}}else{if(Q instanceof Object){var P=[];if(Q.id!=undefined){var O;if(Q.id instanceof Array){O=Q.id}else{O=[];O.push(Q.id)}P.push("id="+O.join(","))}if(Q.rel!=undefined){var O;if(Q.rel instanceof Array){O=Q.rel}else{O=[];O.push(Q.rel)}P.push("rel="+O.join(","))}if(P.length){R="?"+P.join("&");if(N!=undefined&&N===true){M.push(Q)}}}}return R+"&r="+Math.random()};var H=function(X,Q,O){var V=[];var P=X.getElementsByTagName("data");if(!P.length){return V}else{P=P[0]}var W=P.childNodes;for(var T=0;T<W.length;T++){var U=W[T];if(U.nodeName=="error"){return{error:U}}if(U.nodeName!="page"&&U.nodeName!="object"&&U.nodeName!="type"&&U.nodeName!="response"){continue}var R={};for(var S=0;S<U.attributes.length;S++){var N=U.attributes[S];R[N.nodeName]=N.nodeValue}f(R,U.childNodes);V.push(R);if(Q==undefined||Q===false){J.push(R)}}if(O!=undefined&&(O instanceof Object)){O.total=parseInt(P.getAttribute("total"))||V.length;O.offset=parseInt(P.getAttribute("offset"))||0;O.limit=parseInt(P.getAttribute("limit"))||V.length}return V};var f=function(T,S){if(S.length==1&&S[0].nodeType==3){T._value=S[0].nodeValue;return}for(var R=0;R<S.length;R++){var P=S[R];var U={};if(P.nodeType!=1){U=P.nodeValue}else{if(!P.attributes.length&&P.childNodes.length==1&&P.childNodes[0].nodeType==3){U=P.childNodes[0].nodeValue}else{for(var O=0;O<P.attributes.length;O++){var Q=P.attributes[O];U[Q.nodeName]=Q.nodeValue}f(U,P.childNodes)}}if(T[P.nodeName]==undefined){T[P.nodeName]=U}else{if(T[P.nodeName] instanceof Array){T[P.nodeName].push(U)}else{var N=[];N.push(T[P.nodeName]);N.push(U);T[P.nodeName]=N}}}};var r=function(O){if(!(O instanceof Array)){return}for(var P=0;P<O.length;P++){for(var N=0;N<J.length;N++){if(O[P].id==J[N].id){for(var Q in O[P]){J[N][Q]=O[P][Q]}break}}}};if((typeof(c)=="undefined")||(c==false)){this.init()}}SettingsStore.instance=null;SettingsStore.getInstance=function(){if(!SettingsStore.instance){SettingsStore.instance=new SettingsStore()}return SettingsStore.instance};function SettingsStore(){var k=window.settingsStoreData||{};var h=this;var a=new Array();this.loaded=window.settingsStoreData?true:false;this.get=function(l,m){m=d(m);if(k[l]){return(k[l][m])?k[l][m]:false}else{return false}};this.set=function(o,q,r){if(!o){return false}r=d(r);var p="/admin/users/saveUserSettings/?key="+o+"&value="+q;if(r){for(var n=0;n<r.length;n++){p+="&tags[]="+r[n]}}else{r={}}var m=function(s){};g(p,m);for(var n=0;n<r.length;n++){var l=r[n];if(!k[o]){k[o]={}}if(q){k[o][l]=q}else{k[o][l]=undefined}}};this.list=function(q){q=d(q);var m=new Array();for(key in k){var o=k[key];var r=false;for(var p in q){var l=q[p];for(var n in o){if(n==l){r=o[n]}}}if(r){m[key]=r}}return m};this.callback=function(l){if(typeof l=="function"){callback=l}return this};this.load=function(){if(this.loaded){return true}setTimeout(function(){var m="/udata/users/loadUserSettings/?r="+Math.random();var l=function(n){h.loaded=true;f(n.responseXML);e("onLoadComplete")};g(m,l)},50)};this.addEventHandler=function(n,l){var m=c(n);if(m===null){return false}m[m.length]={active:true,handler:l};if(this.loaded&&n.toUpperCase()=="ONLOADCOMPLETE"){l()}return m.length-1};var e=function(n,o){var l=c(n);if(l===null){return false}for(var m in l){if(l[m].active){l[m].handler(o)}}};var c=function(m){var l=null;switch(m.toUpperCase()){case"ONLOADCOMPLETE":return a;default:return null}};var d=function(l){var m=typeof l;if(m=="object"){if(l.length>0){return l}else{l.push("common");return l}}else{if(m=="string"){return new Array(l)}else{if(m=="undefined"){return new Array("common")}else{return false}}}};var b=function(){if(window.XMLHttpRequest){try{return new XMLHttpRequest()}catch(l){}}else{if(window.ActiveXObject){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(l){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(l){}}}return null};var g=function(n,l){var m=b();m.onreadystatechange=function(){if(m.readyState!=4){return}if(m.status==200){l(m)}else{e("onRequestFailed")}};m.open("GET",n,false);m.send(null)};var f=function(p){var n=p.getElementsByTagName("item");for(var o=0;o<n.length;o++){var s=n[o];var t=s.getAttribute("key");k[t]={};var q=s.childNodes;var r="",u="";for(var m=0;m<q.length;m++){var l=q[m];if(l.nodeName=="value"){r=l.firstChild.nodeValue;u=l.getAttribute("tag");k[t][u]=r;continue}}}};if(this.loaded){e("onLoadComplete")}}jQuery(document).ready(function(){SettingsStore.getInstance().load()});var editableCell=function(m,A,s){var x=this;var l=s;var o=s.fieldName||s.name;var e=s.id;var c=m;var g=(c.control.contentType!="pages");var y=null;var t="";var v="";var w=s.dataType||"";this.element=A;this.prepareSaveData=function(){if(y){x.save(y.value)}};var p=function(){if(jQuery.inArray(w,editableCell.ignoreDataTypes)!=-1){return false}if(jQuery.inArray(o,editableCell.ignorePropNames)!=-1){return false}if(editableCell.enableEdit==false){return false}if(editableCell.enableEdit){if(!editableCell.helper){editableCell.helper=document.createElement("div");editableCell.helper.className="c-helper";jQuery(editableCell.helper).css({position:"absolute",width:"16px",height:"16px",background:"url(/images/cms/admin/mac/tree/edit.png)",display:"none",cursor:"pointer",zIndex:"10"});document.body.appendChild(editableCell.helper);jQuery(editableCell.helper).bind("mouseover",function(){editableCell.hideHelper=false});jQuery(editableCell.helper).bind("mouseout",function(){editableCell.handleCell=false;editableCell.helper.style.display="none"});jQuery(editableCell.helper).bind("click",function(){editableCell.helper.style.display="none";var C=editableCell.handleCell;var B=editableCell.activeCell;if(C){if(B){B.prepareSaveData()}C.makeEditable()}})}}jQuery(x.element).bind("mouseover",function(){if(!Control.enabled){return false}editableCell.hideHelper=false;var B=editableCell.activeCell;if(B&&B==x){return}editableCell.handleCell=x;var D=jQuery(A).position();var C=jQuery(c.control.initContainer).position();C.left-=c.control.initContainer.scrollLeft;jQuery(editableCell.helper).css({top:D.top+C.top+3,left:D.left+C.left+this.offsetWidth-16,display:"block"})});jQuery(x.element).bind("mouseout",function(C){editableCell.hideHelper=true;var B=x;setTimeout(function(){if(editableCell.hideHelper){editableCell.helper.style.display="none"}},10)})};this.makeEditable=function(){editableCell.activeCell=x;editableCell.handleCell=false;q()};var q=function(){var B="/admin/content/get_editable_region/"+c.id+"/"+o+".xml";if(g){B+="?is_object=1"}jQuery.ajax({type:"GET",url:B,dataType:"xml",success:function(D,C){r(D)},error:function(D,C,E){n(E)}})};var b=function(B){editableCell.activeCell=false;editableCell.handleCell=false;jQuery.jGrowl(B,{header:getLabel("js-error-header")})};var r=function(D){var C=D.getElementsByTagName("property");if(typeof(C[0])!=="undefined"){sType=C[0].getAttribute("type")||""}var B=D.getElementsByTagName("error");if(B.length){b(B[0].firstChild.nodeValue);return false}if(o=="name"){sType="name"}var E=D.getElementsByTagName("value");var F=false;switch(sType){case"wysiwyg":case"text":case"string":case"int":case"price":case"float":case"tags":case"date":case"link_to_object_type":case"counter":if(E.length){F=E[0].firstChild?E[0].firstChild.nodeValue:""}if(!F){F=""}u(F);break;case"boolean":if(E.length){F=E[0].firstChild?E[0].firstChild.nodeValue:""}f(F);break;case"relation":var E=D.getElementsByTagName("item");z(E,C[0].getAttribute("multiple")=="multiple");break;case"name":var E=D.getElementsByTagName("name");if(E.length){F=E[0].firstChild?E[0].firstChild.nodeValue:""}u(F);break;case"color":if(E.length){F=E[0].firstChild?E[0].firstChild.nodeValue:""}if(!F){F=""}d(F);break;default:b(getLabel("js-edcell-unsupported-type"));return false;break}Control.recalcItemsPosition()};var k=function(O,H){var D=jQuery("div",x.element);var N=O.getElementsByTagName("error");if(N.length){b(N[0].firstChild.nodeValue);x.restore();return false}var I=O.getElementsByTagName("property");if(typeof(I[0])!=="undefined"){sType=I[0].getAttribute("type")||""}if(o=="name"){sType="name"}var M=O.getElementsByTagName("value");var E="";switch(sType){case"wysiwyg":case"text":case"int":case"price":case"float":case"tags":case"counter":case"link_to_object_type":var M=O.getElementsByTagName("value");if(M.length){E=M[0].firstChild?M[0].firstChild.nodeValue:""}D.html(E);t=E;break;case"date":var M=O.getElementsByTagName("value");if(M.length){E=M[0].firstChild?M[0].getAttribute("formatted-date"):""}D.html(E);t=E;break;case"string":var P=O.getElementsByTagName("property")[0].getAttribute("restriction");if(M.length){E=M[0].firstChild?M[0].firstChild.nodeValue:"";if(P=="email"){E="<a href='mailto:"+E+"' title='"+E+"' class='link'>"+E+"</a>"}}D.html(E);t=E;break;case"boolean":if(M.length){E=M[0].firstChild?parseInt(M[0].firstChild.nodeValue):0}D.html(E?'<img alt="" style="width:13px;height:13px;" src="/images/cms/admin/mac/tree/checked.png" />':"");t=E;break;case"relation":var M=O.getElementsByTagName("item");if(M.length==1){var C=M[0].getAttribute("name");var L="relation-value";if(M[0].getAttribute("guid")!=undefined){L=M[0].getAttribute("guid")}E='<span title="'+C+'" class="c-'+L+'">'+C+"</span>"}if(M.length>1){for(var G=0;G<M.length;G++){E+=M[G].getAttribute("name");if(G<M.length-1){E+=", "}}}D.html(E);t=E;break;case"name":var M=O.getElementsByTagName("name");if(M.length){E=M[0].firstChild?M[0].firstChild.nodeValue:""}D.html(v);var F=jQuery("a",x.element);F.html(E);t=E;break;case"color":var M=O.getElementsByTagName("value");if(M.length){E=M[0].firstChild?M[0].firstChild.nodeValue:""}var K='<div class="color table"><span class="value">'+E+'</span><span class="color-box"><i style="background-color: '+E+'"></i></span></div>';if(t.length!==0){D.html(v)}else{D.html(K)}var B=jQuery(".value",D);var J=jQuery(".color-box i",D);B.html(E);J.css("background-color",E);t=E;break;default:b(getLabel("js-edcell-unsupported-type"));return false;break}if(window.onAfterSetProperty){onAfterSetProperty(c.id,o,E)}jQuery.jGrowl(getLabel("js-property-saved-success"));v=jQuery("div",x.element).html();Control.recalcItemsPosition()};var u=function(B){t=B;var C=x.element;v=jQuery("div",x.element).html();y=document.createElement("input");y.setAttribute("type","text");y.value=B;y.className="editableCtrl default";y.onblur=function(){if(editableCell.activeCell){x.prepareSaveData();return true}};y.onkeydown=function(E){var D=window.event?window.event.keyCode:E.which;if(D==27){x.restore()}if(D==13&&editableCell.activeCell){x.prepareSaveData()}return true};var C=jQuery("div",x.element);C.html("");C.append(y);y.focus()};var d=function(D){t=D;var C=jQuery("div",x.element);v=C.html();C.html("");var E='<div class="color table"><input type="text"></div>';var B=jQuery(E).appendTo(C);var F=jQuery("input",B);if(D){F.val(D)}F.bind("blur",function(G){if(editableCell.activeCell){x.prepareSaveData();return true}});new colorControl(B,{});jQuery(B).bind("hidePicker",function(){if(editableCell.activeCell){x.save(F.val())}})};var z=function(F,B){var E=jQuery("div",x.element);v=E.html();y=document.createElement("select");y.id="relationSelect"+c.id+o;y.className="editableCtrl";if(B){y.multiple=true;y.size=3}else{y.onchange=function(){if(editableCell.activeCell){x.save(this.value,true)}return true}}for(var D=0;D<F.length;D++){var H=F[D];var G=document.createElement("option");G.value=H.getAttribute("id");G.selected=true;G.innerHTML=H.getAttribute("name");y.appendChild(G)}var E=jQuery("div",x.element);E.html("");E.append(y);var C=document.createElement("input");C.id="relationInput"+c.id+o;C.className="relInput";var E=jQuery("div",x.element);E.append("<br />");E.append(C);C.focus();new relationControl(l.guideId,c.id+o);x.prepareSaveData=function(){if(y.multiple){var I=[];for(var J=0;J<y.options.length;J++){if(y.options[J].selected){I.push(y.options[J].value)}}x.save(I)}else{x.save(y.value)}};jQuery(C).add(jQuery(y)).keydown(function(J){var I=J.keyCode;if(I==27){x.restore()}return true})};var f=function(C){var B=jQuery("div",x.element);v=B.html();y=document.createElement("input");y.type="checkbox";y.checked=C;y.className="editableCtrl check";y.onchange=function(){var D=this.checked?1:0;x.save(D,true);if(x.element.name=="is_activated"||x.element.name=="is_active"||x.element.name=="active"){c.update({"is-active":this.checked?1:0,id:c.id})}return true};jQuery(y).keydown(function(E){var D=E.keyCode;if(D==27){x.restore()}if(D==13){x.prepareSaveData()}return true});var B=jQuery("div",x.element);B.html("");B.append(y);y.focus()};var n=function(B){b(getLabel("js-edcell-get-error")+B)};var h=function(C){var B="/admin/content/save_editable_region/"+c.id+"/"+o+".xml";if(g){B+="?is_object=1"}jQuery.ajax({type:"POST",url:B,dataType:"xml",success:function(E,D){k(E,D)},data:({"data[]":C,csrf:csrfProtection.getToken()}),error:function(E,D,F){a(F)},complete:function(E,D){if(editableCell.activeCell==x){editableCell.activeCell=false}if(editableCell.handleCell==x){editableCell.handleCell=false}}})};var a=function(B){b(getLabel("js-edcell-save-error")+B)};this.save=function(C,B){editableCell.activeCell=false;if(!B&&t==C){this.restore();return false}h(C)};this.restore=function(){editableCell.activeCell=false;var B=jQuery("div",x.element);B.html(v);Control.recalcItemsPosition()};this.getEditControl=function(){return y};p()};editableCell.activeCell=false;editableCell.handleCell=false;editableCell.helper=false;editableCell.hideHelper=false;editableCell.ignoreDataTypes=["wysiwyg"];editableCell.ignorePropNames=[];var TreeItem=function(b,w,g,H,s){var x=parseInt(g.id);var D=this;var e=g;var o=w;var a=H||null;var t=s||"after";var n=typeof(g["force-draw"])!=="undefined"?parseInt(g["force-draw"]):1;var u=typeof(g.childs)!=="undefined"?parseInt(g.childs):0;var r=(typeof(g.basetype)!=="undefined"&&typeof(g.basetype["_value"])==="string")?g.basetype["_value"]:"";var c=b.iconsPath;var B=(typeof(g.basetype)!=="undefined"&&typeof(g.basetype["module"])==="string")?g.basetype["module"]:"content";var C=(typeof(g.basetype)!=="undefined"&&typeof(g.basetype["method"])==="string")?g.basetype["method"]:"";var m=typeof(g.iconbase)!=="undefined"?g.iconbase:c+"ico_"+B+"_"+C+".png";var E=null;var d=null;var l=null;var A=null;var F=SettingsStore.getInstance();var f=true;var q=null;var z=false;var G=49;var k=null;this.element=null;this.control=b;this.childsContainer=null;this.id=x;this.name=typeof(g.name)!=="undefined"?g.name:"noname";this.isRoot=(x===0);this.loaded=false;this.viewLink=typeof(g.link)!=="undefined"?g.link:false;this.editLink=typeof(g["edit-link"])!=="undefined"?g["edit-link"]:false;this.createLink=typeof(g["create-link"])!=="undefined"?g["create-link"]:false;this.permissions=typeof(g.permissions)!=="undefined"?parseInt(g.permissions):0;this.isActive=typeof(g["is-active"])!=="undefined"?parseInt(g["is-active"]):0;this.isVirtualCopy=typeof(g["has-virtual-copy"])!=="undefined";this.isOriginal=typeof(g["is-original"])!=="undefined";this.lockedBy=typeof(g["locked-by"])==="object"?g["locked-by"]:null;this.expiration=typeof(g.expiration)==="object"?g.expiration:null;this.isDefault=typeof(g["is-default"])!=="undefined"?true:false;this.templateId=typeof(g["template-id"])!=="undefined"?g["template-id"]:null;this.langId=typeof(g["lang-id"])!=="undefined"?g["lang-id"]:null;this.domainId=typeof(g["domain-id"])!=="undefined"?g["domain-id"]:null;this.allowCopy=typeof(g["allow-copy"])!=="undefined"?parseInt(g["allow-copy"]):true;this.allowActivity=typeof(g["allow-activity"])!=="undefined"?parseInt(g["allow-activity"]):true;this.allowDrag=typeof(g["allow-drag"])!=="undefined"?g["allow-drag"]:true;this.parent=o;this.childs=[];this.hasChilds=(u>0||x==0);this.labelControl=null;this.position=false;this.isExpanded=false;this.filter=new filter;this.filter.setParentElements(x);this.pageing={total:0,limit:0,offset:0};this.baseModule=(typeof(g.basetype)!=="undefined"&&typeof(g.basetype["module"])==="string")?g.basetype["module"]:"content";this.baseMethod=(typeof(g.basetype)!=="undefined"&&typeof(g.basetype["method"])==="string")?g.basetype["method"]:"";var v=function(){if(w){w.childs[w.childs.length]=x;y(o.childsContainer)}else{p()}};var y=function(J){var N=document.createElement("li");N.setAttribute("rel",x);N.className="ti";N.rel=x;N.className="ti";N.onmousedown=function(){return false};d=document.createElement("div");d.className="ti";if(D.isVirtualCopy){d.className+=" virtual"}if(D.isDefault){d.className+=" main-page"}E=document.createElement("img");E.className="ti-toggle";var T=D.hasChilds?c+"expand.png":c+"collapse-disabled.png";E.setAttribute("src",T);E.onclick=function(){D.toggle();return false};d.appendChild(E);A=document.createElement("img");A.style.border="0px";A.setAttribute("alt",r);A.setAttribute("title",r);A.setAttribute("src",m);A.className="ti-icon";A.onmousedown=function(){return false};if(D.control.allowDrag&&D.allowDrag){A.style.cursor="move"}d.appendChild(A);if(D.expiration){var V=D.expiration.status;if(V){var S=V.id;var M=V._value;if(S){var P=document.createElement("img");var O=c+"ico_"+S+".png";P.setAttribute("src",O);P.setAttribute("alt",M);P.setAttribute("title",M);P.className="page-status";d.appendChild(P)}}}l=document.createElement("a");var R=D.name;if(typeof R!="string"){R=getLabel("js-smc-noname-page")}if(R.length>45){R=R.substring(0,45)+"&#8230;"}l.innerHTML=R;if(D.viewLink){l.title=D.viewLink}if(D.editLink){l.setAttribute("href",D.editLink);l.onclick=function(){return D.control.applyBehaviour(D)}}else{l.setAttribute("href","#");l.onclick=function(){return false}}d.appendChild(l);if(D.isVirtualCopy){var L=document.createElement("span");L.className="label-virtual";L.innerHTML=(D.isOriginal)?getLabel("js-smc-original"):getLabel("js-smc-virtual-copy");d.appendChild(L)}D.labelControl=N.appendChild(d);if(!D.isActive){jQuery(A).fadeTo(1,0.5);jQuery(l).fadeTo(1,0.5);jQuery(E).fadeTo(1,0.5)}k=document.createElement("div");k.className="pages-bar";k.style.display="none";D.pagesBar=N.appendChild(k);childsContainer=document.createElement("ul");childsContainer.className="ti-childs-container";childsContainer.style.display="none";D.childsContainer=N.appendChild(childsContainer);if(a){var I=null;if(t.toLowerCase()=="after"){I=a.element.nextSibling}else{I=a.element}if(I){D.element=J.insertBefore(N,I)}else{D.element=J.appendChild(N)}}else{D.element=J.appendChild(N)}if(D.control.dragAllowed&&D.allowDrag){var Q="child";var U;var K=false;jQuery(d).draggable({appendTo:"body",distance:Control.DragSensitivity,handle:".ti-icon, a",cursorAt:{right:-2},helper:function(){var X=D.element;var W=document.createElement("div");W.innerHTML="<div>"+D.name+"</div>";W.className="ti-draggable";jQuery(W).css({position:"absolute",background:"url("+m+") no-repeat 0 4px"});return W},start:function(){Control.DraggableItem=D;Control.DragMode=true;if(D.control.toolbar){D.control.toolbar.hide()}},stop:function(){if(Control.HandleItem){Control.HandleItem.deInitDroppable();if(Control.DraggableItem){Control.DraggableItem.tryMoveTo(Control.HandleItem,Q)}}Control.DraggableItem=null;Control.DragMode=false;jQuery(".pages-bar a").off("mouseover");K=false;window.clearTimeout(U)},drag:function(W,ac){jQuery(".pages-bar a").on("mouseover",function(){if(!K){K=true;var af=this;U=window.setTimeout(function(){af.click()},1000)}});jQuery(".pages-bar a").on("mouseout",function(){if(K){K=false;window.clearTimeout(U)}});var ad=W.pageX;var ab=W.pageY;var Y=Control.detectItemByMousePointer(ad,ab);var Z=Control.HandleItem;if(Z){Z.deInitDroppable()}Control.HandleItem=Y;if(Y){var ae=jQuery(Y.control.initContainer).position();var aa=Y.position.bottom-Y.position.top;var X=ab-ae.top-Y.position.top;if(X<aa/3){Q="before"}if(X>aa/3&&X<2*aa/3){Q="child"}if(X>2*aa/3){Q="after"}if(Y.isRoot){Q="child"}Y.initDroppable(Q)}}})}};var p=function(){if(!Control.dropIndicator){var I=document.createElement("div");I.className="ti-drop";Control.dropIndicator=document.body.appendChild(I)}y(D.control.container)};var h=function(){if(f&&D===Control.HandleItem){D.expand()}};this.draw=function(){if(w){if(!n){y(o.childsContainer)}}else{if(!n){p()}}};this.appendChild=function(I){return new TreeItem(this.control,D,I)};this.appendAfter=function(I,J){return new TreeItem(this.control,D,I,J,"after")};this.appendBefore=function(I,J){return new TreeItem(this.control,D,I,J,"before")};this.appendFirst=function(I){if(!this.childsContainer.childNodes.length){return this.appendChild(I)}else{if(typeof(this.childsContainer.childNodes[0].rel)!="undefined"){return this.appendBefore(I,this.control.getItem(this.childsContainer.childNodes[0].rel))}}};this.getPreviousSibling=function(){var I=this.element.previousSibling;if(I&&I.rel){return this.control.getItem(I.rel)}return null};this.getNextSibling=function(){var I=this.element.nextSibling;if(I&&I.rel){return this.control.getItem(I.rel)}return null};this.clear=function(){if(this.element.parentNode){this.element.parentNode.removeChild(this.element)}};this.checkIsChild=function(J){var I=this.parent;while(I){if(J===I){return true}I=I.parent}return false};this.recalcPosition=function(){try{var J=jQuery(d).position();this.position={left:J.left,top:J.top,right:this.control.initContainer.offsetWidth,bottom:J.top+d.offsetHeight};return this.position}catch(I){return false}};this.getValue=function(M){if(!e.properties){return false}if(!e.properties["group"]){return false}var L=typeof(e.properties["group"][0])!="undefined"?e.properties["group"]:[e.properties["group"]];for(var K=0;K<L.length;K++){if(!L[K]["property"]){continue}var I=typeof(L[K]["property"][0])!="undefined"?L[K]["property"]:[L[K]["property"]];for(var J=0;J<I.length;J++){if(I[J]["name"]==M){return I[J]["value"]}}}return false};this.getData=function(){return e};this.setLoaded=function(I){this.loaded=I;var J=I?c+"collapse.png":c+"expand.png";E.setAttribute("src",c+"collapse.png")};this.setPageing=function(L){if(!L){return false}this.pageing=L;k.style.display="none";k.innerHTML="";k.style.textAlign="left";if(L.total==0){k.parentNode.style.display="";var Q=document.createElement("span");Q.className="empty-result";if(this.isRoot){k.style.textAlign="center"}Q.appendChild(document.createTextNode(getLabel("js-smc-empty-result")));k.appendChild(Q)}if(L.total>L.limit||L.offset>0){var K=document.createElement("span");K.appendChild(document.createTextNode(getLabel("js-pages-label")));K.className="pagesLabel";k.appendChild(K);k.style.display="";var J=Math.ceil(L.total/L.limit);var I=Math.ceil(L.offset/L.limit);var M=function(R){return function(){D.filter.setPage(R);D.applyFilter(D.filter,true);return false}};var O=false;var P=false;for(var N=0;N<J;N++){if(N!=0&&N!=(Math.ceil(L.total/L.limit)-1)){if(Math.abs(N-I)>15){if(!O){P=document.createElement("a");P.href="#";if(I==N){P.className="current"}P.innerHTML="&#8230;";P.className="current";P.onclick=function(){return false};k.appendChild(P)}O=true;continue}}O=false;P=document.createElement("a");P.href="#";if(I==N){P.className="current"}P.innerHTML=N+1;P.onclick=M(N);k.appendChild(P)}}};this.expand=function(){if(!this.hasChilds){return false}this.isExpanded=true;if(!this.loaded){this.control.load(this.filter);E.setAttribute("src",c+"loading.gif")}else{E.setAttribute("src",c+"collapse.png")}this.childsContainer.style.display="";D.pagesBar.style.display="";Control.recalcItemsPosition();this.control.saveItemState(this.id)};this.collapse=function(){if(!this.hasChilds){return false}this.isExpanded=false;E.setAttribute("src",c+"expand.png");this.childsContainer.style.display="none";D.pagesBar.style.display="none";Control.recalcItemsPosition();this.control.saveItemState(this.id)};this.toggle=function(){if(this.hasChilds){this.isExpanded?this.collapse():this.expand()}};this.update=function(J){if(J){if(this.id!=J.id){return false}if(typeof(J["template-id"])!=="undefined"){this.templateId=J["template-id"]}if(typeof(J.link)!=="undefined"&&J.link!=this.viewLink){this.viewLink=J.link;d.setAttribute("href",this.viewLink)}if(typeof(J.childs)!=="undefined"&&parseInt(J.childs)!==u){u=parseInt(J.childs);this.hasChilds=u>0||x==0;var I=c+"collapse-disabled.png";if(this.hasChilds){I=this.isExpanded?c+"collapse.png":c+"expand.png"}E.setAttribute("src",I)}var K=typeof(J["is-active"])!=="undefined"?parseInt(J["is-active"]):0;if(K!==this.isActive){this.isActive=K;if(!this.isActive){jQuery(A).fadeTo(300,0.5);jQuery(E).fadeTo(300,0.5);jQuery(l).fadeTo(300,0.5)}else{jQuery(A).fadeTo(300,1);jQuery(E).fadeTo(300,1);jQuery(l).fadeTo(300,1)}}if(typeof(J.name)!=="undefined"&&J.name!=this.name){this.name=J.name;l.innerHTML=this.name}}};this.tryMoveTo=function(J,O){if(J){var N=this.control.getRootNodeId();var I=J.id;var K=O!=="child"?1:0;if(O=="before"){N=J.id;I=J.parent.id}if(O=="after"){var L=J.getNextSibling();I=J.parent.id;N=L?L.id:this.control.getRootNodeId()}if(J===this){return false}if(J.checkIsChild(this)){return false}if(N==this.id){return false}var M=J;if(K){M=J.parent?J.parent:J.control.getRoot()}this.control.dataSet.execute("move",{element:this.id,before:N,rel:I,"as-sibling":K,domain:J.control.getRoot().name,childs:1,links:1,virtuals:1,permissions:1,templates:1,receiver_item:M,handle_item:this})}};this.initDroppable=function(K){var K=K||"child";var I=Control.DraggableItem;var L=jQuery(this.control.initContainer).position();if(I){if(I===this){return false}if(this.checkIsChild(I)){return false}var J=Control.dropIndicator;if(K=="after"){J.style.top=this.position.bottom+L.top+"px";J.style.left=this.position.left+L.left+"px";J.style.width=this.position.right-this.position.left+"px"}if(K=="before"){J.style.top=this.position.top+L.top+J.offsetHeight+"px";J.style.left=this.position.left+L.left+"px";J.style.width=this.position.right-this.position.left+"px"}if(K=="child"){J.style.top=this.position.bottom+L.top+"px";J.style.left=this.position.left+L.left+20+"px";J.style.width=this.position.right+L.left-40-this.position.left+"px"}J.style.display="";setTimeout(h,3239)}};this.deInitDroppable=function(){if(!Control.dropIndicator){return}Control.dropIndicator.style.display="none"};this.applyFilter=function(J,I){if(J instanceof Object){this.filter=J}else{this.filter.clear()}if(!I){this.filter.setParentElements(x)}if(this.loaded){this.control.removeItem(x,true);this.loaded=false;if(this.isExpanded){this.expand()}}};this.setSelected=function(I){if(I){if(!q){q="ti";d.className="ti selected-highlight";if(D.isDefault){d.className+=" main-page"}}z=true}else{if(q){d.className=q;if(D.isDefault){d.className+=" main-page"}q=null}z=false}};this.getSelected=function(){return z};v()};ContextMenu={};ContextMenu.itemHandlers={};ContextMenu.itemHandlers.viewElement=function(g){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var b=Control.HandleItem.control.selectedList;var d,f,c=0;for(d in b){f=b[d];c++}if(!f){return false}var a=f.getData()["link"];if(!a){return false}var e=(c!=1);return{caption:getLabel("js-"+g[0]),icon:g[1],visible:true,disabled:e,execute:function(){window.location=a;return false}}};ContextMenu.itemHandlers.copyUrl=function(h){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var c=this;if(!c.clipboard){c.clipboard=new ZeroClipboard.Client();c.clipboard.addEventListener("load",function(){});c.clipboard.addEventListener("complete",function(k,l){c.clipboard.destroy();jQuery.cmenu.hideAll()});jQuery(document).click(function(){c.clipboard.destroy()})}var b=Control.HandleItem.control.selectedList;var e,g,d=0;for(e in b){g=b[e];d++}if(!g){return false}var a=g.getData()["link"];if(!a){return false}var f=(d!=1);return{caption:getLabel("js-"+h[0]),icon:h[1],visible:true,disabled:f,onRender:function(k){c.clipboard.glue(k);c.clipboard.reposition(k);c.clipboard.setText("http://"+location.hostname+a);c.clipboard.addEventListener("mouseOver",function(){jQuery(c.clipboard.domElement).trigger("mouseover")});c.clipboard.addEventListener("mouseOut",function(){jQuery(c.clipboard.domElement).trigger("mouseout")})},execute:function(k){}}};ContextMenu.itemHandlers.changeParent=function(b){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var a=this;this.moveItem=function(c){if(window.page_id==c){return false}jQuery.ajax({url:"/admin/content/tree_move_element.json",type:"get",dataType:"json",data:{element:window.page_id,rel:c,return_copies:1},success:function(d){oFilterController.applyFilterAdvanced()}})};return{caption:getLabel("js-"+b[0]),icon:b[1],visible:true,execute:function(d){var c='&callback=changeParentControlsList["'+Control.HandleItem.id+'"].moveItem';window.page_id=Control.HandleItem.id;if(!window.changeParentControlsList){window.changeParentControlsList={}}window.changeParentControlsList[Control.HandleItem.id]=a;jQuery.openPopupLayer({name:"Sitetree",title:getLabel("js-choice-page"),width:620,height:335,url:"/styles/common/js/parents.html?id="+Control.HandleItem.id+(Control.HandleItem.baseModule?"&module="+Control.HandleItem.baseModule:"")+(window.lang_id?"&lang_id="+window.lang_id:"")+c})}}};ContextMenu.itemHandlers.editItem=function(g){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var a=Control.HandleItem.control.selectedList;var d,f,c=0;for(d in a){f=a[d];c++}if(!f){return false}var b=f.editLink;if(!b){return false}var e=(c!=1||!b);return{caption:getLabel("js-"+g[0]),icon:g[1],visible:true,disabled:e,execute:function(){window.location=b;return false}}};ContextMenu.itemHandlers.addItem=function(f){if(!Control.HandleItem){return false}var a=Control.HandleItem.control.selectedList;var c,e,b=0;for(c in a){e=a[c];b++}if(!e){return false}var g=e.createLink;if(!g){return false}var d=(b!=1||!g);return{caption:getLabel("js-"+f[0]),icon:f[1],visible:true,disabled:d,execute:function(){window.location=g;return false}}};ContextMenu.itemHandlers.filterItem=function(c){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(Control.HandleItem.control.flatMode||Control.HandleItem.control.objectTypesMode){return false}var e=Control.HandleItem.control;var g=Control.HandleItem.control.selectedList,f,b=0;var k=false,a=false;for(f in g){var h=g[f];if(e.isTarget(h)){k=true}else{a=true}b++}var d=false;if(b==1){if(!h.hasChilds){d=true}}return{caption:getLabel("js-"+c[0]),icon:k?"checked":"undefined",visible:true,disabled:d,execute:function(){var l=Control.HandleItem.control;l.setTargetItems(k?{}:l.selectedList);return false}}};ContextMenu.itemHandlers.activeItem=function(f){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(Control.HandleItem.control.flatMode||Control.HandleItem.control.objectTypesMode){return false}var a=Control.HandleItem.control.selectedList,c;var d=false,b=false;for(c in a){if(a[c].isActive){d=true}else{b=true}}var e=(d&&!b);return{caption:getLabel("js-"+f[0]),icon:e?"ico_unblock":"ico_block",visible:true,execute:function(){var k=Control.HandleItem.control,g,h=[];for(g in a){h.push(g)}k.dataSet.execute("tree_set_activity",{element:h,selected_items:a,active:(e?0:1)});return false}}};ContextMenu.itemHandlers.activeObjectItem=function(g){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(!Control.HandleItem.control.flatMode){return false}var a=Control.HandleItem.control.selectedList,c;var d=false,b=false;for(c in a){var f=a[c];if(f.getValue("is_activated")||f.getValue("is_active")||f.getValue("activated")){d=true}else{b=true}}var e=(d&&!b);return{caption:getLabel("js-"+g[0]),icon:e?"ico_unblock":"ico_block",visible:true,execute:function(){var l=Control.HandleItem.control,h,k=new Array();for(h in a){k.push(h)}l.dataSet.execute("tree_set_activity",{element:Control.HandleItem.id,object:k,handle_item:Control.HandleItem,selected_items:a,viewMode:"full",active:(e?0:1)});return false}}};ContextMenu.itemHandlers.deleteItem=function(b){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var a=Control.HandleItem.control.selectedList;if(a.length<1){return false}return{caption:getLabel("js-"+b[0]),icon:b[1],visible:true,execute:function(){var g=Control.HandleItem.control,d,e=new Array();var c=g.selectedList;for(d in c){var f=c[d];if(f.lockedBy){alert(getLabel("js-page-is-locked")+"\n"+getLabel("js-steal-lock-question"));ContextMenu.getInstance().terminate();return false}e.push(d)}g.dataSet.execute("tree_delete_element",{element:e,selected_items:c});return false}}};ContextMenu.itemHandlers.templatesItem=function(e){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(Control.HandleItem.control.flatMode||Control.HandleItem.control.objectTypesMode){return false}var l=Control.HandleItem.control.selectedList;var g,k=false,a=false,c=false,h=false;for(g in l){var r=l[g];if(!k||!a){k=r.langId;a=r.domainId}if(c&&h){if(c!=r.templateId){c=false}}if(!c&&!h){c=r.templateId;h=true}}var f=TemplatesDataSet.getInstance();var n={},p=f.getTemplatesList(a,k);var d=function(s){return function(){if(!Control.HandleItem){return false}var v=Control.HandleItem.control,t,u=new Array();for(t in l){u.push(t)}v.dataSet.execute("change_template",{element:u,selected_items:l,"template-id":s,templates:1,childs:1,permissions:1,virtuals:1,links:1});return false}};for(g in p){var q=p[g];var b=q.id,m=q.title,o=false;if(!b){continue}if(c&&c==b){o=true}n[b]={icon:o?"checked":"undefined",caption:m,execute:d(b)}}return{caption:getLabel("js-"+e[0]),icon:e[1],visible:true,execute:function(){return false},submenu:n}};ContextMenu.itemHandlers.storeGoodsItem=function(){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var b=Control.HandleItem.control.selectedList;var d,f,c=0;for(d in b){f=b[d];c++}if(!f){return false}var a=window.pre_lang+"/admin/eshop/store_view/"+f.id+"/";if(!a){return false}var e=(c!=1);return{title:getLabel("js-view-store-goods"),callback:function(){window.location=a;return false},disabled:e}};ContextMenu.itemHandlers.guideViewItem=function(){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var b=Control.HandleItem.control.selectedList;var d,f,c=0;for(d in b){f=b[d];c++}if(!f){return false}var a=window.pre_lang+"/admin/data/guide_items/"+f.id+"/";if(!a){return false}var e=(c>1);return{caption:getLabel("js-view-guide-items"),icon:"view",execute:function(){window.location=a;return false},disabled:e}};ContextMenu.itemHandlers.viewMessage=function(){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var b=Control.HandleItem.control.selectedList;var d,f,c=0;for(d in b){f=b[d];c++}if(!f){return false}var a=window.pre_lang+"/admin/webforms/message/"+f.id+"/";var e=(c>1);return{caption:getLabel("js-view-message"),icon:"view",execute:function(){window.location=a;return false},disabled:e}};ContextMenu.itemHandlers.csvExport=function(g){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(Control.HandleItem.control.objectTypesMode||Control.HandleItem.control.flatMode){return false}var b=Control.HandleItem.control.selectedList;var e,f,d=0;for(e in b){f=b[e];d++}if(!f.hasChilds){return false}if(d!=1){return false}var a=f.id;var c=f;return{caption:getLabel("js-csv-export"),icon:g[1],visible:true,execute:function(){var h=function(){var l=document.querySelector("select[name=encoding]");var k=l.selectedIndex;if(typeof k!="number"){return}var n=l.item(k).text;var m=c.getExportLink(a,n);window.location=m};jQuery.get("/js/smc/html/quickExportDialog.html",function(k){openDialog({text:k,title:getLabel("js-csv-export"),OKText:getLabel("js-csv-export-button"),OKCallback:h})})}}};ContextMenu.itemHandlers.csvImport=function(g){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(Control.HandleItem.control.objectTypesMode||Control.HandleItem.control.flatMode){return false}var b=Control.HandleItem.control.selectedList;var e,f,d=0;for(e in b){f=b[e];d++}if(!f.hasChilds){}if(d!=1){return false}var a=f.id;var c=f;return{caption:getLabel("js-csv-import"),icon:g[1],visible:true,execute:function(){var h=c.getImportLink(a);c.callCsvImport(h);return false}}};ContextMenu.itemHandlers.restoreItem=function(b){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var a=Control.HandleItem.control.selectedList;if(a.length<1){return false}return{caption:getLabel("js-trash-restore"),icon:b[1],visible:true,execute:function(){var f=Control.HandleItem.control,d,e=new Array();var c=f.selectedList;for(d in c){e.push(d)}f.dataSet.execute("restore_element",{element:e,selected_items:c});return false}}};ContextMenu.itemHandlers.copyItem=function(h){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(Control.HandleItem.control.flatMode||Control.HandleItem.control.objectTypesMode){return false}var k=Control.HandleItem.control;var p=k.selectedList;var m,s,a=false;langId=false;for(m in p){s=p[m];a=s.domainId;langId=s.langId}var l=TemplatesDataSet.getInstance();var n=l.getLangsList();var q=l.getDomainsList();var g=function(d,t){return function(){var u,v=new Array();for(u in p){v.push(u)}k.dataSet.addEventHandler("onBeforeExecute",createConfirm(k.dataSet));k.dataSet.execute("copy_to_lang",{element:v,handle_item:$.extend(true,{},Control.HandleItem),selected_items:p,"lang-id":t,"domain-id":d,templates:1,childs:1,permissions:1,virtuals:1,links:1});return false}};var c={};for(m=0;m<q.length;m++){var o=q[m];var r=(a==o.id);var f={};for(j=0;j<n.length;j++){var e=n[j];var b=r&&(langId==e.id);f[e.id]={icon:b?"checked":"undefined",caption:e.nodeValue,execute:g(o.id,e.id)}}c[o.id]={icon:r?"checked":"undefined",caption:o.host,execute:function(){return false},submenu:f}}return{caption:getLabel("js-"+h[0]),visible:true,execute:function(){return false},submenu:c}};ContextMenu.itemHandlers.moveItem=function(h){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(Control.HandleItem.control.flatMode||Control.HandleItem.control.objectTypesMode){return false}var k=Control.HandleItem.control;var p=k.selectedList;var m,s,a=false;langId=false;for(m in p){s=p[m];a=s.domainId;langId=s.langId}var l=TemplatesDataSet.getInstance();var n=l.getLangsList();var q=l.getDomainsList();var g=function(d,t){return function(){var u,v=new Array();for(u in p){v.push(u)}k.dataSet.execute("move_to_lang",{element:v,handle_item:$.extend(true,{},Control.HandleItem),selected_items:p,"lang-id":t,"domain-id":d,templates:1,childs:1,permissions:1,virtuals:1,links:1});return false}};var c={};for(m=0;m<q.length;m++){var o=q[m];var r=(a==o.id);var f={};for(j=0;j<n.length;j++){var e=n[j];var b=r&&(langId==e.id);f[e.id]={icon:b?"checked":"undefined",caption:e.nodeValue,execute:g(o.id,e.id)}}c[o.id]={icon:r?"checked":"undefined",caption:o.host,execute:function(){return false},submenu:f}}return{caption:getLabel("js-"+h[0]),visible:true,execute:function(){return false},submenu:c}};ContextMenu.itemHandlers.copyItemOld=function(k){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(Control.HandleItem.control.flatMode||Control.HandleItem.control.objectTypesMode){return false}var e=Control.HandleItem.control;var g=e.selectedList;var m,l,p,h=false,a=false;for(m in g){p=g[m];h=p.domainId;a=p.langId}var n=TemplatesDataSet.getInstance();var r=n.getLangsList();var b=n.getDomainsList();var s=function(d,v){return function(){var w,x=new Array();for(w in g){x.push(w)}e.dataSet.addEventHandler("onBeforeExecute",createConfirm(e.dataSet));e.dataSet.execute("copyElementToSite",{element:x,handle_item:$.extend(true,{},Control.HandleItem),selected_items:g,"lang-id":v,"domain-id":d,templates:1,childs:1,permissions:1,virtuals:1,links:1});return false}};var t={};for(m=0;m<b.length;m++){var q=b[m];var c=(h==q.id);var f={};for(l=0;l<r.length;l++){var u=r[l];var o=c&&(a==u.id);f[u.id]={icon:o?"checked":"undefined",caption:u.nodeValue,execute:s(q.id,u.id)}}t[q.id]={icon:c?"checked":"undefined",caption:q.host,execute:function(){return false},submenu:f}}return{caption:getLabel("js-"+k[0]),visible:true,execute:function(){return false},submenu:t}};ContextMenu.itemHandlers.typeRemove=function(){};ContextMenu.itemHandlers.typeEdit=function(){};ContextMenu.allowControlEnable=true;var ZeroClipboard={version:"1.0.7",clients:{},moviePath:"/js/smc/ZeroClipboard.swf",nextId:1,jQuery:function(a){if(a===null){return}if(typeof(a)=="string"){a=document.getElementById(a)}if(!a.addClass){a.hide=function(){this.style.display="none"};a.show=function(){this.style.display=""};a.addClass=function(b){this.removeClass(b);this.className+=" "+b};a.removeClass=function(d){var e=this.className.split(/\s+/);var b=-1;for(var c=0;c<e.length;c++){if(e[c]==d){b=c;c=e.length}}if(b>-1){e.splice(b,1);this.className=e.join(" ")}return this};a.hasClass=function(b){return !!this.className.match(new RegExp("\\s*"+b+"\\s*"))}}return a},setMoviePath:function(a){this.moviePath=a},dispatch:function(d,b,c){var a=this.clients[d];if(a){a.receiveEvent(b,c)}},register:function(b,a){this.clients[b]=a},getDOMObjectPosition:function(c,a){var b={left:0,top:0,width:c.width?c.width:c.offsetWidth,height:c.height?c.height:c.offsetHeight};while(c&&(c!=a)){b.left+=c.offsetLeft;b.top+=c.offsetTop;c=c.offsetParent}return b},Client:function(a){this.handlers={};this.id=ZeroClipboard.nextId++;this.movieId="ZeroClipboardMovie_"+this.id;ZeroClipboard.register(this.id,this);if(a){this.glue(a)}}};ZeroClipboard.Client.prototype={id:0,ready:false,movie:null,clipText:"",handCursorEnabled:false,cssEffects:true,handlers:null,glue:function(d,b,e){this.domElement=ZeroClipboard.jQuery(d);var f=1000;if(this.domElement.style.zIndex){f=parseInt(this.domElement.style.zIndex,10)+1}if(typeof(b)=="string"){b=ZeroClipboard.jQuery(b)}else{if(typeof(b)=="undefined"){b=document.getElementsByTagName("body")[0]}}var c=ZeroClipboard.getDOMObjectPosition(this.domElement,b);this.div=document.createElement("div");var a=this.div.style;a.position="absolute";a.left=""+c.left+"px";a.top=""+c.top+"px";a.width=""+c.width+"px";a.height=""+c.height+"px";a.zIndex=f;if(typeof(e)=="object"){for(addedStyle in e){a[addedStyle]=e[addedStyle]}}b.appendChild(this.div);this.div.innerHTML=this.getHTML(c.width,c.height)},getHTML:function(d,a){var c="";var b="id="+this.id+"&width="+d+"&height="+a;if(navigator.userAgent.match(/MSIE/)){var e=location.href.match(/^https/i)?"https://":"http://";c+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+e+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+d+'" height="'+a+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+b+'"/><param name="wmode" value="transparent"/></object>'}else{c+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+d+'" height="'+a+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+b+'" wmode="transparent" />'}return c},hide:function(){if(this.div){this.div.style.left="-2000px"}},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide();this.div.innerHTML="";var a=document.getElementsByTagName("body")[0];try{a.removeChild(this.div)}catch(b){}this.domElement=null;this.div=null;this.ready=false}},reposition:function(c){if(c){this.domElement=ZeroClipboard.jQuery(c);if(!this.domElement){this.hide()}}if(this.domElement&&this.div){var b=ZeroClipboard.getDOMObjectPosition(this.domElement);var a=this.div.style;a.left=""+b.left+"px";a.top=""+b.top+"px"}},setText:function(a){this.clipText=a;if(this.ready&&this.movie.setText){this.movie.setText(a)}},addEventListener:function(a,b){a=a.toString().toLowerCase().replace(/^on/,"");if(!this.handlers[a]){this.handlers[a]=[]}this.handlers[a].push(b)},setHandCursor:function(a){this.handCursorEnabled=a;if(this.ready){this.movie.setHandCursor(a)}},setCSSEffects:function(a){this.cssEffects=!!a},receiveEvent:function(d,e){d=d.toString().toLowerCase().replace(/^on/,"");switch(d){case"load":this.movie=document.getElementById(this.movieId);if(!this.movie){var c=this;setTimeout(function(){c.receiveEvent("load",null)},1);return}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){var c=this;setTimeout(function(){c.receiveEvent("load",null)},100);this.ready=true;return}this.ready=true;this.movie.setText(this.clipText);this.movie.setHandCursor(this.handCursorEnabled);break;case"mouseover":if(this.domElement&&this.cssEffects){this.domElement.addClass("hover");if(this.recoverActive){this.domElement.addClass("active")}}break;case"mouseout":if(this.domElement&&this.cssEffects){this.recoverActive=false;if(this.domElement.hasClass("active")){this.domElement.removeClass("active");this.recoverActive=true}this.domElement.removeClass("hover")}break;case"mousedown":if(this.domElement&&this.cssEffects){this.domElement.addClass("active")}break;case"mouseup":if(this.domElement&&this.cssEffects){this.domElement.removeClass("active");this.recoverActive=false}break}if(this.handlers[d]){for(var b=0,a=this.handlers[d].length;b<a;b++){var f=this.handlers[d][b];if(typeof(f)=="function"){f(this,e)}else{if((typeof(f)=="object")&&(f.length==2)){f[0][f[1]](this,e)}else{if(typeof(f)=="string"){window[f](this,e)}}}}}}};