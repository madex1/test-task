(function(){var a=tinymce.DOM;tinymce.ThemeManager.requireLangPack("umisimple");tinymce.create("tinymce.themes.UmiSimpleTheme",{init:function(c,d){var e=this,b=["Bold","Italic","Underline","JustifyLeft","JustifyCenter","JustifyRight","InsertUnorderedList","InsertOrderedList"],f=c.settings;e.editor=c;c.onInit.add(function(){c.onNodeChange.add(function(h,g){tinymce.each(b,function(i){g.get(i.toLowerCase()).setActive(h.queryCommandState(i))})});c.dom.loadCSS(d+"/skins/"+f.skin+"/content.css")});a.loadCSS((f.editor_css?c.documentBaseURI.toAbsolute(f.editor_css):"")||d+"/skins/"+f.skin+"/ui.css")},renderUI:function(d){var p=this,g=d.targetNode,e,l,h,i=p.editor,c=i.controlManager,k;g=a.insertAfter(a.create("span",{id:i.id+"_container","class":"mceEditor "+i.settings.skin+"UmiSimpleSkin"}),g);g=k=a.add(g,"table",{cellPadding:0,cellSpacing:0,"class":"mceLayout"});g=l=a.add(g,"tbody");g=a.add(a.add(l,"tr",{"class":"first"}),"td",{"class":"mceToolbar mceFirst"});h=p.toolbar=c.createToolbar("tools1");h.add(c.createButton("bold",{title:"umisimple.bold_desc",cmd:"Bold"}));h.add(c.createButton("italic",{title:"umisimple.italic_desc",cmd:"Italic"}));h.add(c.createButton("underline",{title:"umisimple.underline_desc",cmd:"Underline"}));h.add(c.createButton("justifyleft",{title:"umisimple.justifyleft_desc",cmd:"JustifyLeft"}));h.add(c.createButton("justifycenter",{title:"umisimple.justifycenter_desc",cmd:"JustifyCenter"}));h.add(c.createButton("justifyright",{title:"umisimple.justifyright_desc",cmd:"JustifyRight"}));h.add(c.createButton("insertunorderedlist",{title:"umisimple.bullist_desc",cmd:"InsertUnorderedList"}));h.add(c.createButton("insertorderedlist",{title:"umisimple.numlist_desc",cmd:"InsertOrderedList"}));h.add(c.createButton("link",{title:"umisimple.link_desc",cmd:"mceLink"}));h.add(c.createButton("unlink",{title:"umisimple.unlink_desc",cmd:"unlink"}));h.add(c.createButton("image",{title:"umisimple.image_desc",cmd:"mceImage"}));h.add(c.createButton("cleanup",{title:"umisimple.cleanup_desc",cmd:"umiCleanup"}));var f=h.add(c.createButton("clipboardpaste",{title:"",click:function(){}}));h.renderTo(g);g=a.add(l,"tr",{"class":"last"});g=e=a.add(a.add(g,"td",{"class":"mceLast"}),"div",{"class":"mceIframeContainer"});var j=jQuery("#"+h.id);var m=jQuery("<div class='wysiwyg_tip'>Для вставки из буфера обмена нажмите Ctrl+V</div>");jQuery("#"+f.id).mouseenter(function(){var b=j.offset();jQuery(document.body).append(m);m.css({position:"absolute",display:"none",top:(b.top-parseInt(m.outerHeight())-2)+"px",left:b.left+"px",width:(parseInt(j.parent().innerWidth())-10)+"px"}).fadeIn(400)}).mouseleave(function(){m.fadeOut(400,function(){m.remove()})});return{iframeContainer:e,editorContainer:i.id+"_container",sizeContainer:k,deltaHeight:-20}},execCommand:function(d,c,e){var b=this["_"+d];if(b){b.call(this,c,e);return true}return false},_mceImage:function(c,d){var b=this.editor;if(b.dom.getAttrib(b.selection.getNode(),"class").indexOf("mceItem")!=-1){return}b.windowManager.open({url:tinymce.baseURL+"/themes/umisimple/image.htm",width:400+parseInt(b.getLang("umisimple.image_delta_width",0)),height:300+parseInt(b.getLang("umisimple.image_delta_height",0)),inline:true},{theme_url:tinymce.baseURL+"/themes/umisimple"})},_mceLink:function(c,d){var b=this.editor;b.windowManager.open({url:tinymce.baseURL+"/themes/umisimple/link.htm",width:340+parseInt(b.getLang("umisimple.link_delta_width",0)),height:225+parseInt(b.getLang("umisimple.link_delta_height",0)),inline:true},{theme_url:tinymce.baseURL+"/themes/umisimple"})},_umiCleanup:function(d,e){var b=this.editor;var c=b.getContent();c=c.replace(/<![\s\S]*?--[ \t\n\r]*>/ig," ");c=c.replace(/(<|&lt;)!--[\w\W\n]*?--(>|&gt;)/mig,"");c=c.replace(/<\/?(title|style|font|meta)\s*[^>]*>/ig,"");c=c.replace(/\s*mso-[^:]+:[^;""]+;?/ig,"");c=c.replace(/<\/?o:[^>]*\/?>/ig,"");c=c.replace(/ style=['"]?[^'"]*['"]?/ig,"");c=c.replace(/ class=['"]?[^'">]*['"]?/ig,"");c=c.replace(/<span\s*[^>]*>\s*&nbsp;\s*<\/span>/ig,"");c=c.replace(/<span\s*[^>]*>/ig,"");c=c.replace(/<\/span\s*[^>]*>/ig,"");c=c.replace(/<\/(b|i|s|u|strong|center)>[\t\n]*<\1[^>]*>/gi,"");c=c.replace(/<\/(b|i|s|u|strong|center)>\s*<\1[^>]*>/gi," ");c=c.replace(/<(b|i|s|u|strong|center)[^>]*>[\s\t\n\xC2\xA0]*<\/\1>/gi,"");c=c.replace(/(\t|\n|\s){2,}/gi," ");if(jQuery.browser.safari){c=c.replace(/\bVersion:\d+\.\d+\s+StartHTML:\d+\s+EndHTML:\d+\s+StartFragment:\d+\s+EndFragment:\d+\s*\b/gi,"")}b.setContent(c);tinyMCE.execCommand("mceCleanup",d,e)},getInfo:function(){return{longname:"UMI Simple theme",author:"UmiSoft",authorurl:"http://www.umi-cms.ru/",version:"1.0"}}});tinymce.ThemeManager.add("umisimple",tinymce.themes.UmiSimpleTheme)})();