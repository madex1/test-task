!function(){var e={},t=function(t,i,n){if("string"!=typeof t)throw"module id must be a string";if(void 0===i)throw"no dependencies for "+t;if(void 0===n)throw"no definition function for "+t;e[t]={deps:i,defn:n,instance:void 0}},i=function(t){var n=e[t];if(void 0===n)throw"module ["+t+"] was undefined";return void 0===n.instance&&function(t){for(var n=e[t],a=n.deps,o=n.defn,r=a.length,l=new Array(r),s=0;s<r;++s)l[s]=i(a[s]);var c=o.apply(null,l);if(void 0===c)throw"module ["+t+"] returned undefined";n.instance=c}(t),n.instance},n=t,a=function(e,t){n(e,[],function(){return t})};a("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve),n("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.PluginManager")}),n("ephox.katamari.api.Global",[],function(){return"undefined"!=typeof window?window:Function("return this;")()}),n("ephox.katamari.api.Resolve",["ephox.katamari.api.Global"],function(e){var t=function(t,i){for(var n=void 0!==i?i:e,a=0;a<t.length&&void 0!==n&&null!==n;++a)n=n[t[a]];return n},i=function(t,i){for(var n,a,o=void 0!==i?i:e,r=0;r<t.length;++r)n=o,a=t[r],void 0!==n[a]&&null!==n[a]||(n[a]={}),o=n[a];return o};return{path:t,resolve:function(e,i){var n=e.split(".");return t(n,i)},forge:i,namespace:function(e,t){var n=e.split(".");return i(n,t)}}}),n("ephox.sand.util.Global",["ephox.katamari.api.Resolve"],function(e){return{getOrDie:function(t,i){var n,a,o=(n=t,a=i,e.resolve(n,a));if(void 0===o)throw t+" not available on this browser";return o}}}),n("ephox.sand.api.URL",["ephox.sand.util.Global"],function(e){var t=function(){return e.getOrDie("URL")};return{createObjectURL:function(e){return t().createObjectURL(e)},revokeObjectURL:function(e){t().revokeObjectURL(e)}}}),a("global!document",document),a("global!Math",Math),a("global!RegExp",RegExp),n("tinymce.core.Env",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.Env")}),n("tinymce.core.ui.Factory",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.ui.Factory")}),n("tinymce.core.util.JSON",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.JSON")}),n("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.Tools")}),n("tinymce.core.util.XHR",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.XHR")}),n("tinymce.plugins.image.api.Settings",[],function(){return{hasDimensions:function(e){return e.getParam("image_dimensions",!0)},hasAdvTab:function(e){return e.getParam("image_advtab",!1)},getPrependUrl:function(e){return e.getParam("image_prepend_url","")},getClassList:function(e){return e.getParam("image_class_list")},hasDescription:function(e){return e.getParam("image_description",!0)},hasImageTitle:function(e){return e.getParam("image_title",!0)},hasImageCaption:function(e){return e.getParam("image_caption",!1)},getImageList:function(e){return e.getParam("image_list",!1)}}}),n("ephox.sand.api.XMLHttpRequest",["ephox.sand.util.Global"],function(e){return function(){return new(e.getOrDie("XMLHttpRequest"))}}),a("global!window",window),n("tinymce.core.util.Promise",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.Promise")}),n("tinymce.plugins.image.core.Uploader",["ephox.sand.api.XMLHttpRequest","global!document","global!window","tinymce.core.util.Promise","tinymce.core.util.Tools"],function(e,t,i,n,a){var o=function(){};return function(t){var r=function(n,a,o,r){var l,s;(l=new e).open("POST",t.url),l.withCredentials=t.credentials,l.upload.onprogress=function(e){r(e.loaded/e.total*100)},l.onerror=function(){o("Image upload failed due to a XHR Transport error. Code: "+l.status)},l.onload=function(){var e,i,n;l.status<200||l.status>=300?o("HTTP Error: "+l.status):(e=JSON.parse(l.responseText))&&"string"==typeof e.location?a((i=t.basePath,n=e.location,i?i.replace(/\/$/,"")+"/"+n.replace(/^\//,""):n)):o("Invalid JSON: "+l.responseText)},(s=new i.FormData).append("file",n.blob(),n.filename()),l.send(s)};return t=a.extend({credentials:!1,handler:r},t),{upload:function(e){return t.url||t.handler!==r?(i=e,a=t.handler,new n(function(e,t){try{a(i,e,t,o)}catch(e){t(e.message)}})):n.reject("Upload url missng from the settings.");var i,a}}}}),n("tinymce.plugins.image.core.Utils",["tinymce.core.util.Tools","global!Math","global!document"],function(e,t,i){return{getImageSize:function(e,n){var a=i.createElement("img");function o(e,t){a.parentNode&&a.parentNode.removeChild(a),n({width:e,height:t})}a.onload=function(){o(t.max(a.width,a.clientWidth),t.max(a.height,a.clientHeight))},a.onerror=function(){o()};var r=a.style;r.visibility="hidden",r.position="fixed",r.bottom=r.left=0,r.width=r.height="auto",i.body.appendChild(a),a.src=e},buildListItems:function(t,i,n){return function t(n,a){return a=a||[],e.each(n,function(e){var n={text:e.text||e.title};e.menu?n.menu=t(e.menu):(n.value=e.value,i(n)),a.push(n)}),a}(t,n||[])},removePixelSuffix:function(e){return e&&(e=e.replace(/px$/,"")),e},addPixelSuffix:function(e){return e.length>0&&/^[0-9]+$/.test(e)&&(e+="px"),e},mergeMargins:function(e){if(e.margin){var t=e.margin.split(" ");switch(t.length){case 1:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[0],e["margin-bottom"]=e["margin-bottom"]||t[0],e["margin-left"]=e["margin-left"]||t[0];break;case 2:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[0],e["margin-left"]=e["margin-left"]||t[1];break;case 3:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[2],e["margin-left"]=e["margin-left"]||t[1];break;case 4:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[2],e["margin-left"]=e["margin-left"]||t[3]}delete e.margin}return e}}}),n("tinymce.plugins.image.ui.Dialog",["ephox.sand.api.URL","global!document","global!Math","global!RegExp","tinymce.core.Env","tinymce.core.ui.Factory","tinymce.core.util.JSON","tinymce.core.util.Tools","tinymce.core.util.XHR","tinymce.plugins.image.api.Settings","tinymce.plugins.image.core.Uploader","tinymce.plugins.image.core.Utils"],function(e,t,i,n,a,o,r,l,s,c,u,g){return function(t){function a(a){var r,s,m,d,p,f,h,b={},v=t.dom,y=t.settings,x=c.hasDimensions(t);function w(){var i=new(o.get("Throbber"))(r.getEl()),n=this.value(),a=new u({url:y.images_upload_url,basePath:y.images_upload_base_path,credentials:y.images_upload_credentials,handler:y.images_upload_handler}),l=t.editorUpload.blobCache.create({blob:n,name:n.name?n.name.replace(/\.[^\.]+$/,""):null,base64:"data:image/fake;base64,="}),s=function(){i.hide(),e.revokeObjectURL(l.blobUri())};return i.show(),a.upload(l).then(function(e){var t=r.find("#src");return t.value(e),r.find("tabpanel")[0].activateTab(0),t.fire("change"),s(),e},function(e){t.windowManager.alert(e),s()})}function S(e){return t.schema.getTextBlockElements()[e.nodeName]}function T(){var e,t,n,a;e=r.find("#width")[0],t=r.find("#height")[0],e&&t&&(n=e.value(),a=t.value(),r.find("#constrain")[0].checked()&&d&&p&&n&&a&&(d!==n?(a=i.round(n/d*a),isNaN(a)||t.value(a)):(n=i.round(a/p*n),isNaN(n)||e.value(n))),d=n,p=a)}function P(){if(c.hasAdvTab(t)){var e=r.toJSON(),i=v.parseStyle(e.style);i=g.mergeMargins(i),e.vspace&&(i["margin-top"]=i["margin-bottom"]=g.addPixelSuffix(e.vspace)),e.hspace&&(i["margin-left"]=i["margin-right"]=g.addPixelSuffix(e.hspace)),e.border&&(i["border-width"]=g.addPixelSuffix(e.border)),r.find("#style").value(v.serializeStyle(v.parseStyle(v.serializeStyle(i))))}}function C(){var e,i;P(),T(),(b=l.extend(b,r.toJSON())).alt||(b.alt=""),b.title||(b.title=""),""===b.width&&(b.width=null),""===b.height&&(b.height=null),b.style||(b.style=null),b={src:b.src,alt:b.alt,title:b.title,width:b.width,height:b.height,style:b.style,caption:b.caption,class:b.class},t.undoManager.transact(function(){if(b.src){if(""===b.title&&(b.title=null),s?v.setAttribs(s,b):(b.id="__mcenew",t.focus(),t.selection.setContent(v.createHTML("img",b)),s=v.get("__mcenew"),v.setAttrib(s,"id",null)),t.editorUpload.uploadImagesAuto(),!1===b.caption&&v.is(s.parentNode,"figure.image")&&(e=s.parentNode,v.setAttrib(s,"contenteditable",null),v.insertAfter(s,e),v.remove(e),t.selection.select(s),t.nodeChanged()),!0!==b.caption)!function(e){function i(){e.onload=e.onerror=null,t.selection&&(t.selection.select(e),t.nodeChanged())}e.onload=function(){b.width||b.height||!x||v.setAttribs(e,{width:e.clientWidth,height:e.clientHeight}),i()},e.onerror=i}(s);else if(!v.is(s.parentNode,"figure.image")){i=s,(s=s.cloneNode(!0)).contentEditable=!0,(e=v.create("figure",{class:"image"})).appendChild(s),e.appendChild(v.create("figcaption",{contentEditable:!0},"Caption")),e.contentEditable=!1;var n=v.getParent(i,S);n?v.split(n,i,e):v.replace(e,i),t.selection.select(e)}}else if(s){var a=v.is(s.parentNode,"figure.image")?s.parentNode:s;v.remove(a),t.focus(),t.nodeChanged(),v.isEmpty(t.getBody())&&(t.setContent(""),t.selection.setCursorLocation())}})}s=t.selection.getNode(),(m=v.getParent(s,"figure.image"))&&(s=v.select("img",m)[0]),s&&("IMG"!==s.nodeName||s.getAttribute("data-mce-object")||s.getAttribute("data-mce-placeholder"))&&(s=null),s&&(d=v.getAttrib(s,"width"),p=v.getAttrib(s,"height"),b={src:v.getAttrib(s,"src"),alt:v.getAttrib(s,"alt"),title:v.getAttrib(s,"title"),class:v.getAttrib(s,"class"),width:d,height:p,caption:!!m}),a&&(f={type:"listbox",label:"Image list",values:g.buildListItems(a,function(e){e.value=t.convertURL(e.value||e.url,"src")},[{text:"None",value:""}]),value:b.src&&t.convertURL(b.src,"src"),onselect:function(e){var t=r.find("#alt");(!t.value()||e.lastControl&&t.value()===e.lastControl.text())&&t.value(e.control.text()),r.find("#src").value(e.control.value()).fire("change")},onPostRender:function(){f=this}}),c.getClassList(t)&&(h={name:"class",type:"listbox",label:"Class",values:g.buildListItems(c.getClassList(t),function(e){e.value&&(e.textStyle=function(){return t.formatter.getCssText({inline:"img",classes:[e.value]})})})});var L=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:function(e){var i,a,o,s=e.meta||{};f&&f.value(t.convertURL(this.value(),"src")),l.each(s,function(e,t){r.find("#"+t).value(e)}),s.width||s.height||(i=t.convertURL(this.value(),"src"),a=c.getPrependUrl(t),o=new n("^(?:[a-z]+:)?//","i"),a&&!o.test(i)&&i.substring(0,a.length)!==a&&(i=a+i),this.value(i),g.getImageSize(t.documentBaseURI.toAbsolute(this.value()),function(e){e.width&&e.height&&x&&(d=e.width,p=e.height,r.find("#width").value(d),r.find("#height").value(p))}))},onbeforecall:function(e){e.meta=r.toJSON()}},f];if(c.hasDescription(t)&&L.push({name:"alt",type:"textbox",label:"Image description (alt)"}),c.hasImageTitle(t)&&L.push({name:"title",type:"textbox",label:"Image Title"}),x&&L.push({type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:T,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:T,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}),L.push(h),c.hasImageCaption(t)&&L.push({name:"caption",type:"checkbox",label:"Caption"}),c.hasAdvTab(t)||t.settings.images_upload_url){var R=[{title:"General",type:"form",items:L}];if(c.hasAdvTab(t)&&(s&&(s.style.marginLeft&&s.style.marginRight&&s.style.marginLeft===s.style.marginRight&&(b.hspace=g.removePixelSuffix(s.style.marginLeft)),s.style.marginTop&&s.style.marginBottom&&s.style.marginTop===s.style.marginBottom&&(b.vspace=g.removePixelSuffix(s.style.marginTop)),s.style.borderWidth&&(b.border=g.removePixelSuffix(s.style.borderWidth)),b.style=t.dom.serializeStyle(t.dom.parseStyle(t.dom.getAttrib(s,"style")))),R.push({title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox",onchange:function(){if(c.hasAdvTab(t)){var e=r.toJSON(),i=v.parseStyle(e.style);r.find("#vspace").value(""),r.find("#hspace").value(""),((i=g.mergeMargins(i))["margin-top"]&&i["margin-bottom"]||i["margin-right"]&&i["margin-left"])&&(i["margin-top"]===i["margin-bottom"]?r.find("#vspace").value(g.removePixelSuffix(i["margin-top"])):r.find("#vspace").value(""),i["margin-right"]===i["margin-left"]?r.find("#hspace").value(g.removePixelSuffix(i["margin-right"])):r.find("#hspace").value("")),i["border-width"]&&r.find("#border").value(g.removePixelSuffix(i["border-width"])),r.find("#style").value(v.serializeStyle(v.parseStyle(v.serializeStyle(i))))}}},{label:"Class",name:"class",type:"textbox"},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:P},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]})),t.settings.images_upload_url){var N=".jpg,.jpeg,.png,.gif",_={title:"Upload",type:"form",layout:"flex",direction:"column",align:"stretch",padding:"20 20 20 20",items:[{type:"container",layout:"flex",direction:"column",align:"center",spacing:10,items:[{text:"Browse for an image",type:"browsebutton",accept:N,onchange:w},{text:"OR",type:"label"}]},{text:"Drop an image here",type:"dropzone",accept:N,height:100,onchange:w}]};R.push(_)}r=t.windowManager.open({title:"Insert/edit image",data:b,bodyType:"tabpanel",body:R,onSubmit:C})}else r=t.windowManager.open({title:"Insert/edit image",data:b,body:L,onSubmit:C})}return{open:function(){var e,i;e=a,"string"==typeof(i=c.getImageList(t))?s.send({url:i,success:function(t){e(r.parse(t))}}):"function"==typeof i?i(e):e(i)}}}}),n("tinymce.plugins.image.api.Commands",["tinymce.plugins.image.ui.Dialog"],function(e){return{register:function(t){t.addCommand("mceImage",e(t).open)}}}),n("tinymce.plugins.image.core.FilterContent",["tinymce.core.util.Tools"],function(e){var t=function(t){return function(i){for(var n,a,o=i.length,r=function(e){e.attr("contenteditable",t?"true":null)};o--;)n=i[o],void 0,(a=n.attr("class"))&&/\bimage\b/.test(a)&&(n.attr("contenteditable",t?"false":null),e.each(n.getAll("figcaption"),r),e.each(n.getAll("img"),r))}};return{setup:function(e){e.on("preInit",function(){e.parser.addNodeFilter("figure",t(!0)),e.serializer.addNodeFilter("figure",t(!1))})}}}),n("tinymce.plugins.image.ui.Buttons",["tinymce.plugins.image.ui.Dialog"],function(e){return{register:function(t){t.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:e(t).open,stateSelector:"img:not([data-mce-object],[data-mce-placeholder]),figure.image"}),t.addMenuItem("image",{icon:"image",text:"Image",onclick:e(t).open,context:"insert",prependToContext:!0})}}}),n("tinymce.plugins.image.Plugin",["tinymce.core.PluginManager","tinymce.plugins.image.api.Commands","tinymce.plugins.image.core.FilterContent","tinymce.plugins.image.ui.Buttons"],function(e,t,i,n){return e.add("image",function(e){i.setup(e),n.register(e),t.register(e)}),function(){}}),i("tinymce.plugins.image.Plugin")()}();