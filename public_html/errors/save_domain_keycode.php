<?php
 require_once '../libs/config.php';use UmiCms\Service;$va9205dcfd4a6f7c2cbe8be01566ff84a = Service::Registry();if ($va9205dcfd4a6f7c2cbe8be01566ff84a->checkSelfKeycode()) {exit();}if (is_file(SYS_TEMP_PATH . '/runtime-cache/registry')) {unlink(SYS_TEMP_PATH . '/runtime-cache/registry');}if (is_file(SYS_TEMP_PATH . '/runtime-cache/trash')) {unlink(SYS_TEMP_PATH . '/runtime-cache/trash');}$v836c673259e51101a01e755a34f97359 = Service::Request()->serverAddress();$v957b527bcfbad2e80f58d20683931435 = isset($v836c673259e51101a01e755a34f97359) ? $v836c673259e51101a01e755a34f97359 : str_replace("\\", '', Service::Request()->documentRoot());$vf6afee894b3508441e878b464a92f4b0 = Service::Request()->host();$v1a54c1036ccb10069e9c06281d52007a = getRequest('keycode');$v5e1288ae439631bc751dd1fe9a602a09 = getRequest('domain_keycode');$vb5fae0da4b655022a6fb20925aac1492 = getRequest('license_codename');$v0d771fa031fb27561ed207afa6cf9983 = Service::DomainCollection();$v9d6e24ec78d309695833f4c9f8310d7a = $v0d771fa031fb27561ed207afa6cf9983  ->getDefaultDomain();$vfb8a8e641ec272318590a0343e093af2 = [];foreach ($v0d771fa031fb27561ed207afa6cf9983->getList() as $vad5f82e879a9c5d6b5b442eb37e50551) {$vfb8a8e641ec272318590a0343e093af2[] = $vad5f82e879a9c5d6b5b442eb37e50551->getHost();}$vd072ef66e1ee53c61a1696340bd05a56 = in_array($vf6afee894b3508441e878b464a92f4b0, $vfb8a8e641ec272318590a0343e093af2);$v779eb97826729c8f321e4e3810d13881 = $vd072ef66e1ee53c61a1696340bd05a56 && !$v0d771fa031fb27561ed207afa6cf9983->isDefaultDomain($vf6afee894b3508441e878b464a92f4b0);if (($v5e1288ae439631bc751dd1fe9a602a09 === null || $vb5fae0da4b655022a6fb20925aac1492 === null) && $v1a54c1036ccb10069e9c06281d52007a !== null) {$v21ffce5b8a6cc8cc6a41448dd69623c9 = [   'ip' => $v957b527bcfbad2e80f58d20683931435,   'domain' => $vf6afee894b3508441e878b464a92f4b0,   'keycode' => $v1a54c1036ccb10069e9c06281d52007a,  ];$v572d4e421e5e6b9bc11d815e8a027112 = 'aHR0cDovL3Vkb2QudW1paG9zdC5ydS91ZGF0YTovL2N1c3RvbS9wcmltYXJ5Q2hlY2tDb2RlLw==';$v572d4e421e5e6b9bc11d815e8a027112 = base64_decode($v572d4e421e5e6b9bc11d815e8a027112) . base64_encode(serialize($v21ffce5b8a6cc8cc6a41448dd69623c9)) . '/';$result = umiRemoteFileGetter::get(   $v572d4e421e5e6b9bc11d815e8a027112,   false,   false,   false,   false,   false,   30  );header('Content-type: text/xml; charset=utf-8');$v0f635d0e0f3874fff8b581c132e6c7a7 = simplexml_load_string($result);$v0f635d0e0f3874fff8b581c132e6c7a7->addChild('is_domain_not_default', (int) $v779eb97826729c8f321e4e3810d13881);echo $v0f635d0e0f3874fff8b581c132e6c7a7->asXML();exit();}if (mb_strlen(str_replace('-', '', $v5e1288ae439631bc751dd1fe9a602a09)) != 33) {exit();}if (!$vb5fae0da4b655022a6fb20925aac1492) {exit();}$v1f0f70bf2b5ad94c7387e64c16dc455a = ['commerce', 'business', 'corporate', 'commerce_enc', 'business_enc', 'corporate_enc', 'gov'];$v45cee5e0fe2cae080c44e7a4ffc70361 = in_array($vb5fae0da4b655022a6fb20925aac1492, $v1f0f70bf2b5ad94c7387e64c16dc455a) ? 'pro' : $vb5fae0da4b655022a6fb20925aac1492;$ve8701a96f778fea2f6da0920e291d189 = umiTemplater::getSomething($v45cee5e0fe2cae080c44e7a4ffc70361, $vf6afee894b3508441e878b464a92f4b0);if ($ve8701a96f778fea2f6da0920e291d189 != mb_substr($v5e1288ae439631bc751dd1fe9a602a09, 12)) {exit();}try {$v9d6e24ec78d309695833f4c9f8310d7a->setHost($vf6afee894b3508441e878b464a92f4b0);$v9d6e24ec78d309695833f4c9f8310d7a->commit();}catch (databaseException $v42552b1f133f9f8eb406d4f306ea9fd1) {if ($v42552b1f133f9f8eb406d4f306ea9fd1->getCode() == IConnection::DUPLICATE_KEY_ERROR_CODE) {$v3d5ed8db11ff5eea231151580225ecc7 = $v0d771fa031fb27561ed207afa6cf9983->getDomainId($vf6afee894b3508441e878b464a92f4b0);$v0d771fa031fb27561ed207afa6cf9983->setDefaultDomain($v3d5ed8db11ff5eea231151580225ecc7);}else {throw $v42552b1f133f9f8eb406d4f306ea9fd1;}}$vf0a33e98e691602bc23acaf06bd80176 = $va9205dcfd4a6f7c2cbe8be01566ff84a->get('//settings/system_edition');$va9205dcfd4a6f7c2cbe8be01566ff84a->set('//settings/keycode', $v5e1288ae439631bc751dd1fe9a602a09);$va9205dcfd4a6f7c2cbe8be01566ff84a->set('//settings/system_edition', $vb5fae0da4b655022a6fb20925aac1492);$va9205dcfd4a6f7c2cbe8be01566ff84a->set('//settings/previous_edition', $vf0a33e98e691602bc23acaf06bd80176);$v71103c6f0481873dcdf4191c918cf37b = cmsController::getInstance()->getModule('autoupdate');$vae865b4bdb4bf16839ce0416f9842b05 = ($v71103c6f0481873dcdf4191c918cf37b instanceof def_module);if ($vae865b4bdb4bf16839ce0416f9842b05) {$v71103c6f0481873dcdf4191c918cf37b->resetSupportTimeCache();if ($v71103c6f0481873dcdf4191c918cf37b->isMethodExists('deleteIllegalComponents')) {$v71103c6f0481873dcdf4191c918cf37b->deleteIllegalComponents();}elseif ($v71103c6f0481873dcdf4191c918cf37b->isMethodExists('deleteIllegalModules')) {$v71103c6f0481873dcdf4191c918cf37b->deleteIllegalModules();}}$v8cffebdf9089dfe398ec9396ee707ede = SYS_MODULES_PATH . 'autoupdate/ch_m.php';if (is_file($v8cffebdf9089dfe398ec9396ee707ede)) {include $v8cffebdf9089dfe398ec9396ee707ede;ch_remove_m_garbage();}