<?php
 use UmiCms\Service;class csvSplitter extends umiImportSplitter {const VALUE_LIMITER = '"';const TARGET_ENCODING = 'utf-8';const VERSION = '2.0';const HEADER_COUNT = 3;const MULTIPLE_IMAGE_PART_COUNT = 3;const OPTIONED_PART_COUNT = 6;public $autoGuideCreation = true;protected static $supportedEncodings = ['utf-8', 'windows-1251', 'cp1251'];protected $sourceName;protected $simpleAttributeList = ['id', 'is-active', 'is-visible', 'is-deleted', 'alt-name'];protected $specialAttributeList = ['type-id', 'parent-id'];protected $document;protected $relations;protected $entity;protected $group;protected $nameList = [];private $entityId;private $property;private $importFile;private $importId;private $position = 0;private $encoding = 'windows-1251';private $typeList = [];private $titleList = [];private $resetVal = false;private $propertyDelimiter = ';';private $valueDelimiter = ',';private $partDelimiter = '|';private $subPartDelimiter = ':';public function __construct($v599dcce2998a6b40b1e38e8c6006cb0a) {parent::__construct($v599dcce2998a6b40b1e38e8c6006cb0a);ini_set('mbstring.substitute_character', 'none');$this->setResetVal(mainConfiguration::getInstance()->get('kernel', 'import-csv-reset-value'));}public function setResetVal($v3a6d0284e743dc4a9b86f97d6dd1a3bf) {$this->resetVal = (bool) $v3a6d0284e743dc4a9b86f97d6dd1a3bf;}public function setEncoding($v84bea1f0fd2ce16f7e562a9f06ef03d3) {if (in_array(mb_strtolower($v84bea1f0fd2ce16f7e562a9f06ef03d3), self::$supportedEncodings)) {$this->encoding = $v84bea1f0fd2ce16f7e562a9f06ef03d3;}else {throw new InvalidArgumentException("Encoding '${v84bea1f0fd2ce16f7e562a9f06ef03d3}' is not supported");}}public function setSourceName($vb068931cc450442b63f5b3d276ea4297) {if (!is_string($vb068931cc450442b63f5b3d276ea4297) || $vb068931cc450442b63f5b3d276ea4297 === '') {throw new InvalidArgumentException('Incorrect source name given');}$this->sourceName = $vb068931cc450442b63f5b3d276ea4297;return $this;}protected function readDataBlock() {$this->initialize();$this->doOneIteration();return $this->document;}protected function resetState() {$this->position = 0;$this->document = null;$this->entity = null;$this->entityId = null;$this->group = null;$this->property = null;$this->importFile = null;$this->importId = null;$this->sourceName = null;$this->complete = false;$this->nameList = [];$this->titleList = [];$this->typeList = [];}protected function createDocumentSkeleton() {$v9a09b4dfda82e3e665e31092d1c3ec8d = $this->document;$v173a1756d2d82394cb803161f70f9a38 = $v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('umidump');$v173a1756d2d82394cb803161f70f9a38->setAttribute('xmlns:xlink', 'http://www.w3.org/TR/xlink');$v9a09b4dfda82e3e665e31092d1c3ec8d->appendChild($v173a1756d2d82394cb803161f70f9a38);$v93e6c8da44b9478068b7615b253ed5b9 = $v9a09b4dfda82e3e665e31092d1c3ec8d->createAttribute('version');$v93e6c8da44b9478068b7615b253ed5b9->appendChild($v9a09b4dfda82e3e665e31092d1c3ec8d->createTextNode(self::VERSION));$v173a1756d2d82394cb803161f70f9a38->appendChild($v93e6c8da44b9478068b7615b253ed5b9);$vf41b30d392cb5e1ef0b55de0d28d15cc = $v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('meta');$v173a1756d2d82394cb803161f70f9a38->appendChild($vf41b30d392cb5e1ef0b55de0d28d15cc);$v1b33d8364c736929e7a40bd04f138194 = $v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('site-name');$v1b33d8364c736929e7a40bd04f138194->appendChild($v9a09b4dfda82e3e665e31092d1c3ec8d->createCDATASection(def_module::parseTPLMacroses(macros_sitename())));$vf41b30d392cb5e1ef0b55de0d28d15cc->appendChild($v1b33d8364c736929e7a40bd04f138194);$vad5f82e879a9c5d6b5b442eb37e50551 = Service::DomainDetector()->detect();$v204aadf644884156d194b4fccb7a101a = $v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('domain');$v204aadf644884156d194b4fccb7a101a->appendChild($v9a09b4dfda82e3e665e31092d1c3ec8d->createCDATASection($vad5f82e879a9c5d6b5b442eb37e50551->getHost()));$vf41b30d392cb5e1ef0b55de0d28d15cc->appendChild($v204aadf644884156d194b4fccb7a101a);$v7572559ca86e781ba8fe8073a0b725c6 = Service::LanguageDetector()->detect();$va24bcccab40205d7e681050e137f6c99 = $v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('lang');$va24bcccab40205d7e681050e137f6c99->appendChild($v9a09b4dfda82e3e665e31092d1c3ec8d->createCDATASection($v7572559ca86e781ba8fe8073a0b725c6->getPrefix()));$vf41b30d392cb5e1ef0b55de0d28d15cc->appendChild($va24bcccab40205d7e681050e137f6c99);$v9256e115e735ddbb83fa6787fafde4bd = $v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('source-name');$v7c95caafbd5e4b5db3977617a0498de6 = $this->sourceName ?: md5($vad5f82e879a9c5d6b5b442eb37e50551->getId() . $v7572559ca86e781ba8fe8073a0b725c6->getId());$v9256e115e735ddbb83fa6787fafde4bd->appendChild($v9a09b4dfda82e3e665e31092d1c3ec8d->createCDATASection($v7c95caafbd5e4b5db3977617a0498de6));$vf41b30d392cb5e1ef0b55de0d28d15cc->appendChild($v9256e115e735ddbb83fa6787fafde4bd);$vbd80c856be87c219363221dc9be1c2e2 = $v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('generate-time');$v5fc732311905cb27e82d67f4f6511f7f = new umiDate(time());$v35825074f31d9476602b7ba1e57fa662 = $v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('timestamp');$v35825074f31d9476602b7ba1e57fa662->appendChild($v9a09b4dfda82e3e665e31092d1c3ec8d->createTextNode($v5fc732311905cb27e82d67f4f6511f7f->getFormattedDate('U')));$vbd80c856be87c219363221dc9be1c2e2->appendChild($v35825074f31d9476602b7ba1e57fa662);$v976db921e242a0600e07471cc510d8f1 = $v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('rfc');$v976db921e242a0600e07471cc510d8f1->appendChild($v9a09b4dfda82e3e665e31092d1c3ec8d->createTextNode($v5fc732311905cb27e82d67f4f6511f7f->getFormattedDate('r')));$vbd80c856be87c219363221dc9be1c2e2->appendChild($v976db921e242a0600e07471cc510d8f1);$v5b3c5210817c904689dd3d88ecb40e5a = $v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('utc');$v5b3c5210817c904689dd3d88ecb40e5a->appendChild($v9a09b4dfda82e3e665e31092d1c3ec8d->createTextNode($v5fc732311905cb27e82d67f4f6511f7f->getFormattedDate(DATE_ATOM)));$vbd80c856be87c219363221dc9be1c2e2->appendChild($v5b3c5210817c904689dd3d88ecb40e5a);$vf41b30d392cb5e1ef0b55de0d28d15cc->appendChild($vbd80c856be87c219363221dc9be1c2e2);$v173a1756d2d82394cb803161f70f9a38->appendChild($v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('pages'));$v173a1756d2d82394cb803161f70f9a38->appendChild($v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('hierarchy'));$v173a1756d2d82394cb803161f70f9a38->appendChild($v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('relations'));$v173a1756d2d82394cb803161f70f9a38->appendChild($v9a09b4dfda82e3e665e31092d1c3ec8d->createElement('options'));}protected function determineEntityTypeFromExternalType($v5c203840dfcdf51dd7e33a72ea2f484f) {$v3c6e0b8a9c15224a8228b9a98ca1531d = array_search('type-id', $this->nameList);if ($v3c6e0b8a9c15224a8228b9a98ca1531d === false) {return false;}$v684e7fcd9c20d41a3074eb495fe91a7f = $v5c203840dfcdf51dd7e33a72ea2f484f[$v3c6e0b8a9c15224a8228b9a98ca1531d];if (!is_numeric($v684e7fcd9c20d41a3074eb495fe91a7f)) {return false;}$v52195dae0174459c5f066fa0df053c26 = $this->getSourceId();$v5f694956811487225d15e973ca38fbab = $this->relations->getNewTypeIdRelation($v52195dae0174459c5f066fa0df053c26, $v684e7fcd9c20d41a3074eb495fe91a7f);if ($v5f694956811487225d15e973ca38fbab) {return $v5f694956811487225d15e973ca38fbab;}$v599dcce2998a6b40b1e38e8c6006cb0a = umiObjectTypesCollection::getInstance()    ->getType($v684e7fcd9c20d41a3074eb495fe91a7f);if ($v599dcce2998a6b40b1e38e8c6006cb0a instanceof iUmiObjectType) {$v5f694956811487225d15e973ca38fbab = $v684e7fcd9c20d41a3074eb495fe91a7f;$this->relations->setTypeIdRelation($v52195dae0174459c5f066fa0df053c26, $v684e7fcd9c20d41a3074eb495fe91a7f, $v5f694956811487225d15e973ca38fbab);}return $v5f694956811487225d15e973ca38fbab;}protected function getSourceId() {return $this->relations->getSourceId($this->sourceName);}protected function translateEntity($v5c203840dfcdf51dd7e33a72ea2f484f) {$vbfa030fe63bacd523dd70a76cfaed98a = $this->determinePageParent($v5c203840dfcdf51dd7e33a72ea2f484f);$v5f694956811487225d15e973ca38fbab = $this->determineEntityType($v5c203840dfcdf51dd7e33a72ea2f484f, $vbfa030fe63bacd523dd70a76cfaed98a);$this->determineEntityId($v5c203840dfcdf51dd7e33a72ea2f484f);$this->determinePageRelation($vbfa030fe63bacd523dd70a76cfaed98a);$this->initializePage($v5f694956811487225d15e973ca38fbab, $vbfa030fe63bacd523dd70a76cfaed98a);$this->translatePropertyList($v5c203840dfcdf51dd7e33a72ea2f484f, $v5f694956811487225d15e973ca38fbab);}protected function determineEntityId($v5c203840dfcdf51dd7e33a72ea2f484f) {$v3c6e0b8a9c15224a8228b9a98ca1531d = array_search('id', $this->nameList);if ($v3c6e0b8a9c15224a8228b9a98ca1531d !== false && $v5c203840dfcdf51dd7e33a72ea2f484f[$v3c6e0b8a9c15224a8228b9a98ca1531d]) {$vb80bb7740288fda1f201890375a60c8f = $v5c203840dfcdf51dd7e33a72ea2f484f[$v3c6e0b8a9c15224a8228b9a98ca1531d];}else {$vb80bb7740288fda1f201890375a60c8f = md5(mt_rand());}$this->entityId = $vb80bb7740288fda1f201890375a60c8f;}protected function translatePropertyList(array $vca3a34ad419c2f783bc2dbda90d53c41, $v5f694956811487225d15e973ca38fbab) {foreach ($vca3a34ad419c2f783bc2dbda90d53c41 as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v2063c1608d6e0baf80249c42e2be5804) {$this->translateProperty($v3c6e0b8a9c15224a8228b9a98ca1531d, $v2063c1608d6e0baf80249c42e2be5804, $v5f694956811487225d15e973ca38fbab);}}protected function isEntityChildNode($vb068931cc450442b63f5b3d276ea4297) {return in_array($vb068931cc450442b63f5b3d276ea4297, ['name', 'template-id']);}private function determineEntityType($v5c203840dfcdf51dd7e33a72ea2f484f, $vbfa030fe63bacd523dd70a76cfaed98a) {$v5f694956811487225d15e973ca38fbab = $this->determineEntityTypeFromExternalType($v5c203840dfcdf51dd7e33a72ea2f484f);if (!$v5f694956811487225d15e973ca38fbab) {$v5f694956811487225d15e973ca38fbab = $this->pickAppropriatePageType($vbfa030fe63bacd523dd70a76cfaed98a);}$v52195dae0174459c5f066fa0df053c26 = $this->getSourceId();if ($v5f694956811487225d15e973ca38fbab != $this->relations->getNewTypeIdRelation($v52195dae0174459c5f066fa0df053c26, $v5f694956811487225d15e973ca38fbab)) {$this->relations->setTypeIdRelation($v52195dae0174459c5f066fa0df053c26, $v5f694956811487225d15e973ca38fbab, $v5f694956811487225d15e973ca38fbab);}return $v5f694956811487225d15e973ca38fbab;}private function initialize() {$this->resetState();$this->importId = getRequest('param0');$v8c7dd922ad47494fc02c388e12c00eac = new umiFile($this->file_path);if (!$this->sourceName) {$this->sourceName = $v8c7dd922ad47494fc02c388e12c00eac->getFileName();}$this->relations = umiImportRelations::getInstance();$this->relations->addNewSource($this->sourceName);$this->initializeDocument();}private function initializeDocument() {$this->document = new DOMDocument('1.0', 'utf-8');$this->document->formatOutput = XML_FORMAT_OUTPUT;$this->createDocumentSkeleton();}private function doOneIteration() {$this->openImportFile();$this->buildUmidump();$this->advanceOffset();$this->determineCompleteness();$this->closeImportFile();}private function openImportFile() {$this->importFile = fopen($this->file_path, 'r');}private function buildUmidump() {while (!$this->isIterationFinished()) {$vf1965a857bc285d26fe22023aa5ab50d = $this->findNextRow();if (!$vf1965a857bc285d26fe22023aa5ab50d) {continue;}$this->incrementPosition();$this->translateRow($vf1965a857bc285d26fe22023aa5ab50d);}}private function isIterationFinished() {if (feof($this->importFile)) {return true;}return $this->position - self::HEADER_COUNT >= $this->block_size;}private function findNextRow() {$vf81a20fe8d8fe604339c0f1e29f4e1b5 = '';do {$vf81a20fe8d8fe604339c0f1e29f4e1b5 .= (string) fgets($this->importFile);}while (!feof($this->importFile) && !$this->isValidRow($vf81a20fe8d8fe604339c0f1e29f4e1b5));return $vf81a20fe8d8fe604339c0f1e29f4e1b5;}private function isValidRow($vf1965a857bc285d26fe22023aa5ab50d) {return mb_substr_count($vf1965a857bc285d26fe22023aa5ab50d, self::VALUE_LIMITER) % 2 === 0;}private function incrementPosition() {$this->position += 1;}private function translateRow($vf1965a857bc285d26fe22023aa5ab50d) {$vf1965a857bc285d26fe22023aa5ab50d = $this->normalizeRow($vf1965a857bc285d26fe22023aa5ab50d);$v5c203840dfcdf51dd7e33a72ea2f484f = $this->getRowCells($vf1965a857bc285d26fe22023aa5ab50d);if ($this->isCurrentRowAHeader()) {$this->updateHeader($v5c203840dfcdf51dd7e33a72ea2f484f);}else {$this->translateEntity($v5c203840dfcdf51dd7e33a72ea2f484f);}}private function normalizeRow($vf1965a857bc285d26fe22023aa5ab50d) {$vf1965a857bc285d26fe22023aa5ab50d = html_entity_decode($vf1965a857bc285d26fe22023aa5ab50d, ENT_QUOTES, $this->encoding);$vf1965a857bc285d26fe22023aa5ab50d = (string) preg_replace(    "/([^{$this->propertyDelimiter}])" . str_repeat(self::VALUE_LIMITER, 2) . '/s',    "$1'*//*'",    $vf1965a857bc285d26fe22023aa5ab50d   );preg_match_all('/' . self::VALUE_LIMITER . '(.*?)' . self::VALUE_LIMITER . '/s', $vf1965a857bc285d26fe22023aa5ab50d, $v9c28d32df234037773be184dbdafc274);foreach ($v9c28d32df234037773be184dbdafc274[0] as $v2150fd65034a9bcdb357943b3900a918) {$vcd98ed9d0c33939793e2a0fc9400fc2b = str_replace($this->propertyDelimiter, "'////'", $v2150fd65034a9bcdb357943b3900a918);$vf1965a857bc285d26fe22023aa5ab50d = str_replace($v2150fd65034a9bcdb357943b3900a918, $vcd98ed9d0c33939793e2a0fc9400fc2b, $vf1965a857bc285d26fe22023aa5ab50d);}$vf1965a857bc285d26fe22023aa5ab50d = (string) preg_replace('/(.+)' . $this->propertyDelimiter . '$/s', '$1', trim($vf1965a857bc285d26fe22023aa5ab50d));return $vf1965a857bc285d26fe22023aa5ab50d;}private function getRowCells($vf1965a857bc285d26fe22023aa5ab50d) {$v59df83e33d13851b6c9b1d341422aeb7 = explode($this->propertyDelimiter, $vf1965a857bc285d26fe22023aa5ab50d);foreach ($v59df83e33d13851b6c9b1d341422aeb7 as &$v8d27600b0cae5308441ddf6d9bb3c74c) {$v8d27600b0cae5308441ddf6d9bb3c74c = $this->normalizeCell($v8d27600b0cae5308441ddf6d9bb3c74c);}return $v59df83e33d13851b6c9b1d341422aeb7;}private function normalizeCell($v8d27600b0cae5308441ddf6d9bb3c74c) {$v8d27600b0cae5308441ddf6d9bb3c74c = mb_convert_encoding($v8d27600b0cae5308441ddf6d9bb3c74c, self::TARGET_ENCODING, $this->encoding);$v8d27600b0cae5308441ddf6d9bb3c74c = str_replace(["'////'", "'*//*'"], [$this->propertyDelimiter, self::VALUE_LIMITER], $v8d27600b0cae5308441ddf6d9bb3c74c);$v8d27600b0cae5308441ddf6d9bb3c74c = (string) preg_replace('/^' . self::VALUE_LIMITER . '(.*)' . self::VALUE_LIMITER . '$/s', '$1', $v8d27600b0cae5308441ddf6d9bb3c74c);return trim($v8d27600b0cae5308441ddf6d9bb3c74c);}private function isCurrentRowAHeader() {return $this->position <= self::HEADER_COUNT;}private function updateHeader(array $v5c203840dfcdf51dd7e33a72ea2f484f) {switch ($this->position) {case 1:     $v099fb995346f31c749f6e40db0f395e3 = &$this->nameList;break;case 2:     $v099fb995346f31c749f6e40db0f395e3 = &$this->titleList;break;case 3:     $v099fb995346f31c749f6e40db0f395e3 = &$this->typeList;if ($this->offset > 0) {$this->skipOverTranslatedRows();}break;default:     throw new LogicException("{$this->position} should be in the range 1..3");}foreach ($v5c203840dfcdf51dd7e33a72ea2f484f as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v2063c1608d6e0baf80249c42e2be5804) {$v099fb995346f31c749f6e40db0f395e3[$v3c6e0b8a9c15224a8228b9a98ca1531d] = $v2063c1608d6e0baf80249c42e2be5804;}}private function skipOverTranslatedRows() {fseek($this->importFile, $this->offset);}private function determinePageParent($v5c203840dfcdf51dd7e33a72ea2f484f) {$vbfa030fe63bacd523dd70a76cfaed98a = 0;$v3c6e0b8a9c15224a8228b9a98ca1531d = array_search('parent-id', $this->nameList);if ($v3c6e0b8a9c15224a8228b9a98ca1531d !== false) {$vbfa030fe63bacd523dd70a76cfaed98a = $v5c203840dfcdf51dd7e33a72ea2f484f[$v3c6e0b8a9c15224a8228b9a98ca1531d];}return $vbfa030fe63bacd523dd70a76cfaed98a;}private function pickAppropriatePageType($vbfa030fe63bacd523dd70a76cfaed98a) {$v5f694956811487225d15e973ca38fbab = false;if (!$vbfa030fe63bacd523dd70a76cfaed98a && $this->importId) {$v91c8246e48b278ccf9e985d258de9cc9 = umiObjectsCollection::getInstance()     ->getObject($this->importId)     ->getValue('elements');if (is_array($v91c8246e48b278ccf9e985d258de9cc9) && umiCount($v91c8246e48b278ccf9e985d258de9cc9)) {$vbfa030fe63bacd523dd70a76cfaed98a = $v91c8246e48b278ccf9e985d258de9cc9[0]->getId();}}if ($vbfa030fe63bacd523dd70a76cfaed98a) {$v5f694956811487225d15e973ca38fbab = umiHierarchy::getInstance()     ->getDominantTypeId($vbfa030fe63bacd523dd70a76cfaed98a);}if (!$v5f694956811487225d15e973ca38fbab) {$v5f694956811487225d15e973ca38fbab = umiObjectTypesCollection::getInstance()     ->getTypeIdByHierarchyTypeName('content');}return $v5f694956811487225d15e973ca38fbab;}private function determinePageRelation($vbfa030fe63bacd523dd70a76cfaed98a) {if (!$this->entityId) {return;}$vf03ad9e4ebc731946c49a47a1a26925d = $this->document->createElement('relation');$vf03ad9e4ebc731946c49a47a1a26925d->setAttribute('id', $this->entityId);$vf03ad9e4ebc731946c49a47a1a26925d->setAttribute('parent-id', $vbfa030fe63bacd523dd70a76cfaed98a);$vb81ca7c0ccaa77e7aa91936ab0070695 = $this->document->getElementsByTagName('hierarchy')->item(0);$vb81ca7c0ccaa77e7aa91936ab0070695->appendChild($vf03ad9e4ebc731946c49a47a1a26925d);}private function initializePage($v5f694956811487225d15e973ca38fbab, $vbfa030fe63bacd523dd70a76cfaed98a) {$this->entity = $this->document->createElement('page');$this->entity->setAttribute('type-id', $v5f694956811487225d15e973ca38fbab);$this->entity->setAttribute('parentId', $vbfa030fe63bacd523dd70a76cfaed98a);$v91c8246e48b278ccf9e985d258de9cc9 = $this->document->getElementsByTagName('pages')->item(0);$v91c8246e48b278ccf9e985d258de9cc9->appendChild($this->entity);$this->group = $this->document->createElement('group');$this->group->setAttribute('name', 'newGroup');$vb646a797ad6934dd0e9fca831cab280d = $this->document->createElement('properties');$vb646a797ad6934dd0e9fca831cab280d->appendChild($this->group);$this->entity->appendChild($vb646a797ad6934dd0e9fca831cab280d);}private function translateProperty($v3c6e0b8a9c15224a8228b9a98ca1531d, $v2063c1608d6e0baf80249c42e2be5804, $v5f694956811487225d15e973ca38fbab) {if ($this->shouldSkipProperty($v3c6e0b8a9c15224a8228b9a98ca1531d, $v2063c1608d6e0baf80249c42e2be5804)) {return;}$vb068931cc450442b63f5b3d276ea4297 = $this->nameList[$v3c6e0b8a9c15224a8228b9a98ca1531d];$v2063c1608d6e0baf80249c42e2be5804 = $this->escapePropertyValue($v2063c1608d6e0baf80249c42e2be5804);if ($this->isEntityAttribute($vb068931cc450442b63f5b3d276ea4297)) {$v2063c1608d6e0baf80249c42e2be5804 = ($vb068931cc450442b63f5b3d276ea4297 === 'id') ? $this->entityId : $v2063c1608d6e0baf80249c42e2be5804;$this->addEntityAttribute($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804);}elseif ($this->isEntityChildNode($vb068931cc450442b63f5b3d276ea4297)) {$this->addEntityChildNode($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804);}else {$this->addProperty($v3c6e0b8a9c15224a8228b9a98ca1531d, $v2063c1608d6e0baf80249c42e2be5804, $v5f694956811487225d15e973ca38fbab);}}private function shouldSkipProperty($v3c6e0b8a9c15224a8228b9a98ca1531d, $v2063c1608d6e0baf80249c42e2be5804) {if (!isset($this->nameList[$v3c6e0b8a9c15224a8228b9a98ca1531d])) {return true;}if (!$v2063c1608d6e0baf80249c42e2be5804 && !$this->resetVal && !isset($this->typeList[$v3c6e0b8a9c15224a8228b9a98ca1531d])) {return true;}return false;}private function escapePropertyValue($v2063c1608d6e0baf80249c42e2be5804) {return strtr($v2063c1608d6e0baf80249c42e2be5804, [    '&' => '&amp;',    '<' => '&lt;',    '>' => '&gt;',   ]);}private function isEntityAttribute($vb068931cc450442b63f5b3d276ea4297) {return    in_array($vb068931cc450442b63f5b3d276ea4297, $this->simpleAttributeList) ||    in_array($vb068931cc450442b63f5b3d276ea4297, $this->specialAttributeList);}private function addEntityAttribute($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804) {if (in_array($vb068931cc450442b63f5b3d276ea4297, $this->simpleAttributeList)) {$this->entity->setAttribute($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804);}}private function addEntityChildNode($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804) {if ($vb068931cc450442b63f5b3d276ea4297 === 'name') {$v8e22bd17ebebd8e5c45b7bc4000e6cd7 = $this->document->createElement('name', $v2063c1608d6e0baf80249c42e2be5804);$this->entity->appendChild($v8e22bd17ebebd8e5c45b7bc4000e6cd7);}elseif ($vb068931cc450442b63f5b3d276ea4297 === 'template-id') {$this->addPageTemplate($v2063c1608d6e0baf80249c42e2be5804);}}private function addPageTemplate($v3200a31fc05da4e9d5a0465c36822e2f) {$v66f6181bcb4cff4cd38fbc804a036db6 = templatesCollection::getInstance()    ->getTemplate($v3200a31fc05da4e9d5a0465c36822e2f);if ($v66f6181bcb4cff4cd38fbc804a036db6 instanceof iTemplate) {$v01947397aa2c441e93a8f772847d5aca = $this->document->createElement('template', $v66f6181bcb4cff4cd38fbc804a036db6->getFilename());$v01947397aa2c441e93a8f772847d5aca->setAttribute('id', $v3200a31fc05da4e9d5a0465c36822e2f);$this->entity->appendChild($v01947397aa2c441e93a8f772847d5aca);}}private function addProperty($v3c6e0b8a9c15224a8228b9a98ca1531d, $v2063c1608d6e0baf80249c42e2be5804, $v5f694956811487225d15e973ca38fbab) {$this->property = $this->document->createElement('property');$vb068931cc450442b63f5b3d276ea4297 = $this->nameList[$v3c6e0b8a9c15224a8228b9a98ca1531d];$vd5d3db1765287eef77d7927cc956f50a = $this->titleList[$v3c6e0b8a9c15224a8228b9a98ca1531d];$v599dcce2998a6b40b1e38e8c6006cb0a = $this->typeList[$v3c6e0b8a9c15224a8228b9a98ca1531d];$v09ec737a9ab66d1d796304239d3f8a86 = in_array($v599dcce2998a6b40b1e38e8c6006cb0a, $this->getMultipleDataTypes());$v599dcce2998a6b40b1e38e8c6006cb0a = ($v599dcce2998a6b40b1e38e8c6006cb0a === 'multiple-relation') ? 'relation' : $v599dcce2998a6b40b1e38e8c6006cb0a;$this->property->setAttribute('name', $vb068931cc450442b63f5b3d276ea4297);$this->property->setAttribute('title', $vd5d3db1765287eef77d7927cc956f50a);$this->property->setAttribute('type', $v599dcce2998a6b40b1e38e8c6006cb0a);if ($v09ec737a9ab66d1d796304239d3f8a86) {$this->property->setAttribute('multiple', 'multiple');}$this->property->setAttribute('visible', '1');$vcb3c134fd1dae5abe13a01dba8ae06e8 = (bool) $v2063c1608d6e0baf80249c42e2be5804;$this->property->setAttribute('allow-runtime-add', (int) $vcb3c134fd1dae5abe13a01dba8ae06e8);$v726e8e4809d4c1b28a6549d86436a124 = umiObjectTypesCollection::getInstance()    ->getType($v5f694956811487225d15e973ca38fbab);if (!$vcb3c134fd1dae5abe13a01dba8ae06e8 && $v726e8e4809d4c1b28a6549d86436a124 instanceof iUmiObjectType && !$v726e8e4809d4c1b28a6549d86436a124->getFieldId($vb068931cc450442b63f5b3d276ea4297)) {return;}$v8d90d57cd5d62bf377f6f8bc0cffc325 = $this->document->createElement('type');$v8d90d57cd5d62bf377f6f8bc0cffc325->setAttribute('data-type', $v599dcce2998a6b40b1e38e8c6006cb0a);$vd810bb570623caa3d7d80b29afbb7d52 = $this->getPropertyTypeTitle($vb068931cc450442b63f5b3d276ea4297, $v599dcce2998a6b40b1e38e8c6006cb0a, $v09ec737a9ab66d1d796304239d3f8a86);$v8d90d57cd5d62bf377f6f8bc0cffc325->setAttribute('name', $vd810bb570623caa3d7d80b29afbb7d52);$this->property->appendChild($v8d90d57cd5d62bf377f6f8bc0cffc325);$v62ba412ece85d23c9beff7f13c51e5a8 = $this->document->createElement('title', $vd5d3db1765287eef77d7927cc956f50a);$this->property->appendChild($v62ba412ece85d23c9beff7f13c51e5a8);$this->group->appendChild($this->property);switch ($v599dcce2998a6b40b1e38e8c6006cb0a) {case 'relation' : {$this->setRelationProperty($v2063c1608d6e0baf80249c42e2be5804, $v09ec737a9ab66d1d796304239d3f8a86);break;}case 'tags' : {$this->setTagsProperty($v2063c1608d6e0baf80249c42e2be5804);break;}case 'symlink' : {$this->setSymlinkProperty($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804);break;}case 'multiple_image' : {$this->setMultipleImageProperty($v2063c1608d6e0baf80249c42e2be5804);break;}case 'optioned' : {$this->setOptionedProperty($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804);break;}case 'domain_id' :    case 'domain_id_list' : {$this->setDomainProperty($v2063c1608d6e0baf80249c42e2be5804, $v09ec737a9ab66d1d796304239d3f8a86);break;}default : {$this->setSimpleProperty($v2063c1608d6e0baf80249c42e2be5804);}}}private function getMultipleDataTypes() {return [    'multiple-relation',    'tags',    'multiple_image',    'symlink',    'optioned',    'domain_id_list',    'offer_id_list'   ];}private function getPropertyTypeTitle($vb068931cc450442b63f5b3d276ea4297, $v599dcce2998a6b40b1e38e8c6006cb0a, $v09ec737a9ab66d1d796304239d3f8a86) {$v833750ac635fcc57dc33ecafe365f9a7 = umiFieldTypesCollection::getInstance()    ->getFieldTypeByDataType($v599dcce2998a6b40b1e38e8c6006cb0a, $v09ec737a9ab66d1d796304239d3f8a86);if (!$v833750ac635fcc57dc33ecafe365f9a7 instanceof iUmiFieldType) {throw new coreException('Wrong datatype "' . $v599dcce2998a6b40b1e38e8c6006cb0a . '" is given for property "' . $vb068931cc450442b63f5b3d276ea4297 . '"');}return $v833750ac635fcc57dc33ecafe365f9a7->getName();}private function setRelationProperty($v2063c1608d6e0baf80249c42e2be5804, $v09ec737a9ab66d1d796304239d3f8a86) {$vf390d9ed4004a4e088e29464c661f362 = $this->document->createElement('value');$this->property->appendChild($vf390d9ed4004a4e088e29464c661f362);$vb586e09ccdd309a0a18b5e0d5c2bfd02 = $this->extractMultiplePropertyValues($v2063c1608d6e0baf80249c42e2be5804);$vb586e09ccdd309a0a18b5e0d5c2bfd02 = $v09ec737a9ab66d1d796304239d3f8a86 ? $vb586e09ccdd309a0a18b5e0d5c2bfd02 : (array) getFirstValue($vb586e09ccdd309a0a18b5e0d5c2bfd02);foreach ($vb586e09ccdd309a0a18b5e0d5c2bfd02 as $vb068931cc450442b63f5b3d276ea4297) {$v399a75af3a8a951a74e76f096d19233b = $this->document->createElement('item');$v399a75af3a8a951a74e76f096d19233b->setAttribute('name', $vb068931cc450442b63f5b3d276ea4297);$vf390d9ed4004a4e088e29464c661f362->appendChild($v399a75af3a8a951a74e76f096d19233b);}}private function extractMultiplePropertyValues($v2063c1608d6e0baf80249c42e2be5804) {return explode(',', $v2063c1608d6e0baf80249c42e2be5804);}private function setTagsProperty($v2063c1608d6e0baf80249c42e2be5804) {$v258b6dbee99b4c3cee79c74a4c2e8870 = explode(',', $v2063c1608d6e0baf80249c42e2be5804);foreach ($v258b6dbee99b4c3cee79c74a4c2e8870 as $ve4d23e841d8e8804190027bce3180fa5) {$vf390d9ed4004a4e088e29464c661f362 = $this->document->createElement('value', trim($ve4d23e841d8e8804190027bce3180fa5));$this->property->appendChild($vf390d9ed4004a4e088e29464c661f362);}$v5df986bc14af33e630d925cb5d55fb63 = $this->document->createElement('combined', $v2063c1608d6e0baf80249c42e2be5804);$this->property->appendChild($v5df986bc14af33e630d925cb5d55fb63);}private function setDomainProperty($v2063c1608d6e0baf80249c42e2be5804, $v09ec737a9ab66d1d796304239d3f8a86) {$vf390d9ed4004a4e088e29464c661f362 = $this->document->createElement('value');$this->property->appendChild($vf390d9ed4004a4e088e29464c661f362);$vad5658491d1cbf0909b631e0cc6d938d = $this->extractMultiplePropertyValues($v2063c1608d6e0baf80249c42e2be5804);$vad5658491d1cbf0909b631e0cc6d938d = $v09ec737a9ab66d1d796304239d3f8a86 ? $vad5658491d1cbf0909b631e0cc6d938d : (array) getFirstValue($vad5658491d1cbf0909b631e0cc6d938d);foreach ($vad5658491d1cbf0909b631e0cc6d938d as $v72ee76c5c29383b7c9f9225c1fa4d10b) {$v204aadf644884156d194b4fccb7a101a = $this->document->createElement('domain');$v204aadf644884156d194b4fccb7a101a->setAttribute('id', $v72ee76c5c29383b7c9f9225c1fa4d10b);$vf390d9ed4004a4e088e29464c661f362->appendChild($v204aadf644884156d194b4fccb7a101a);}}private function setSymlinkProperty($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804) {if (!$this->entityId) {return;}$vf03ad9e4ebc731946c49a47a1a26925d = $this->document->createElement('relation');$v06c5b10273a69992d8c6933e294909fa = $this->document->getElementsByTagName('relations')->item(0);$v06c5b10273a69992d8c6933e294909fa->appendChild($vf03ad9e4ebc731946c49a47a1a26925d);$vf03ad9e4ebc731946c49a47a1a26925d->setAttribute('page-id', $this->entityId);$vf03ad9e4ebc731946c49a47a1a26925d->setAttribute('field-name', $vb068931cc450442b63f5b3d276ea4297);$vbf95cbea2fbc6aab956a058a7afb3e45 = $this->extractMultiplePropertyValues($v2063c1608d6e0baf80249c42e2be5804);foreach ($vbf95cbea2fbc6aab956a058a7afb3e45 as $va6eb4816205178e88dad66a16a19ff45) {$v77f3c48f175369c446fbe421012437c2 = $this->document->createElement('page');$v77f3c48f175369c446fbe421012437c2->setAttribute('id', $va6eb4816205178e88dad66a16a19ff45);$vf03ad9e4ebc731946c49a47a1a26925d->appendChild($v77f3c48f175369c446fbe421012437c2);}}private function setMultipleImageProperty($v2063c1608d6e0baf80249c42e2be5804) {$v72bc6e7707131edcbe44c867e3bc83e1 = explode($this->valueDelimiter, $v2063c1608d6e0baf80249c42e2be5804);foreach ($v72bc6e7707131edcbe44c867e3bc83e1 as $v78805a221a988e79ef3f42d7c5bfd418) {$v303619f899f8ee729105501399b9ee98 = explode($this->partDelimiter, $v78805a221a988e79ef3f42d7c5bfd418);if (umiCount($v303619f899f8ee729105501399b9ee98) !== self::MULTIPLE_IMAGE_PART_COUNT) {continue;}$vf390d9ed4004a4e088e29464c661f362 = $this->document->createElement('value');$this->property->appendChild($vf390d9ed4004a4e088e29464c661f362);foreach ($v303619f899f8ee729105501399b9ee98 as $vf4c9385f1902f7334b00b9b4ecd164de) {list($vfdaa6579f11df4e8b3c095f7589e36d2, $va041ffc55b475c7ed7ee874346ef8ee5) = explode($this->subPartDelimiter, $vf4c9385f1902f7334b00b9b4ecd164de);$vf390d9ed4004a4e088e29464c661f362->setAttribute($vfdaa6579f11df4e8b3c095f7589e36d2, $va041ffc55b475c7ed7ee874346ef8ee5);}}}private function setOptionedProperty($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804) {$v024250f16186740f08e02ff947b2f421 = $this->document->getElementsByTagName('options')->item(0);$v904392a19930b5c35e97bfd3c4dac307 = $this->document->createElement('entity');$v904392a19930b5c35e97bfd3c4dac307->setAttribute('page-id', $this->entityId);$v904392a19930b5c35e97bfd3c4dac307->setAttribute('field-name', $vb068931cc450442b63f5b3d276ea4297);$v024250f16186740f08e02ff947b2f421->appendChild($v904392a19930b5c35e97bfd3c4dac307);$v3fc4ccbf592add60bab4a416a13b81e7 = explode($this->valueDelimiter, $v2063c1608d6e0baf80249c42e2be5804);foreach ($v3fc4ccbf592add60bab4a416a13b81e7 as $vef3e30e070f70244fd6578d88a6b77ac) {$v303619f899f8ee729105501399b9ee98 = explode($this->partDelimiter, $vef3e30e070f70244fd6578d88a6b77ac);if (umiCount($v303619f899f8ee729105501399b9ee98) !== self::OPTIONED_PART_COUNT) {continue;}$vc3660ff61995c9ac9ac147882e39bb2e = $this->document->createElement('option');$v904392a19930b5c35e97bfd3c4dac307->appendChild($vc3660ff61995c9ac9ac147882e39bb2e);foreach ($v303619f899f8ee729105501399b9ee98 as $vf4c9385f1902f7334b00b9b4ecd164de) {list($vfdaa6579f11df4e8b3c095f7589e36d2, $va041ffc55b475c7ed7ee874346ef8ee5) = explode($this->subPartDelimiter, $vf4c9385f1902f7334b00b9b4ecd164de);$vc3660ff61995c9ac9ac147882e39bb2e->setAttribute($vfdaa6579f11df4e8b3c095f7589e36d2, $va041ffc55b475c7ed7ee874346ef8ee5);}}}private function setSimpleProperty($v2063c1608d6e0baf80249c42e2be5804) {$vf390d9ed4004a4e088e29464c661f362 = $this->document->createElement('value', $v2063c1608d6e0baf80249c42e2be5804);$this->property->appendChild($vf390d9ed4004a4e088e29464c661f362);}private function advanceOffset() {$this->offset = ftell($this->importFile);}private function determineCompleteness() {$this->complete = !$this->importFile || feof($this->importFile);}private function closeImportFile() {fclose($this->importFile);}public function translate(DOMDocument $vfdc3bdefb79cec8eb8211d2499e04704) {return $vfdc3bdefb79cec8eb8211d2499e04704->saveXML();}}