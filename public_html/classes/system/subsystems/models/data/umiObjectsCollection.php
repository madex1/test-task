<?php
 use UmiCms\Service;class umiObjectsCollection extends singleton implements iSingleton, iUmiObjectsCollection {private $objects = [];private $updatedObjects = [];protected function __construct() {}public static function getInstance($v4a8a08f09d37b73795649038408b5f33 = null) {return parent::getInstance(__CLASS__);}public static function isGuideItemsOrderedById() {$vc3f4c753beb9cb66d27cc964ad4c924c = Service::Registry()->get('//settings/ignore_guides_sort');if ($vc3f4c753beb9cb66d27cc964ad4c924c) {return true;}return (bool) mainConfiguration::getInstance()->get('kernel', 'order-guide-items-by-id');}public function isLoaded($vb80bb7740288fda1f201890375a60c8f) {if (!is_int($vb80bb7740288fda1f201890375a60c8f) && !is_string($vb80bb7740288fda1f201890375a60c8f)) {return false;}return array_key_exists($vb80bb7740288fda1f201890375a60c8f, $this->objects);}public function isExists($vb80bb7740288fda1f201890375a60c8f, $v5f694956811487225d15e973ca38fbab = false) {if (!is_numeric($vb80bb7740288fda1f201890375a60c8f)) {return false;}$vdd72c7e6b438fd5745e06d5af3ba9b2f = is_numeric($v5f694956811487225d15e973ca38fbab);if (!$vdd72c7e6b438fd5745e06d5af3ba9b2f && func_num_args() > 1) {return false;}$vb80bb7740288fda1f201890375a60c8f = (int) $vb80bb7740288fda1f201890375a60c8f;$v3f9178c25b78ed8bed19091bcb62e266 = " `id` = $vb80bb7740288fda1f201890375a60c8f";if ($vdd72c7e6b438fd5745e06d5af3ba9b2f) {$v5f694956811487225d15e973ca38fbab = (int) $v5f694956811487225d15e973ca38fbab;$v3f9178c25b78ed8bed19091bcb62e266 .= " AND `type_id` = $v5f694956811487225d15e973ca38fbab";}$v1b1cc7f086b3f074da452bc3129981eb = <<<SQL
SELECT `id` FROM `cms3_objects` WHERE $v3f9178c25b78ed8bed19091bcb62e266 LIMIT 0,1
SQL;   return ConnectionPool::getInstance()    ->getConnection()    ->queryResult($v1b1cc7f086b3f074da452bc3129981eb)    ->length() === 1;}public function isUmiObject($va8cfde6331bd59eb2ac96f8911c4b666) {return ($va8cfde6331bd59eb2ac96f8911c4b666 instanceof iUmiObject);}public function getObjectByName($vb068931cc450442b63f5b3d276ea4297, $v5f694956811487225d15e973ca38fbab = false) {if ($v5f694956811487225d15e973ca38fbab !== false && !is_numeric($v5f694956811487225d15e973ca38fbab)) {return false;}$v6991c82e28235d7fd6c19bd93a6b5421 = ulangStream::getI18n($vb068931cc450442b63f5b3d276ea4297);$vd304ba20e96d87411588eeabac850e34 = ($v6991c82e28235d7fd6c19bd93a6b5421 === null) ? $vb068931cc450442b63f5b3d276ea4297 : $v6991c82e28235d7fd6c19bd93a6b5421;$vd2335eb1e161a0ac39660d4e39558704 = ConnectionPool::getInstance()->getConnection();$v668d478bed99b96959884dde1db9963e = ($vb068931cc450442b63f5b3d276ea4297 !== $vd304ba20e96d87411588eeabac850e34);$vd304ba20e96d87411588eeabac850e34 = $vd2335eb1e161a0ac39660d4e39558704->escape($vd304ba20e96d87411588eeabac850e34);$vb068931cc450442b63f5b3d276ea4297 = $vd2335eb1e161a0ac39660d4e39558704->escape($vb068931cc450442b63f5b3d276ea4297);$v00d12898a95e210e74cb05082e8cd28b = $vd2335eb1e161a0ac39660d4e39558704->escape($v5f694956811487225d15e973ca38fbab);$v20012c0b3e5db47f77aef7ef52598f71 = $v668d478bed99b96959884dde1db9963e ? "(`name` = '{$vb068931cc450442b63f5b3d276ea4297}' or `name` = '{$vd304ba20e96d87411588eeabac850e34}')" : "`name` = '{$vd304ba20e96d87411588eeabac850e34}'";$ve1ba59ed55820ca11c343ef4c47793ff = $v5f694956811487225d15e973ca38fbab !== false ? "AND `type_id` = '${v00d12898a95e210e74cb05082e8cd28b}'" : '';$v1b1cc7f086b3f074da452bc3129981eb = <<<QUERY
SELECT id
FROM   `cms3_objects`
WHERE  ${v20012c0b3e5db47f77aef7ef52598f71}
       ${ve1ba59ed55820ca11c343ef4c47793ff}
LIMIT  1
QUERY;   $result = $vd2335eb1e161a0ac39660d4e39558704->queryResult($v1b1cc7f086b3f074da452bc3129981eb);if ($result instanceof IQueryResult) {$result->setFetchType(IQueryResult::FETCH_ASSOC);$vf1965a857bc285d26fe22023aa5ab50d = $result->fetch();if (isset($vf1965a857bc285d26fe22023aa5ab50d['id']) && is_numeric($vf1965a857bc285d26fe22023aa5ab50d['id'])) {return $this->getObject($vf1965a857bc285d26fe22023aa5ab50d['id']);}return false;}return false;}public function getObject($vb80bb7740288fda1f201890375a60c8f, $v8d777f385d3dfec8815d20f7496026dc = false) {if (!is_numeric($vb80bb7740288fda1f201890375a60c8f) || $vb80bb7740288fda1f201890375a60c8f === 0) {return false;}$vb80bb7740288fda1f201890375a60c8f = (int) $vb80bb7740288fda1f201890375a60c8f;if ($this->isLoaded($vb80bb7740288fda1f201890375a60c8f)) {return $this->objects[$vb80bb7740288fda1f201890375a60c8f];}$v9549dd6065d019211460c59a86dd6536 = Service::DataObjectFactory();try {if (is_array($v8d777f385d3dfec8815d20f7496026dc)) {array_unshift($v8d777f385d3dfec8815d20f7496026dc, $vb80bb7740288fda1f201890375a60c8f);$va8cfde6331bd59eb2ac96f8911c4b666 = $v9549dd6065d019211460c59a86dd6536->createByData($v8d777f385d3dfec8815d20f7496026dc);}else {$va8cfde6331bd59eb2ac96f8911c4b666 = $v9549dd6065d019211460c59a86dd6536->createById($vb80bb7740288fda1f201890375a60c8f);}$this->objects[$vb80bb7740288fda1f201890375a60c8f] = $va8cfde6331bd59eb2ac96f8911c4b666;}catch (privateException $ve1671797c52e15f763380b45e841ec32) {$ve1671797c52e15f763380b45e841ec32->unregister();return false;}return $this->objects[$vb80bb7740288fda1f201890375a60c8f];}public function getById($vb80bb7740288fda1f201890375a60c8f) {return $this->getObject($vb80bb7740288fda1f201890375a60c8f);}public function getListByType($vb80bb7740288fda1f201890375a60c8f) {if (!is_numeric($vb80bb7740288fda1f201890375a60c8f)) {return [];}$vb80bb7740288fda1f201890375a60c8f = (int) $vb80bb7740288fda1f201890375a60c8f;if ($vb80bb7740288fda1f201890375a60c8f === 0) {return [];}$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT o.id,
	   o.name,
	   o.type_id,
	   o.is_locked,
	   o.owner_id,
	   o.guid AS `guid`,
	   t.guid AS `type_guid`,
	   o.updatetime,
	   o.ord
FROM   cms3_objects `o`,
	   cms3_object_types `t`
WHERE  o.type_id = $vb80bb7740288fda1f201890375a60c8f
	   AND o.type_id = t.id
SQL;   $result = ConnectionPool::getInstance()    ->getConnection()    ->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);return $this->buildObjectList($result);}public function getObjectByGUID($v1e0ca5b1252f1f6b1e0ac91be7e7219e) {$vb80bb7740288fda1f201890375a60c8f = $this->getObjectIdByGUID($v1e0ca5b1252f1f6b1e0ac91be7e7219e);return $this->getObject($vb80bb7740288fda1f201890375a60c8f);}public function getObjectIdByGUID($v1e0ca5b1252f1f6b1e0ac91be7e7219e) {if (!is_string($v1e0ca5b1252f1f6b1e0ac91be7e7219e) || empty($v1e0ca5b1252f1f6b1e0ac91be7e7219e)) {return false;}foreach ($this->objects as $va8cfde6331bd59eb2ac96f8911c4b666) {if ($va8cfde6331bd59eb2ac96f8911c4b666->getGUID() == $v1e0ca5b1252f1f6b1e0ac91be7e7219e) {return $va8cfde6331bd59eb2ac96f8911c4b666->getId();}}$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()    ->getConnection();$v1e0ca5b1252f1f6b1e0ac91be7e7219e = $v4717d53ebfdfea8477f780ec66151dcb->escape($v1e0ca5b1252f1f6b1e0ac91be7e7219e);$v8bc4403642c02217dc1341694acb244d = <<<SQL
SELECT `id` FROM `cms3_objects` WHERE `guid` = '{$v1e0ca5b1252f1f6b1e0ac91be7e7219e}' LIMIT 0,1
SQL;   $result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($v8bc4403642c02217dc1341694acb244d);$result->setFetchType(IQueryResult::FETCH_ROW);if ($result->length() == 0) {return false;}$v54851b009c5c647ca3e77cc517b8c76c = $result->fetch();return (int) array_shift($v54851b009c5c647ca3e77cc517b8c76c);}public function getObjectList(array $v5a2576254d428ddc22a03fac145c8749) {$v5a2576254d428ddc22a03fac145c8749 = array_filter($v5a2576254d428ddc22a03fac145c8749, function ($vb80bb7740288fda1f201890375a60c8f) {return is_numeric($vb80bb7740288fda1f201890375a60c8f);});if (count($v5a2576254d428ddc22a03fac145c8749) == 0) {return [];}$v5a2576254d428ddc22a03fac145c8749 = array_map(function ($vb80bb7740288fda1f201890375a60c8f) {return (int) $vb80bb7740288fda1f201890375a60c8f;}, $v5a2576254d428ddc22a03fac145c8749);$v5a2576254d428ddc22a03fac145c8749 = array_unique($v5a2576254d428ddc22a03fac145c8749);$v5a2576254d428ddc22a03fac145c8749 = implode(',', $v5a2576254d428ddc22a03fac145c8749);$vac5c74b64b4b8352ef2f181affb5ac2a = <<<QUERY
	SELECT o.id,
		   o.name,
		   o.type_id,
		   o.is_locked,
		   o.owner_id,
		   o.guid AS `guid`,
		   t.guid AS `type_guid`,
		   o.updatetime,
		   o.ord
	FROM   cms3_objects `o`,
		   cms3_object_types `t`
	WHERE  o.id IN ({$v5a2576254d428ddc22a03fac145c8749})
		   AND o.type_id = t.id
QUERY;   $result = ConnectionPool::getInstance()    ->getConnection()    ->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);return $this->buildObjectList($result);}public function delObject($vb80bb7740288fda1f201890375a60c8f) {if (!is_numeric($vb80bb7740288fda1f201890375a60c8f) || $vb80bb7740288fda1f201890375a60c8f === 0) {return false;}$vb80bb7740288fda1f201890375a60c8f = (int) $vb80bb7740288fda1f201890375a60c8f;$v1876714ec08549d69462e2d7617c83c8 = Service::SystemUsersPermissions();if (in_array($vb80bb7740288fda1f201890375a60c8f, $v1876714ec08549d69462e2d7617c83c8->getIdList())) {throw new coreException("You are not allowed to delete object #{$vb80bb7740288fda1f201890375a60c8f}. Never. Don't even try.");}$va8cfde6331bd59eb2ac96f8911c4b666 = $this->getObject($vb80bb7740288fda1f201890375a60c8f);if (!$va8cfde6331bd59eb2ac96f8911c4b666 instanceof iUmiObject) {return false;}$va8cfde6331bd59eb2ac96f8911c4b666->commit();if ($va8cfde6331bd59eb2ac96f8911c4b666->getIsLocked()) {throw new coreException('Deleting an object is locked.');}$v4119639092e62c55ea8be348e4d9260d = new umiEventPoint('collectionDeleteObject');$v4119639092e62c55ea8be348e4d9260d->setParam('object_id', $vb80bb7740288fda1f201890375a60c8f);$v4119639092e62c55ea8be348e4d9260d->setMode('before');$v4119639092e62c55ea8be348e4d9260d->call();$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$vac5c74b64b4b8352ef2f181affb5ac2a = "DELETE FROM cms3_objects WHERE id = '{$vb80bb7740288fda1f201890375a60c8f}'";$v4717d53ebfdfea8477f780ec66151dcb->query($vac5c74b64b4b8352ef2f181affb5ac2a);$this->unloadObject($vb80bb7740288fda1f201890375a60c8f);unset($va8cfde6331bd59eb2ac96f8911c4b666);$v4119639092e62c55ea8be348e4d9260d->setMode('after');$v4119639092e62c55ea8be348e4d9260d->call();return true;}public function addObject($vb068931cc450442b63f5b3d276ea4297, $v5f694956811487225d15e973ca38fbab, $v73b8754d45983f35756b157ea439de8c = false) {$v5f694956811487225d15e973ca38fbab = (int) $v5f694956811487225d15e973ca38fbab;if (!$v5f694956811487225d15e973ca38fbab) {throw new coreException("Can't create object without object type id (null given)");}$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()    ->getConnection();$v4717d53ebfdfea8477f780ec66151dcb->startTransaction(sprintf('Create data object with type %d', $v5f694956811487225d15e973ca38fbab));try {$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
INSERT INTO cms3_objects VALUES(NULL, NULL, NULL, NULL, $v5f694956811487225d15e973ca38fbab, NULL, 0, NULL)
SQL;    $v4717d53ebfdfea8477f780ec66151dcb->query($vac5c74b64b4b8352ef2f181affb5ac2a);$va8cfde6331bd59eb2ac96f8911c4b666 = Service::DataObjectFactory()     ->createById($v4717d53ebfdfea8477f780ec66151dcb->insertId());$va8cfde6331bd59eb2ac96f8911c4b666->setName($vb068931cc450442b63f5b3d276ea4297);$va8cfde6331bd59eb2ac96f8911c4b666->setIsLocked($v73b8754d45983f35756b157ea439de8c);$va8cfde6331bd59eb2ac96f8911c4b666->setOwnerId(     $this->getOwnerId()    );$vae3e3650003133da0771a2e25f39d61f = $this->getMaxOrderByTypeId(     $va8cfde6331bd59eb2ac96f8911c4b666->getTypeId()    );$va8cfde6331bd59eb2ac96f8911c4b666->setOrder($vae3e3650003133da0771a2e25f39d61f + 1);$va8cfde6331bd59eb2ac96f8911c4b666->commit();}catch (Exception $v42552b1f133f9f8eb406d4f306ea9fd1) {$v4717d53ebfdfea8477f780ec66151dcb->rollbackTransaction();throw $v42552b1f133f9f8eb406d4f306ea9fd1;}$v4717d53ebfdfea8477f780ec66151dcb->commitTransaction();$this->objects[$va8cfde6331bd59eb2ac96f8911c4b666->getId()] = $va8cfde6331bd59eb2ac96f8911c4b666;return $va8cfde6331bd59eb2ac96f8911c4b666->getId();}public function cloneObject($vb80bb7740288fda1f201890375a60c8f) {$vb80bb7740288fda1f201890375a60c8f = (int) $vb80bb7740288fda1f201890375a60c8f;$va8cfde6331bd59eb2ac96f8911c4b666 = $this->getObject($vb80bb7740288fda1f201890375a60c8f);if (!$va8cfde6331bd59eb2ac96f8911c4b666 instanceof iUmiObject) {return false;}$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()    ->getConnection();$vc9550d5fad73447fc24ba47f95d1c6b7 = Service::ObjectPropertyValueTableSchema();$v4717d53ebfdfea8477f780ec66151dcb->startTransaction(sprintf('Clone object with id = "%d"', $vb80bb7740288fda1f201890375a60c8f));try {$vc85693a8aeebc39ce87905207fa943e0 = <<<SQL
INSERT INTO `cms3_objects` (`name`, `guid`, `is_locked`, `type_id`, `owner_id`, `ord`, `updatetime`)
SELECT `name`, `guid`, `is_locked`, `type_id`, `owner_id`, `ord`, `updatetime`
FROM `cms3_objects` WHERE `id` = $vb80bb7740288fda1f201890375a60c8f
SQL;    $v4717d53ebfdfea8477f780ec66151dcb->query($vc85693a8aeebc39ce87905207fa943e0);$vb15d7cc6038948c5f9aae452c262d0cb = (int) $v4717d53ebfdfea8477f780ec66151dcb->insertId();$vd786b32f1fc780f2e4f1b9a638f20089 = $vc9550d5fad73447fc24ba47f95d1c6b7->getDefaultTable();$vd1e5c72a82e24605a3a4791044c7d386 = <<<SQL
INSERT INTO `$vd786b32f1fc780f2e4f1b9a638f20089` (`obj_id`, `field_id`, `int_val`, `varchar_val`, `text_val`, `rel_val`, `tree_val`, `float_val`)
SELECT $vb15d7cc6038948c5f9aae452c262d0cb as `obj_id`, `field_id`, `int_val`, `varchar_val`, `text_val`, `rel_val`, `tree_val`, `float_val`
FROM `$vd786b32f1fc780f2e4f1b9a638f20089` WHERE `obj_id` = $vb80bb7740288fda1f201890375a60c8f
SQL;    $v4717d53ebfdfea8477f780ec66151dcb->query($vd1e5c72a82e24605a3a4791044c7d386);$v6481430c31dc2d69eef9755166009a96 = $vc9550d5fad73447fc24ba47f95d1c6b7->getImagesTable();$vc53bf57fc4ffb4c903f806c0d23ed15f = <<<SQL
INSERT INTO `$v6481430c31dc2d69eef9755166009a96` (`obj_id`, `field_id`, `src`, `alt`, `title`, `ord`)
SELECT $vb15d7cc6038948c5f9aae452c262d0cb as `obj_id`, `field_id`, `src`, `alt`, `title`, `ord`
FROM `$v6481430c31dc2d69eef9755166009a96` WHERE `obj_id` = $vb80bb7740288fda1f201890375a60c8f
SQL;    $v4717d53ebfdfea8477f780ec66151dcb->query($vc53bf57fc4ffb4c903f806c0d23ed15f);$v43d5a664cec7d50d0db5e48b0444f5c7 = $vc9550d5fad73447fc24ba47f95d1c6b7->getDomainIdTable();$v01901c8066746ecc27ae4050c06f4e0f = <<<SQL
INSERT INTO `$v43d5a664cec7d50d0db5e48b0444f5c7` (`obj_id`, `field_id`, `domain_id`)
SELECT $vb15d7cc6038948c5f9aae452c262d0cb as `obj_id`, `field_id`, `domain_id`
FROM `$v43d5a664cec7d50d0db5e48b0444f5c7` WHERE `obj_id` = $vb80bb7740288fda1f201890375a60c8f
SQL;    $v4717d53ebfdfea8477f780ec66151dcb->query($v01901c8066746ecc27ae4050c06f4e0f);$vd5b9631e98a7ed194a9b608875bf49b8 = $vc9550d5fad73447fc24ba47f95d1c6b7->getCounterTable();$vff23c14f3fea587fd6b825d3ae12a165 = <<<SQL
INSERT INTO `$vd5b9631e98a7ed194a9b608875bf49b8` (`obj_id`, `field_id`, `cnt`)
SELECT $vb15d7cc6038948c5f9aae452c262d0cb as `obj_id`, `field_id`, `cnt`
FROM `$vd5b9631e98a7ed194a9b608875bf49b8` WHERE `obj_id` = $vb80bb7740288fda1f201890375a60c8f
SQL;    $v4717d53ebfdfea8477f780ec66151dcb->query($vff23c14f3fea587fd6b825d3ae12a165);$vcc9a49f501227168c678e3c615c171ed = $vc9550d5fad73447fc24ba47f95d1c6b7->getOfferIdTable();$ve6428ac26fda3514a008d8138eff0557 = <<<SQL
INSERT INTO `$vcc9a49f501227168c678e3c615c171ed` (`obj_id`, `field_id`, `offer_id`)
SELECT $vb15d7cc6038948c5f9aae452c262d0cb as `obj_id`, `field_id`, `offer_id`
FROM `$vcc9a49f501227168c678e3c615c171ed` WHERE `obj_id` = $vb80bb7740288fda1f201890375a60c8f
SQL;    $v4717d53ebfdfea8477f780ec66151dcb->query($ve6428ac26fda3514a008d8138eff0557);}catch (databaseException $v42552b1f133f9f8eb406d4f306ea9fd1) {$v4717d53ebfdfea8477f780ec66151dcb->rollbackTransaction();throw $v42552b1f133f9f8eb406d4f306ea9fd1;}$v4717d53ebfdfea8477f780ec66151dcb->commitTransaction();return $vb15d7cc6038948c5f9aae452c262d0cb;}public function getGuidedItems($v52eb29c6d8ea0d3a5bb3654f49bbd7c7) {$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();if (is_numeric($v52eb29c6d8ea0d3a5bb3654f49bbd7c7)) {$v52eb29c6d8ea0d3a5bb3654f49bbd7c7 = (int) $v52eb29c6d8ea0d3a5bb3654f49bbd7c7;}else {$v52eb29c6d8ea0d3a5bb3654f49bbd7c7 = $v4717d53ebfdfea8477f780ec66151dcb->escape($v52eb29c6d8ea0d3a5bb3654f49bbd7c7);$v1b1cc7f086b3f074da452bc3129981eb = "SELECT `id` FROM `cms3_object_types` WHERE `guid`='" . $v52eb29c6d8ea0d3a5bb3654f49bbd7c7 . "' LIMIT 1";$result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($v1b1cc7f086b3f074da452bc3129981eb);$result->setFetchType(IQueryResult::FETCH_ROW);$v52eb29c6d8ea0d3a5bb3654f49bbd7c7 = (int) $v52eb29c6d8ea0d3a5bb3654f49bbd7c7;if ($result->length() > 0) {$v54851b009c5c647ca3e77cc517b8c76c = $result->fetch();$v52eb29c6d8ea0d3a5bb3654f49bbd7c7 = array_shift($v54851b009c5c647ca3e77cc517b8c76c);}}$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT id, name FROM cms3_objects WHERE type_id = '{$v52eb29c6d8ea0d3a5bb3654f49bbd7c7}'";$result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);$result->setFetchType(IQueryResult::FETCH_ROW);if ($v4717d53ebfdfea8477f780ec66151dcb->errorOccurred()) {throw new coreException($v4717d53ebfdfea8477f780ec66151dcb->errorDescription($vac5c74b64b4b8352ef2f181affb5ac2a));}$v0a569505d08613d9cf46769903371eee = [];foreach ($result as $vf1965a857bc285d26fe22023aa5ab50d) {list($vb80bb7740288fda1f201890375a60c8f, $vb068931cc450442b63f5b3d276ea4297) = $vf1965a857bc285d26fe22023aa5ab50d;$v0a569505d08613d9cf46769903371eee[$vb80bb7740288fda1f201890375a60c8f] = $this->translateLabel($vb068931cc450442b63f5b3d276ea4297);}if (!self::isGuideItemsOrderedById()) {natsort($v0a569505d08613d9cf46769903371eee);}return $v0a569505d08613d9cf46769903371eee;}public function getCountByTypeId($v5f694956811487225d15e973ca38fbab) {$v5f694956811487225d15e973ca38fbab = (int) $v5f694956811487225d15e973ca38fbab;$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();$vac5c74b64b4b8352ef2f181affb5ac2a = "SELECT COUNT(id) FROM cms3_objects WHERE type_id = '{$v5f694956811487225d15e973ca38fbab}'";$result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);if ($v4717d53ebfdfea8477f780ec66151dcb->errorOccurred()) {throw new databaseException($v4717d53ebfdfea8477f780ec66151dcb->errorDescription($vac5c74b64b4b8352ef2f181affb5ac2a));}list($ve2942a04780e223b215eb8b663cf5353) = $result->fetch();return $ve2942a04780e223b215eb8b663cf5353;}public function unloadObject($vb80bb7740288fda1f201890375a60c8f) {if ($this->isLoaded($vb80bb7740288fda1f201890375a60c8f)) {unset($this->objects[$vb80bb7740288fda1f201890375a60c8f]);umiObjectProperty::unloadPropData($vb80bb7740288fda1f201890375a60c8f);}else {return false;}}public function unloadAllObjects() {foreach ($this->objects as $vaf31437ce61345f416579830a98c91e5 => $v9e3669d19b675bd57058fd4664205d2a) {unset($this->objects[$vaf31437ce61345f416579830a98c91e5]);umiObjectProperty::unloadPropData($vaf31437ce61345f416579830a98c91e5);}}public function getCollectedObjects() {return array_keys($this->objects);}public function addUpdatedObjectId($vb80bb7740288fda1f201890375a60c8f) {if (!in_array($vb80bb7740288fda1f201890375a60c8f, $this->updatedObjects)) {$this->updatedObjects[] = $vb80bb7740288fda1f201890375a60c8f;}}public function getUpdatedObjects() {return $this->updatedObjects;}public function getObjectsLastUpdateTime() {$v1b3d1855699fc26f4bacb5d9419041aa = 0;foreach ($this->objects as $va8cfde6331bd59eb2ac96f8911c4b666) {if (!$va8cfde6331bd59eb2ac96f8911c4b666 instanceof iUmiObject) {continue;}if ($v1b3d1855699fc26f4bacb5d9419041aa < $va8cfde6331bd59eb2ac96f8911c4b666->getUpdateTime()) {$v1b3d1855699fc26f4bacb5d9419041aa = $va8cfde6331bd59eb2ac96f8911c4b666->getUpdateTime();}}return $v1b3d1855699fc26f4bacb5d9419041aa;}public function __destruct() {if (umiCount($this->updatedObjects) && function_exists('deleteObjectsRelatedPages')) {deleteObjectsRelatedPages();}}public function clearCache() {$v14f802e1fba977727845e8872c1743a7 = array_keys($this->objects);foreach ($v14f802e1fba977727845e8872c1743a7 as $v3c6e0b8a9c15224a8228b9a98ca1531d) {unset($this->objects[$v3c6e0b8a9c15224a8228b9a98ca1531d]);}$this->objects = [];}public function changeOrder(iUmiObject $v0932fe08b969f98faf662d9af089f7e1, iUmiObject $vf2f3c74713ce1b4781884b2977a81bdb, $v15d61712450a686a7f365adf4fef581f) {$v719a86ee781d3f80c573e69fd9292a55 = $v0932fe08b969f98faf662d9af089f7e1->getOrder();switch ($v15d61712450a686a7f365adf4fef581f) {case 'child':    case 'after': {$vf2f3c74713ce1b4781884b2977a81bdb->setOrder($v719a86ee781d3f80c573e69fd9292a55 + 1);$vf2f3c74713ce1b4781884b2977a81bdb->commit();$this->reBuildOrder($vf2f3c74713ce1b4781884b2977a81bdb, 'greed');break;}case 'before': {$this->reBuildOrder($v0932fe08b969f98faf662d9af089f7e1, 'greed');$vf2f3c74713ce1b4781884b2977a81bdb->setOrder($v719a86ee781d3f80c573e69fd9292a55);$vf2f3c74713ce1b4781884b2977a81bdb->commit();break;}default: {return false;}}return true;}public function reBuildOrder(iUmiObject $v0932fe08b969f98faf662d9af089f7e1, $v15d61712450a686a7f365adf4fef581f) {$v719a86ee781d3f80c573e69fd9292a55 = (int) $v0932fe08b969f98faf662d9af089f7e1->getOrder();$v6301cee35ea764a1e241978f93f01069 = (int) $v0932fe08b969f98faf662d9af089f7e1->getTypeId();$v6301cee35ea764a1e241978f93f01069 = $this->getOrderTargetTypeId($v6301cee35ea764a1e241978f93f01069);switch (true) {case is_numeric($v6301cee35ea764a1e241978f93f01069): {$vf7252e33f6f4e64cffdca52a60b66f80 = "`type_id` = $v6301cee35ea764a1e241978f93f01069";break;}case is_array($v6301cee35ea764a1e241978f93f01069): {$v6301cee35ea764a1e241978f93f01069 = implode(', ', $v6301cee35ea764a1e241978f93f01069);$vf7252e33f6f4e64cffdca52a60b66f80 = "`type_id` IN ($v6301cee35ea764a1e241978f93f01069)";break;}default: {throw new coreException(getLabel('error-wrong-type-id-given'));}}$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();switch ($v15d61712450a686a7f365adf4fef581f) {case 'greed': {$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
UPDATE `cms3_objects`
SET `ord` = `ord` + 1
WHERE $vf7252e33f6f4e64cffdca52a60b66f80
AND `ord` >= $v719a86ee781d3f80c573e69fd9292a55;
SQL;     break;}case 'normal':    default: {$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
UPDATE `cms3_objects`
SET `ord` = `ord` + 1
WHERE $vf7252e33f6f4e64cffdca52a60b66f80
AND `ord` > $v719a86ee781d3f80c573e69fd9292a55;
SQL;    }}$v4717d53ebfdfea8477f780ec66151dcb->query($vac5c74b64b4b8352ef2f181affb5ac2a);return true;}public function getMaxOrderByTypeId($v6301cee35ea764a1e241978f93f01069) {$v6301cee35ea764a1e241978f93f01069 = $this->getOrderTargetTypeId($v6301cee35ea764a1e241978f93f01069);$v4717d53ebfdfea8477f780ec66151dcb = ConnectionPool::getInstance()->getConnection();switch (true) {case is_numeric($v6301cee35ea764a1e241978f93f01069): {$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT max(`ord`) as ord FROM `cms3_objects` WHERE `type_id` = $v6301cee35ea764a1e241978f93f01069;
SQL;     break;}case is_array($v6301cee35ea764a1e241978f93f01069): {$v6301cee35ea764a1e241978f93f01069 = implode(', ', $v6301cee35ea764a1e241978f93f01069);$vac5c74b64b4b8352ef2f181affb5ac2a = <<<SQL
SELECT max(`ord`) as ord FROM `cms3_objects` WHERE `type_id` IN ($v6301cee35ea764a1e241978f93f01069);
SQL;     break;}default: {throw new coreException(getLabel('error-wrong-type-id-given'));}}$result = $v4717d53ebfdfea8477f780ec66151dcb->queryResult($vac5c74b64b4b8352ef2f181affb5ac2a);$result->setFetchType(IQueryResult::FETCH_ASSOC);$result = $result->getIterator();$vf1965a857bc285d26fe22023aa5ab50d = $result->current();return (int) $vf1965a857bc285d26fe22023aa5ab50d['ord'];}private function buildObjectList(IQueryResult $result) {$result->setFetchType(IQueryResult::FETCH_ROW);if ($result->length() == 0) {return [];}$v7beef54c8a75efe23880c9c3bfaf46d7 = [];foreach ($result as $vf1965a857bc285d26fe22023aa5ab50d) {$vb80bb7740288fda1f201890375a60c8f = array_shift($vf1965a857bc285d26fe22023aa5ab50d);$va8cfde6331bd59eb2ac96f8911c4b666 = $this->getObject($vb80bb7740288fda1f201890375a60c8f, $vf1965a857bc285d26fe22023aa5ab50d);if ($va8cfde6331bd59eb2ac96f8911c4b666 instanceof iUmiObject) {$v7beef54c8a75efe23880c9c3bfaf46d7[] = $va8cfde6331bd59eb2ac96f8911c4b666;}}return $v7beef54c8a75efe23880c9c3bfaf46d7;}private function getOrderTargetTypeId($v6301cee35ea764a1e241978f93f01069) {$v0ad9fc5f16ead840858c610947b0b300 = umiObjectTypesCollection::getInstance();$v6301cee35ea764a1e241978f93f01069 = (int) $v6301cee35ea764a1e241978f93f01069;$v17a78a603b5acd234ea3e40b7714f8d8 = $v0ad9fc5f16ead840858c610947b0b300->getParentTypeId($v6301cee35ea764a1e241978f93f01069);if (!is_numeric($v17a78a603b5acd234ea3e40b7714f8d8)) {return $v6301cee35ea764a1e241978f93f01069;}$v4f6f4a0e9e11e5e330080342e3da6c4e = $v0ad9fc5f16ead840858c610947b0b300->getChildTypeIds($v6301cee35ea764a1e241978f93f01069);$vf4524cae833ebddb750c5f989d513746 = $v0ad9fc5f16ead840858c610947b0b300->getType($v17a78a603b5acd234ea3e40b7714f8d8);switch (true) {case !$vf4524cae833ebddb750c5f989d513746 instanceof iUmiObjectType && umiCount($v4f6f4a0e9e11e5e330080342e3da6c4e) == 0: {return $v6301cee35ea764a1e241978f93f01069;}case !$vf4524cae833ebddb750c5f989d513746 instanceof iUmiObjectType: {$v4f6f4a0e9e11e5e330080342e3da6c4e[] = $v6301cee35ea764a1e241978f93f01069;return $v4f6f4a0e9e11e5e330080342e3da6c4e;}}if ($vf4524cae833ebddb750c5f989d513746->getGUID() == 'root-guides-type') {return $v6301cee35ea764a1e241978f93f01069;}return $v0ad9fc5f16ead840858c610947b0b300->getChildTypeIds($v17a78a603b5acd234ea3e40b7714f8d8);}private function getOwnerId() {try {$vfa53b91ccc1b78668d5af58e1ed3a485 = Service::Auth();}catch (Exception $ve1671797c52e15f763380b45e841ec32) {return null;}return $vfa53b91ccc1b78668d5af58e1ed3a485->isAuthorized() ? $vfa53b91ccc1b78668d5af58e1ed3a485->getUserId() : null;}public function checkObjectById($v16b2b26000987faccb260b9d39df1269) {return true;}}